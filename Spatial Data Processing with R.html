<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Jérôme Guélat">
<meta name="dcterms.date" content="2023-01-17">

<title>Spatial Data Processing with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Spatial Data Processing with R_files/libs/clipboard/clipboard.min.js"></script>
<script src="Spatial Data Processing with R_files/libs/quarto-html/quarto.js"></script>
<script src="Spatial Data Processing with R_files/libs/quarto-html/popper.min.js"></script>
<script src="Spatial Data Processing with R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Spatial Data Processing with R_files/libs/quarto-html/anchor.min.js"></script>
<link href="Spatial Data Processing with R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Spatial Data Processing with R_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Spatial Data Processing with R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Spatial Data Processing with R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Spatial Data Processing with R_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="Spatial Data Processing with R_files/libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<script src="Spatial Data Processing with R_files/libs/jquery-1.12.4/jquery.min.js"></script>
<link href="Spatial Data Processing with R_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="Spatial Data Processing with R_files/libs/leaflet-1.3.1/leaflet.js"></script>
<link href="Spatial Data Processing with R_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="Spatial Data Processing with R_files/libs/proj4-2.6.2/proj4.min.js"></script>
<script src="Spatial Data Processing with R_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="Spatial Data Processing with R_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="Spatial Data Processing with R_files/libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="Spatial Data Processing with R_files/libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="Spatial Data Processing with R_files/libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="Spatial Data Processing with R_files/libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="Spatial Data Processing with R_files/libs/HomeButton-0.0.1/home-button.js"></script>
<script src="Spatial Data Processing with R_files/libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="Spatial Data Processing with R_files/libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="Spatial Data Processing with R_files/libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="Spatial Data Processing with R_files/libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-right">
      <h1 class="title">Spatial Data Processing with R</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliations</div>
    
      <div class="quarto-title-meta-contents">
      Dr.&nbsp;Jérôme Guélat 
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Swiss Ornithological Institute
            </p>
          <p class="affiliation">
              <a href="https://www.vogelwarte.ch">
              
              </a>
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 17, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
   
  <ul>
  <li><a href="#preparation" id="toc-preparation" class="nav-link active" data-scroll-target="#preparation"><span class="toc-section-number">1</span>  Preparation</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="toc-section-number">2</span>  Introduction</a></li>
  <li><a href="#vector-data" id="toc-vector-data" class="nav-link" data-scroll-target="#vector-data"><span class="toc-section-number">3</span>  Vector data</a>
  <ul class="collapse">
  <li><a href="#vector-data-model" id="toc-vector-data-model" class="nav-link" data-scroll-target="#vector-data-model"><span class="toc-section-number">3.1</span>  Vector data model</a></li>
  <li><a href="#a-first-look-at-vector-data-in-r" id="toc-a-first-look-at-vector-data-in-r" class="nav-link" data-scroll-target="#a-first-look-at-vector-data-in-r"><span class="toc-section-number">3.2</span>  A first look at vector data in R</a></li>
  <li><a href="#structure-of-sf-objects" id="toc-structure-of-sf-objects" class="nav-link" data-scroll-target="#structure-of-sf-objects"><span class="toc-section-number">3.3</span>  Structure of <code>sf</code> objects</a></li>
  </ul></li>
  <li><a href="#raster-data" id="toc-raster-data" class="nav-link" data-scroll-target="#raster-data"><span class="toc-section-number">4</span>  Raster data</a></li>
  <li><a href="#coordinate-reference-systems" id="toc-coordinate-reference-systems" class="nav-link" data-scroll-target="#coordinate-reference-systems"><span class="toc-section-number">5</span>  Coordinate reference systems</a></li>
  <li><a href="#tips-and-tricks-for-vectors" id="toc-tips-and-tricks-for-vectors" class="nav-link" data-scroll-target="#tips-and-tricks-for-vectors"><span class="toc-section-number">6</span>  Tips and tricks for vectors</a>
  <ul class="collapse">
  <li><a href="#reading-and-writing-vector-data" id="toc-reading-and-writing-vector-data" class="nav-link" data-scroll-target="#reading-and-writing-vector-data"><span class="toc-section-number">6.1</span>  Reading and writing vector data</a></li>
  <li><a href="#basic-geometric-computations" id="toc-basic-geometric-computations" class="nav-link" data-scroll-target="#basic-geometric-computations"><span class="toc-section-number">6.2</span>  Basic geometric computations</a></li>
  <li><a href="#geometric-validity" id="toc-geometric-validity" class="nav-link" data-scroll-target="#geometric-validity"><span class="toc-section-number">6.3</span>  Geometric validity</a></li>
  <li><a href="#vector-type-casting" id="toc-vector-type-casting" class="nav-link" data-scroll-target="#vector-type-casting"><span class="toc-section-number">6.4</span>  Vector type casting</a></li>
  <li><a href="#spatial-predicates" id="toc-spatial-predicates" class="nav-link" data-scroll-target="#spatial-predicates"><span class="toc-section-number">6.5</span>  Spatial predicates</a></li>
  <li><a href="#spatial-subsetting" id="toc-spatial-subsetting" class="nav-link" data-scroll-target="#spatial-subsetting"><span class="toc-section-number">6.6</span>  Spatial subsetting</a></li>
  <li><a href="#spatial-joins" id="toc-spatial-joins" class="nav-link" data-scroll-target="#spatial-joins"><span class="toc-section-number">6.7</span>  Spatial joins</a></li>
  <li><a href="#distance-operations" id="toc-distance-operations" class="nav-link" data-scroll-target="#distance-operations"><span class="toc-section-number">6.8</span>  Distance operations</a></li>
  <li><a href="#buffers" id="toc-buffers" class="nav-link" data-scroll-target="#buffers"><span class="toc-section-number">6.9</span>  Buffers</a></li>
  <li><a href="#affine-transformations" id="toc-affine-transformations" class="nav-link" data-scroll-target="#affine-transformations"><span class="toc-section-number">6.10</span>  Affine transformations</a></li>
  <li><a href="#combining-geometries" id="toc-combining-geometries" class="nav-link" data-scroll-target="#combining-geometries"><span class="toc-section-number">6.11</span>  Combining geometries</a></li>
  <li><a href="#aggregate-by-attributes" id="toc-aggregate-by-attributes" class="nav-link" data-scroll-target="#aggregate-by-attributes"><span class="toc-section-number">6.12</span>  Aggregate by attributes</a></li>
  <li><a href="#generate-sample-points" id="toc-generate-sample-points" class="nav-link" data-scroll-target="#generate-sample-points"><span class="toc-section-number">6.13</span>  Generate sample points</a></li>
  <li><a href="#convex-hulls" id="toc-convex-hulls" class="nav-link" data-scroll-target="#convex-hulls"><span class="toc-section-number">6.14</span>  Convex hulls</a></li>
  <li><a href="#crs-transformations" id="toc-crs-transformations" class="nav-link" data-scroll-target="#crs-transformations"><span class="toc-section-number">6.15</span>  CRS transformations</a></li>
  <li><a href="#neighborhood-analyses" id="toc-neighborhood-analyses" class="nav-link" data-scroll-target="#neighborhood-analyses"><span class="toc-section-number">6.16</span>  Neighborhood analyses</a></li>
  </ul></li>
  <li><a href="#tips-and-tricks-for-rasters" id="toc-tips-and-tricks-for-rasters" class="nav-link" data-scroll-target="#tips-and-tricks-for-rasters"><span class="toc-section-number">7</span>  Tips and tricks for rasters</a>
  <ul class="collapse">
  <li><a href="#reading-and-writing-raster-data" id="toc-reading-and-writing-raster-data" class="nav-link" data-scroll-target="#reading-and-writing-raster-data"><span class="toc-section-number">7.1</span>  Reading and writing raster data</a></li>
  <li><a href="#summarize-rasters" id="toc-summarize-rasters" class="nav-link" data-scroll-target="#summarize-rasters"><span class="toc-section-number">7.2</span>  Summarize rasters</a></li>
  <li><a href="#spatial-subsetting-1" id="toc-spatial-subsetting-1" class="nav-link" data-scroll-target="#spatial-subsetting-1"><span class="toc-section-number">7.3</span>  Spatial subsetting</a></li>
  <li><a href="#aggregation-and-resampling" id="toc-aggregation-and-resampling" class="nav-link" data-scroll-target="#aggregation-and-resampling"><span class="toc-section-number">7.4</span>  Aggregation and resampling</a></li>
  <li><a href="#classify-rasters" id="toc-classify-rasters" class="nav-link" data-scroll-target="#classify-rasters"><span class="toc-section-number">7.5</span>  Classify rasters</a></li>
  <li><a href="#extract-pixel-values" id="toc-extract-pixel-values" class="nav-link" data-scroll-target="#extract-pixel-values"><span class="toc-section-number">7.6</span>  Extract pixel values</a></li>
  <li><a href="#combining-rasters" id="toc-combining-rasters" class="nav-link" data-scroll-target="#combining-rasters"><span class="toc-section-number">7.7</span>  Combining rasters</a></li>
  <li><a href="#focal-analysis" id="toc-focal-analysis" class="nav-link" data-scroll-target="#focal-analysis"><span class="toc-section-number">7.8</span>  Focal analysis</a></li>
  <li><a href="#generate-raster-covariates" id="toc-generate-raster-covariates" class="nav-link" data-scroll-target="#generate-raster-covariates"><span class="toc-section-number">7.9</span>  Generate raster covariates</a></li>
  <li><a href="#rasterize-vector-data" id="toc-rasterize-vector-data" class="nav-link" data-scroll-target="#rasterize-vector-data"><span class="toc-section-number">7.10</span>  Rasterize vector data</a></li>
  <li><a href="#crs-transformations-1" id="toc-crs-transformations-1" class="nav-link" data-scroll-target="#crs-transformations-1"><span class="toc-section-number">7.11</span>  CRS transformations</a></li>
  </ul></li>
  <li><a href="#making-maps" id="toc-making-maps" class="nav-link" data-scroll-target="#making-maps"><span class="toc-section-number">8</span>  Making maps</a>
  <ul class="collapse">
  <li><a href="#basic-maps" id="toc-basic-maps" class="nav-link" data-scroll-target="#basic-maps"><span class="toc-section-number">8.1</span>  Basic maps</a></li>
  <li><a href="#swiss-map" id="toc-swiss-map" class="nav-link" data-scroll-target="#swiss-map"><span class="toc-section-number">8.2</span>  Swiss map</a></li>
  <li><a href="#static-maps-with-tmap" id="toc-static-maps-with-tmap" class="nav-link" data-scroll-target="#static-maps-with-tmap"><span class="toc-section-number">8.3</span>  Static maps with tmap</a></li>
  <li><a href="#dynamic-maps" id="toc-dynamic-maps" class="nav-link" data-scroll-target="#dynamic-maps"><span class="toc-section-number">8.4</span>  Dynamic maps</a></li>
  </ul></li>
  <li><a href="#more-help" id="toc-more-help" class="nav-link" data-scroll-target="#more-help"><span class="toc-section-number">9</span>  More help</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="toc-section-number">10</span>  References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block column-page-right" id="quarto-document-content">




<div class="cell">

</div>
<section id="preparation" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="preparation"><span class="header-section-number">1</span> Preparation</h2>
<p>In order to run the code for this workshop, you’ll need the following packages. You can use the following code to install them. All the required dependencies will be automatically installed.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please also update to the latest version of R, otherwise you may get packages that are not fully up-to-date.</p>
</div>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"lwgeom"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"terra"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"spatstat.random"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"spdep"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tmap"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"mapview"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"mapsf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You’ll also need to download the following data that we’ll use in some of the examples: <a href="https://quarto.org" class="uri">https://quarto.org</a>.</p>
</section>
<section id="introduction" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2</span> Introduction</h2>
<p>When we work with geographic data we need to decide how to model real world objects or concepts (buildings, forests, elevation, etc.) before we can use them in a computer with a GIS (Geographic Information System) software. GIS people mainly use 2 main data models: vector and raster. Other models exist, such as TINs, point clouds or meshes, but we won’t cover them in this workshop.</p>
<p>Vector data is normally used for high precision data sets and can be represented as points, lines or polygons. Properties of the represented features are stored as attributes. The vector types you will use depends of course on your own data and on your analyses. For example: points could be appropriate for bird nests and sightings, lines for moving animals and linear structures (paths, rivers), and polygons for territories and land cover categories. Of course a river can also be modeled as a polygon if you’re interested in its width (or you can also store its width as an attribute of the line).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>High precision doesn’t necessarily mean high accuracy! For example the coordinates of some points could be stored in meters with 5 decimals even though the measurement error was 2 meters.</p>
<p>Most vector data formats include some possibility to store information about measurement errors but this is actually very rarely used.</p>
</div>
</div>
<p>The best known format for storing vector data is the shapefile, an old and inefficient format developed by ESRI. Even though the shapefile format is still widely used, it has a lot of limitations and problems (listed on the following website: <a href="http://switchfromshapefile.org" class="uri">http://switchfromshapefile.org</a>). Nowadays GIS specialists advise to replace it with better alternatives such as the <strong>GeoPackage</strong> format. Every modern GIS software can read and write GeoPackages and the format is also completely open-source. It is also published as a standard by the Open Geospatial Consortium (OGC) which makes it a future-proof alternative.</p>
<p>Raster data is basically an image divided into cells (pixels) of constant size, and each cell has an associated value. Satellite imagery, topographic maps and digital elevation models (DEM) are typical examples where the raster data model is appropriate. A raster data set can have several layers called bands, for example most aerial images have at least three bands: red, green and blue. In the raster data model, specific geographic features are aggregated to a given resolution to create a consistent data set, associated with a loss of precision. The resolution used to aggregate can have a large influence of some analyses and must be thought of carefully.</p>
<p>There exists thousands of different raster data formats. As of today I recommend using the <strong>GeoTiff</strong> format. It is widely used in the GIS world and every GIS software can read and write raster data in this format. Note that it is also possible to use the GeoPackage format to save raster data sets, however I would advise against using it since some GIS software won’t be able to read these rasters.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Vector data: use the GeoPackage format</p>
<p>Raster data: use the GeoTiff format</p>
</div>
</div>
</section>
<section id="vector-data" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="vector-data"><span class="header-section-number">3</span> Vector data</h2>
<section id="vector-data-model" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="vector-data-model"><span class="header-section-number">3.1</span> Vector data model</h3>
<p>The main vector types are points, lines and polygons (or a combination thereof) and the point is the base of all these types. For example a simple line consists of 2 connected points, similarly an ordered sequence of connected points will represent a more complex line (often called a polyline). A simple polygon will be modeled as an external ring, which is a special type of polyline where the first and last points are identical. In the case of lines and polygons we often speak of vertices to describe these points. Things can be a bit more complex, for example a polygon could have a hole which is modeled as an internal ring.</p>
<p>The <strong>Simple Feature</strong> standard (<a href="https://portal.ogc.org/files/?artifact_id=25355">full documentation</a>) was developed to be sure that we all speak the same language when describing vector elements. The specification describes 18 geometry types, but don’t worry only 7 of them will be useful for us. The following figure shows these 7 types (source: Lovelace <em>et al.</em>, 2019):</p>
<p><img src="figures/sf-classes.png" class="img-fluid"></p>
<p>A feature represents a geographic entity modeled by one of these types. For example a building would be a single feature of type POLYGON, while the whole Hawaii archipelago would be a single feature of type MULTIPOLYGON (but you could of course also model each island as type POLYGON). A single feature using the MULTI* types can have multiple elements but this is not mandatory. Most of the time we will use the default 2D version of these types. However it is possible to include additional numeric values such as the height of each point (Z values) or some kind of measurement error (M values). Note that most GIS software will ignore these values for the vast majority of spatial analyses.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The feature type is usually defined for the whole vector data set, and not per feature (well actually <code>sf</code> lets you do that but this will brings you all sorts of troubles). For example, if you know that your data set will contain POLYGON and MULTIPOLYGON features, then you will have to use the MULTIPOLYGON type for all of them.</p>
</div>
</div>
<p>In most GIS softwares (including R), simple features are internally encoded using the well-known binary (WKB) or well-known text (WKT) standards. As the name mentions, WKB is a binary format and hence not easily readable by normal humans. The WKT format is encoding exactly the same information as WKB, but in a more human friendly way. Here are some examples of WKT-encoded features (check the <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry">Wikipedia page</a> if you need more):</p>
<ul>
<li>a point: POINT (10 5)</li>
<li>a linestring made of 3 points: LINESTRING (1 1, 2 4, 5 10)</li>
<li>a polygon (without a hole): POLYGON ((10 5, 10 9, 5 8, 4 2, 10 5))</li>
<li>a multilinestring: MULTILINESTRING ((1 1, 2 4, 5 10), (2 2, 5 2))</li>
</ul>
<p>The geometry is of course essential in order to have a spatial information but the vector data model also allows storing non-spatial attributes (often called <em>attribute table</em>) for each feature. As we will see, these tables are stored as data frames in R and each column will store some property of the related feature (identification number, name, etc.). Each row relates to a single spatial feature (which can consist of several geometries if its type is MULTI*). The following figure shows some examples (source: Tennekes &amp; Nowosad, 2021):</p>
<p><img src="figures/vector-data-model-1.png" class="img-fluid" width="600"></p>
</section>
<section id="a-first-look-at-vector-data-in-r" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="a-first-look-at-vector-data-in-r"><span class="header-section-number">3.2</span> A first look at vector data in R</h3>
<p>Let’s have a look at how R stores a vector data set. The main classes and methods needed to work with spatial vector data are defined in the <code>sf</code> package (Pebesma, 2018). We will also load the <code>tmap</code> package (Tennekes, 2018) to have access to some spatial data sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
</div>
</div>
<p>When you first load the <code>sf</code> package, it will provide you with version information about some important open-source GIS libraries it uses. In a few rare cases, some functions will only be available if you use recent version of these libraries. If you use <code>sf</code> on Windows or Mac and install it from CRAN, they will be included inside the <code>sf</code> package and there’s no easy way to update them. These libraries are used in almost all open-source GIS software and even in some commercial ones. GDAL takes care of reading and writing your GIS files and can read 99.9% of all the existing GIS formats; GEOS is a Euclidean planar geometry engine and is used for all the common GIS analyses (intersection, union, buffer, etc.); PROJ is responsible for all the coordinate reference systems operations. The s2 library is a spherical geometry engine which is active by default for computations when using unprojected data.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
A bit of history
</div>
</div>
<div class="callout-body-container callout-body">
<p>The availability of the <code>sf</code> package was huge change in the small world of “R-Spatial”. In the old days we used a combination of several packages to process GIS vector data in R. The spatial classes (and some functions) were defined in the <code>sp</code> package, the import/export of data was managed by the <code>rgdal</code> package, and the geometric operations were available in the <code>rgeos</code> package. You’ll find a lot of code using these packages on the internet. Please refrain from using them since they’ll only be maintained until end of 2023 and will then probably be removed from CRAN. Moreover the <code>sf</code> package is definitely more powerful and much faster.</p>
</div>
</div>
<p>We will now load the <code>World</code> vector data set inside the <code>tmap</code> package and have a look at its structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(World)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(World)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(World)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "iso_a3"       "name"         "sovereignt"   "continent"    "area"        
 [6] "pop_est"      "pop_est_dens" "economy"      "income_grp"   "gdp_cap_est" 
[11] "life_exp"     "well_being"   "footprint"    "inequality"   "HPI"         
[16] "geometry"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>World</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 177 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
First 10 features:
   iso_a3                   name           sovereignt               continent
1     AFG            Afghanistan          Afghanistan                    Asia
2     AGO                 Angola               Angola                  Africa
3     ALB                Albania              Albania                  Europe
4     ARE   United Arab Emirates United Arab Emirates                    Asia
5     ARG              Argentina            Argentina           South America
6     ARM                Armenia              Armenia                    Asia
7     ATA             Antarctica           Antarctica              Antarctica
8     ATF Fr. S. Antarctic Lands               France Seven seas (open ocean)
9     AUS              Australia            Australia                 Oceania
10    AUT                Austria              Austria                  Europe
                  area  pop_est pop_est_dens                    economy
1    652860.000 [km^2] 28400000 4.350090e+01  7. Least developed region
2   1246700.000 [km^2] 12799293 1.026654e+01  7. Least developed region
3     27400.000 [km^2]  3639453 1.328268e+02       6. Developing region
4     71252.172 [km^2]  4798491 6.734519e+01       6. Developing region
5   2736690.000 [km^2] 40913584 1.495003e+01    5. Emerging region: G20
6     28470.000 [km^2]  2967004 1.042151e+02       6. Developing region
7  12259213.973 [km^2]     3802 3.101341e-04       6. Developing region
8      7257.455 [km^2]      140 1.929051e-02       6. Developing region
9   7682300.000 [km^2] 21262641 2.767744e+00 2. Developed region: nonG7
10    82523.000 [km^2]  8210281 9.949082e+01 2. Developed region: nonG7
                income_grp gdp_cap_est life_exp well_being footprint inequality
1            5. Low income    784.1549   59.668        3.8      0.79 0.42655744
2   3. Upper middle income   8617.6635       NA         NA        NA         NA
3   4. Lower middle income   5992.6588   77.347        5.5      2.21 0.16513372
4  2. High income: nonOECD  38407.9078       NA         NA        NA         NA
5   3. Upper middle income  14027.1261   75.927        6.5      3.14 0.16423830
6   4. Lower middle income   6326.2469   74.446        4.3      2.23 0.21664810
7  2. High income: nonOECD 200000.0000       NA         NA        NA         NA
8  2. High income: nonOECD 114285.7143       NA         NA        NA         NA
9     1. High income: OECD  37634.0832   82.052        7.2      9.31 0.08067825
10    1. High income: OECD  40132.6093   81.004        7.4      6.06 0.07129351
        HPI                       geometry
1  20.22535 MULTIPOLYGON (((61.21082 35...
2        NA MULTIPOLYGON (((16.32653 -5...
3  36.76687 MULTIPOLYGON (((20.59025 41...
4        NA MULTIPOLYGON (((51.57952 24...
5  35.19024 MULTIPOLYGON (((-65.5 -55.2...
6  25.66642 MULTIPOLYGON (((43.58275 41...
7        NA MULTIPOLYGON (((-59.57209 -...
8        NA MULTIPOLYGON (((68.935 -48....
9  21.22897 MULTIPOLYGON (((145.398 -40...
10 30.47822 MULTIPOLYGON (((16.97967 48...</code></pre>
</div>
</div>
<p>We see the <code>World</code> object is stored as a data frame with an additional geometry column (note that the name of the geometry column doesn’t need to be ‘geometry’). The content of the geometry column is displayed using the WKT standard. R is also giving us more information, like the coordinate reference system used (more on that later) and the number of dimensions (i.e.&nbsp;XY, XYZ or XYZM).</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question: why is the MULTIPOLYGON type appropriate?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Don’t forget that each feature (i.e.&nbsp;each row of the data frame) represents a country, and some countries are made up of several distinct pieces of land (e.g., islands, exclaves). That’s why we need the MULTIPOLYGON type. And since the type apply to the whole data set, even countries with a single geometry (like Switzerland) will need to be MULTIPOLYGONS.</p>
</div>
</div>
</div>
<p>It is also easy to plot the data using the usual command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(World)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>By default R will take the first 9 attributes of the <code>sf</code> object and plot them using the available geometries. Since these objects inherit from the data base class, you can use all the typical data frame functions such as <code>summary</code>, <code>head</code>, <code>merge</code>, <code>rbind</code>, etc. Subsetting is also possible using the standard <code>[]</code> operators. Therefore you can use the following code if you only want to plot the well-being index, for the whole world, only for countries with a high index, or just for Australia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(World[,<span class="st">"well_being"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(World[<span class="fu">which</span>(World<span class="sc">$</span>well_being <span class="sc">&gt;</span> <span class="dv">6</span>),<span class="st">"well_being"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(World[<span class="fu">which</span>(World<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Australia"</span>),<span class="st">"well_being"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the color scale was adapted depending on the available values in the filtered data set. If you only need the geometries without any attributes, then you can use the <code>st_geometry()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(World))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise (5 minutes)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Play a little bit with the <code>World</code> data set, try different functions that you would normally use with a data frame. Import the <code>redlist</code> data set in the file <code>red_list_index.csv</code> (source: <a href="https://stats.oecd.org" class="uri">https://stats.oecd.org</a>) and join it to the <code>World</code> data frame to add new attributes. Plot a world map using one of the new attributes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>redlist <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"red_list_index.csv"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>world2 <span class="ot">&lt;-</span> <span class="fu">merge</span>(World, redlist, <span class="at">by.x =</span> <span class="st">"iso_a3"</span>, <span class="at">by.y =</span> <span class="st">"code"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(world2[,<span class="st">"index_2020"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="structure-of-sf-objects" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="structure-of-sf-objects"><span class="header-section-number">3.3</span> Structure of <code>sf</code> objects</h3>
<p>Most of the time you won’t need to create your own <code>sf</code> objects from scratch since you’ll import some existing GIS data. But if you need to, there are special functions to help you. This is also a good way to get a better understanding of the structure of <code>sf</code> objects. The standard process is shown in the following figure (source: Lovelace <em>et al.</em>, 2019):</p>
<p><img src="figures/02-sfdiagram.png" class="img-fluid" width="800"></p>
<p>You first need to create each feature geometry using some constructor functions. Each of these features will be of class <code>sfg</code> (simple feature geometry). Then you collect all these geometries in a list using the <code>st_sfc()</code> function. You get a new object of class <code>sfc</code> (simple feature list-column). After that you combine the newly created simple feature list-column with the attributes (stored as a data frame, or a tibble) using the <code>st_sf()</code> function in order to get an <code>sf</code> object.</p>
<p>Since this is rather abstract, let’s look at a simple example. Imagine we want to create a point data set containing three bird observations, and each observation will have the following attributes: species and sex. We start by creating our point geometries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pt1 <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2657000</span>, <span class="dv">1219000</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>pt2 <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2658000</span>, <span class="dv">1218000</span>))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>pt3 <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2659000</span>, <span class="dv">1217000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s have a look at what we’ve just created:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pt1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>POINT (2657000 1219000)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pt1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "XY"    "POINT" "sfg"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(pt1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "double"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pt1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 'XY' num [1:2] 2657000 1219000</code></pre>
</div>
</div>
<p>Our first object is a 2D point (otherwise we would see XYZ or XYZM) of class <code>sfg</code>. If we look a bit more into the details of the structure, we see that it is actually stored as vector of type <code>double</code> (with length 2).</p>
<p>Now we need to collect our points inside an <code>sfc</code> object. This is simply a list of <code>sfg</code> objects with an associated coordinate reference system (CRS). Since we collected our data in Switzerland, we will use the standard Swiss coordinate reference system. As we will see later, most coordinate reference systems are identified by a specific number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(pt1, pt2, pt3, <span class="at">crs =</span> <span class="dv">2056</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s have a look at our new creation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 3 features 
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2657000 ymin: 1217000 xmax: 2659000 ymax: 1219000
Projected CRS: CH1903+ / LV95</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POINT (2657000 1219000)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POINT (2658000 1218000)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POINT (2659000 1217000)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sfc_POINT" "sfc"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sfc_POINT of length 3; first list element:  'XY' num [1:2] 2657000 1219000</code></pre>
</div>
</div>
<p>This confirms that our <code>sfc</code> object is actually a list, and this object will be the geometry column of the soon to be created <code>sf</code> object. Since our object is a list, it is easy to extract individual elements if needed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the second item of the list</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pts[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>POINT (2658000 1218000)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pts[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "XY"    "POINT" "sfg"  </code></pre>
</div>
</div>
<p>The feature geometries are defined and stored in an <code>sfc</code> object, now we just need to define the attributes of each feature. We store them in a data frame using the same order as the geometries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>pts_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">species =</span> <span class="fu">c</span>(<span class="st">"wallcreeper"</span>, <span class="st">"alpine chough"</span>, <span class="st">"kingfisher"</span>),</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"female"</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>pts_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        species    sex
1   wallcreeper   male
2 alpine chough female
3    kingfisher female</code></pre>
</div>
</div>
<p>And as a last step we combine the feature geometries with the related attributes using the <code>st_sf()</code> function. We now have a typical GIS data set stored as an <code>sf</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>pts_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(pts_data, <span class="at">geometry =</span> pts)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>pts_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2657000 ymin: 1217000 xmax: 2659000 ymax: 1219000
Projected CRS: CH1903+ / LV95
        species    sex                geometry
1   wallcreeper   male POINT (2657000 1219000)
2 alpine chough female POINT (2658000 1218000)
3    kingfisher female POINT (2659000 1217000)</code></pre>
</div>
</div>
<p>Since everything is stored as lists, it is again easy to access individual elements of the <code>sf</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the 3rd geometry</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>pts_sf<span class="sc">$</span>geometry[[<span class="dv">3</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>POINT (2659000 1217000)</code></pre>
</div>
</div>
<p>We process similarly to create other geometry types from scratch, the only difference is that we now need matrices to store the vertices of the lines and polygons instead of a simple vector, and for multilinestrings, (multi-)polygons and geometry collections, we need more lists to encapsulate everything. If you’re not sure how to create geometries, the <code>sf</code> documentation provides examples for all the geometry types. Look for the following functions: <code>st_point()</code>, <code>st_linestring()</code>, <code>st_polygon()</code>, <code>st_multipoint()</code>, <code>st_multilinestring()</code>, <code>st_multipolygon()</code>, <code>st_geometrycollection()</code>. Here’s a more complex example showing how to create a multipolygon (including one geometry with a hole) inside a <code>sfg</code> object. The next steps (collecting geometries in a <code>sfc</code> object, adding attributes and store as a <code>sf</code> object) are exactly the same as before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind creates matrices and makes the coding easier</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>pol1_border <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>pol1_hole <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>pol1 <span class="ot">&lt;-</span> <span class="fu">list</span>(pol1_border, pol1_hole)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>pol2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>multipolygon_list <span class="ot">&lt;-</span> <span class="fu">list</span>(pol1, pol2)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>multipol <span class="ot">&lt;-</span> <span class="fu">st_multipolygon</span>(multipolygon_list)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>multipol</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>MULTIPOLYGON (((1 5, 2 2, 4 1, 4 4, 1 5), (2 4, 3 4, 3 3, 2 3, 2 4)), ((0 2, 1 2, 1 3, 0 3, 0 2)))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(multipol, <span class="at">col =</span> <span class="st">"navy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise (5 minutes)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try to build your own <code>sfc</code> and <code>sf</code> objects.</p>
</div>
</div>
</section>
</section>
<section id="raster-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="raster-data"><span class="header-section-number">4</span> Raster data</h2>
<p>As we saw above, a raster data set is basically an image, which is the same as a grid of pixels. Most raster data sets you will encounter will have a constant pixel size (also called resolution) and we will only focus on these during this workshop. However don’t forget that other kind of grids, for example sheared or curvilinear, also exist. This is sometimes needed depending on the coordinate reference system used to store the data, or can be caused by some reprojections.</p>
<p>Rasters are perfect for storing continuous values contained in a large area (called the extent of the raster). Digital elevation models are a typical example of such data, each cell is used to store an elevation value. You will also find rasters containing discrete values, these are often used to store landcover or landuse data sets. Note that, unlike vector data, it is impossible to store overlapping features in the same data set. We saw that vector data sets can store multiple attributes for a single feature. We can use a similar technique for raster data sets with the help of raster bands. You can think of raster bands as different layers of the same grid, each layer containing a different information. This is mainly use for spectral data, for example the red, green and blue intensity values in an aerial picture; satellite imagery will have even more bands depending on the number of sensors. Multiband rasters are also often used to store environment variables that change through time (e.g.&nbsp;a temperature raster, with one band per day). Such rasters are often called datacubes.</p>
<p><img src="figures/raster_types.jpg" class="img-fluid"></p>
<p>Performing computations on raster data sets is usually very efficient and faster than using vector data, this is due to the fact that rasters are stored in some kind of matrix formats with some extra information (such as the coordinate reference system and the origin of the raster). It this thus possible to use highly efficient linear algebra libraries. The mathematical operations performed on raster cells are called map algebra.</p>
<p>For this workshop we will use the <code>terra</code> package to work with raster data. This package has everything needed to import, analyses, visualize and export raster data sets. Like the <code>sf</code> package, it is also using the GDAL library for the import/export operations, which means it can open almost every raster data format. Unlike the <code>sf</code> package, <code>terra</code> will not import the full data sets in memory but only create a pointer to the data and then read smaller blocks of data successively. This allows working with very large rasters with a relatively small memory footprint. The amount of functions available in the <code>terra</code> package is similar to typical GIS software.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Rasters and R workspaces
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since <code>terra</code> only stores a pointer to the raster data set, this means the actual data set won’t be included if you save your session in an R workspace (.Rdata files). If you really want to include it in your workspace, you can use the <code>wrap()</code> function. Note that this is also needed if you want to pass raster data over a connection that serializes, e.g.&nbsp;to a computer cluster.</p>
</div>
</div>
<p>There is another famous R package to process raster data, the <code>stars</code> package. It is especially useful if you need to work with “irregular” rasters (sheared, curvilinear, etc.) or with complex datacubes. It is also tidyverse-friendly and the syntax is closed to the one use in <code>sf</code>. However the number of available functions is (still) much lower than in <code>terra</code>. If you need to use both packages, it is fortunately easy to convert raster objects from <code>terra</code> to <code>stars</code> (using the function <code>st_as_stars()</code>), and the other way round (using the function <code>rast()</code>).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
A bit of history
</div>
</div>
<div class="callout-body-container callout-body">
<p>A revolution happened in 2010 in the small world of R-Spatial when the <code>raster</code> package was released. People were able to perform analyses using raster data sets in R instead of using a standard GIS software. The package has been maintained during many years, and many functions were added. However its developer decided to create a new package from scratch in order to improve speed and memory efficiency, the <code>terra</code> package was born. You will often find a lot of R code using the <code>raster</code> package on the web. Fortunately it is quite easy to adapt code written for the <code>raster</code> package to <code>terra</code>. The functions have similar names (sometimes even identical) and everything that was available in <code>raster</code> should also be available in <code>terra</code>. Actually the recent versions of <code>raster</code> even use <code>terra</code> in the background instead of the original <code>raster</code> code.</p>
</div>
</div>
</section>
<section id="coordinate-reference-systems" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="coordinate-reference-systems"><span class="header-section-number">5</span> Coordinate reference systems</h2>
<p>The majority of normal people will get scared if there’s some problem to solve involving coordinate reference systems or projections. That’s why I will keep this part really short and only show you the stuff you will need to perform standard GIS analyses with R. If you want to read more about this (extremely interesting) topic, I invite to read the following book chapters: <a href="https://geocompr.robinlovelace.net/spatial-class.html#crs-intro" class="uri">https://geocompr.robinlovelace.net/spatial-class.html#crs-intro</a> and <a href="https://r-tmap.github.io/tmap-book/geodata.html#crs" class="uri">https://r-tmap.github.io/tmap-book/geodata.html#crs</a>.</p>
<p>There is a famous expression saying “spatial is special”… One of the main reasons is that such data will have an associated location and you thus need to a reference frame to describe this location. This reference frame is called a coordinate reference system (CRS) in the GIS world. CRSs can be either geographic or projected.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you’re working with GIS data, you should always know the CRS you’re using. Otherwise coordinates are just numbers without a reference frame. When you share GIS data, make sure the CRS is always defined in the data set or documented in some other way. The CRS of a vector data set can be queried with the <code>st_crs()</code> function, for a terra object you should use the <code>crs()</code> function.</p>
</div>
</div>
<p>A geographic CRS will identify locations on a spheroid or an ellipsoid using 2 values: latitude and longitude. The shape of the Earth is actually a geoid, but it is too complex to perform computations and thus one has to use approximations. The spheroid is making the assumptions that the Earth is a sphere, while the ellipsoid is a better approximation accounting for the fact that our planet is a bit compressed. Geographic coordinate systems are not using a projection! All the computations (distances, buffers, etc.) have to happen on the spheroid/ellipsoid which makes things more complex. It is easy to make mistakes when working with geographic CRSs, and even smart people fell in this trap (e.g.&nbsp;<a href="https://georeferenced.wordpress.com/2014/05/22/worldmapblunders" class="uri">https://georeferenced.wordpress.com/2014/05/22/worldmapblunders</a>).</p>
<p>Projected CRSs are based on geographic CRSs but include an additional projection step on a flat surface. When using a projected CRS, locations are described using Cartesian coordinates called easting and northing (x and y). Projecting a spherical or ellipsoidal surface on a plane will cause deformations. These will affect four properties of the surface: areas, distances, shapes and directions. A projected CRS can preserve only one or two of these properties. There exists a ton of different projections and all of them make different compromises, some are even totally useless (check this beautiful xkcd comic: <a href="https://xkcd.com/977" class="uri">https://xkcd.com/977</a>). Choosing a projection can be challenging, especially if your data covers a very large area. The following websites allow you to visualize the main projection types: <a href="https://www.geo-projections.com" class="uri">https://www.geo-projections.com</a> and <a href="https://map-projections.net/singleview.php" class="uri">https://map-projections.net/singleview.php</a>. The second website also provides a nice tool to visualize distortions called a Tissot indicatrix. Fortunately, if your data is within a “smallish” area, it is relatively easy to find a good projected CRS that has only minimal distortions. Almost every country has its own recommended projected CRS (or CRSs), and if your data covers several countries, you can use some UTM (Universal Transverse Mercator) coordinate systems.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is almost always easier to work with a projected CRS, except if your data is really global (or covering a really large area, like a continent). Moreover, most GIS software will (still) make the assumption that you’re data is on a flat plane, even if you’re working with a geographic CRS. The <code>sf</code> package is kind of an exception since it will actually perform calculations on a spheroid if you use a geographic CRS, thanks to the s2 library.</p>
</div>
</div>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The CRS used by almost all mapping websites (OpenStreetMap, Google Maps, etc.) should never be used for any analysis. It is a slightly modified version of the Mercator projection called Web Mercator or Pseudo-Mercator. It has some advantages allowing good visualization speed, but the distortions are massive. Check the following website: <a href="https://www.thetruesize.com" class="uri">https://www.thetruesize.com</a>.</p>
</div>
</div>
<p>With so many CRSs available, we need a way to classify them. That’s what the EPSG (European Petroleum Survey Group) started doing a few years ago. They collected and documented most available CRSs in a data set which is now called the EPSG Geodetic Parameter Dataset (<a href="https://epsg.org/home.html" class="uri">https://epsg.org/home.html</a>). In this data set, every CRS has a unique identification number that can be used in a GIS software instead of writing the full definition of the CRS. The best available transformations between CRSs are also defined. Sadly this data set is still missing a few interesting CRSs and was thus completed by other companies such as ESRI. This is the reason why you’ll sometimes see ESRI codes instead of EPSG for some CRSs. The following CRSs are the most important for us:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2056 (EPSG)</td>
<td>CH1903+/LV95</td>
<td>Projected CRS currently used in Switzerland</td>
</tr>
<tr class="even">
<td>21781 (EPSG)</td>
<td>CH1903/LV03</td>
<td>Former projected CRS used in Switzerland, you will still find data sets using this one</td>
</tr>
<tr class="odd">
<td>4326 (EPSG)</td>
<td>WGS84</td>
<td>Geographic CRS used for most global data sets, and by GPS devices</td>
</tr>
<tr class="even">
<td>3857 (EPSG)</td>
<td>Pseudo-Mercator</td>
<td>Projected CRS used by online maps</td>
</tr>
<tr class="odd">
<td>8857 (EPSG)</td>
<td>Equal Earth Greenwich</td>
<td>Nice equal-area projection for world maps</td>
</tr>
<tr class="even">
<td>54030 (ESRI)</td>
<td>Robinson</td>
<td>Aesthetically pleasing projection for world maps</td>
</tr>
</tbody>
</table>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Proj4strings
</div>
</div>
<div class="callout-body-container callout-body">
<p>When looking for examples on the web, you will often find code using what is called a proj4string to define a CRS or to reproject data. For example the proj4string for the current Swiss CRS looks like this: <code>+proj=somerc +lat_0=46.9524055555556 +lon_0=7.43958333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs +type=crs</code>. This was the standard way of describing CRSs until a few years ago. You should NOT use these strings, instead always use the EPSG number to be on the safe side. Otherwise you may get small to medium position errors when reprojecting your data.</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise (5 minutes)
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can easily inspect the way CRSs are stored in modern GIS software. For example if you want to inspect the current Swiss CRS, try <code>st_crs(2056)</code>. You will get the full description of the CRS. Try to understand some of the elements. If you use EPSG codes, you can simply enter the code as an integer, if it’s an ESRI code you should use <code>st_crs("ESRI:xxxxx")</code> where <code>xxxxx</code> is the ESRI code.</p>
</div>
</div>
</section>
<section id="tips-and-tricks-for-vectors" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="tips-and-tricks-for-vectors"><span class="header-section-number">6</span> Tips and tricks for vectors</h2>
<section id="reading-and-writing-vector-data" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="reading-and-writing-vector-data"><span class="header-section-number">6.1</span> Reading and writing vector data</h3>
<p>We had a look at the gory details of the internal structure <code>sf</code> objects. However most of the time you will not create such objects on your own but rather rely on the <code>sf</code> package to create the right structure when you import existing GIS data. The <code>sf</code> package is using the GDAL (Geospatial Data Abstraction Library) library to read and write GIS files, and this means you will be able to import almost all existing GIS vector formats. Note that the vector part of the GDAL library is often called OGR. Sometimes you will not get a standard GIS data set but a simple CSV (or Excel) file containing coordinates and related attributes. We will first see how to import these different data types in order to use them with the <code>sf</code> package, and then how to export <code>sf</code> objects in a standard GIS format.</p>
<section id="importing-a-geopackage" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="importing-a-geopackage"><span class="header-section-number">6.1.1</span> Importing a GeoPackage</h4>
<p>The GeoPackage format is the best available open format to store vector data. It is based on the SQLite database format which is probably one of the most used file-based database nowadays. You can think of it as a special folder containing one or several GIS data sets. Since we normally don’t know in advance if a GeoPackage contains one or more data sets, we first have to inspect it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_layers</span>(<span class="st">"data/geodata.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Driver: GPKG 
Available layers:
      layer_name     geometry_type features fields       crs_name
1        streets Multi Line String     7690      3 CH1903+ / LV95
2      landcover     Multi Polygon     1038      2 CH1903+ / LV95
3      buildings     Multi Polygon    14125      2 CH1903+ / LV95
4 municipalities     Multi Polygon        7      3 CH1903+ / LV95
5            wtf           Polygon        3      0 CH1903+ / LV95</code></pre>
</div>
</div>
<p>You should not always trust the reported number of features. Some GIS format such as the GeoPackage report this number, some don’t. If the GeoPackage was produced by a software that doesn’t properly implement the standard, the reported number of features can be wrong (but this shouldn’t have any other bad consequence). If you want to be sure to get the correct number, you can use the <code>do_count = TRUE</code> argument of the <code>st_layers()</code> function, but this will be slower.</p>
<p>To read the data, you use the <code>st_read()</code> function, the first argument is the path of the GeoPackage, and the second argument is the layer you want to import. The function will return a <code>sf</code> object. By default you’ll get some information about the data being imported. If you don’t need them, you can use the argument <code>quiet = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>muni <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geodata.gpkg"</span>, <span class="st">"municipalities"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `municipalities' from data source 
  `/Users/jguelat/Desktop/R-GIS/data/geodata.gpkg' using driver `GPKG'
Simple feature collection with 7 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2648317 ymin: 1213352 xmax: 2660750 ymax: 1227618
Projected CRS: CH1903+ / LV95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>streets <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geodata.gpkg"</span>, <span class="st">"streets"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>muni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 7 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2648317 ymin: 1213352 xmax: 2660750 ymax: 1227618
Projected CRS: CH1903+ / LV95
   bfs       name popsize                           geom
1 1093 Neuenkirch    7194 MULTIPOLYGON (((2654554 121...
2 1094    Nottwil    4089 MULTIPOLYGON (((2654554 121...
3 1102    Sempach    4186 MULTIPOLYGON (((2656062 121...
4 1095  Oberkirch    5014 MULTIPOLYGON (((2649729 122...
5 1084       Eich    1610 MULTIPOLYGON (((2654640 122...
6 1099   Schenkon    3088 MULTIPOLYGON (((2652397 122...
7 1103     Sursee   10382 MULTIPOLYGON (((2648801 122...</code></pre>
</div>
</div>
<p>We see some basic information about the data set, and the first features are shown as well with all the attributes. The municipalities data set in an extract of the swissBOUNDARIES3D provided by Swisstopo, the streets data set is an extract of the swissTLM3D also provided by Swisstopo.</p>
</section>
<section id="importing-a-shapefile" class="level4" data-number="6.1.2">
<h4 data-number="6.1.2" class="anchored" data-anchor-id="importing-a-shapefile"><span class="header-section-number">6.1.2</span> Importing a Shapefile</h4>
<p>If you really need to import a Shapefile, you can use the same function. Since Shapefiles cannot contain more than one data set, we only need to provide the first argument of the function. A Shapefile consists of several file with different extensions (.shp, .shx, etc.), we use the .shp extension by default when importing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>muni2 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/municipalities.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>muni2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 7 features and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 2648317 ymin: 1213352 xmax: 2660750 ymax: 1227618
Projected CRS: CH1903+ / LV95
  fid  bfs       name                       geometry
1   1 1093 Neuenkirch POLYGON ((2654554 1217985, ...
2   2 1094    Nottwil POLYGON ((2654554 1217985, ...
3   3 1102    Sempach POLYGON ((2656062 1219916, ...
4   4 1095  Oberkirch POLYGON ((2649729 1221262, ...
5   5 1084       Eich POLYGON ((2654640 1224638, ...
6   6 1099   Schenkon POLYGON ((2652397 1224195, ...
7   7 1103     Sursee POLYGON ((2648801 1225672, ...</code></pre>
</div>
</div>
<p>This is actually the same data set as the one in the GeoPackage, however we seen that <code>sf</code> is now using polygons instead of multipolygons. This is caused by the fact that the Shapefile format does not distinguish properly between the two types. You can thus have a combination of polygons and multipolygons in the same data set.</p>
</section>
<section id="importing-from-a-postgis-database" class="level4" data-number="6.1.3">
<h4 data-number="6.1.3" class="anchored" data-anchor-id="importing-from-a-postgis-database"><span class="header-section-number">6.1.3</span> Importing from a PostGIS database</h4>
<p>PostGIS is a famous open-source extension for the PostgreSQL database management system. It allows storing all kind of GIS data inside a database and perform hundreds of typical GIS analyses. The Swiss Ornithological Institute is using PostGIS to store almost all its bird data and a lot of other GIS data sets. If you have a laptop provided by the institute and you have access to the institute internal network (via cable or private Wi-Fi, not the public one), you should be able to run the following code.</p>
<p>First we need to load the <code>RPostgres</code> package which provides function to access PostgreSQL databases (and hence PostGIS, too). There is another package providing similar functionality called <code>RPostgreSQL</code>, but in my opinion the <code>RPostgres</code> is better maintained and I experienced less problems.</p>
<p>After storing all the connection details in some variables, we can finally create a connection to the database using the <code>dbConnect()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Login data</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>user <span class="ot">&lt;-</span> <span class="st">"gast_vowa"</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>password <span class="ot">&lt;-</span> <span class="fu">scan</span>(<span class="st">"/Users/jguelat/Desktop/pass.txt"</span>, <span class="at">what =</span> <span class="st">"character"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>host <span class="ot">&lt;-</span> <span class="st">"dbspatialdata1"</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>database <span class="ot">&lt;-</span> <span class="st">"research"</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Connection to the database</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>dbcon <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">Postgres</span>(), <span class="at">dbname =</span> database, <span class="at">host =</span> host, <span class="at">user =</span> user, <span class="at">password =</span> password)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After that we need to import the data with a query, using again the <code>st_read()</code> function. Note that the first argument of the function must be the database connection object. The first possibility consists of importing the whole layer (called table in the database lingo) with all its attributes. This is what we do for the <code>cantons1</code> data set. We need to use the <code>Id()</code> function to specify the location of the table inside the database. In a PostgreSQL database, a schema is a bit like a folder where we store tables, this allows us to implement some structure inside the database. In our case the table <code>cantonal_boundaries_ch</code> is stored inside the schema <code>perimeter</code>. Note that we don’t need the <code>Id()</code> function if the table are stored in the <code>public</code> schema.</p>
<p>We can also specify a SQL query to import the data, like for the <code>cantons2</code> data set. Using this kind of query, we are fully flexible. We can for example specify the attributes we want to import, specific data filters, we can even join different tables together (by attributes or even spatially). Once again we have to specify the schema, but this is done a bit differently.</p>
<p>Once we have our <code>sf</code> objects, we still need to disconnect the database. The cantonal_boundaries_ch data set contains all the cantonal boundaries in Switzerland. The data is provided by Swisstopo (swissBOUNDARIES3D).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load cantonal boundaries</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>cantons1 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(dbcon, <span class="at">layer =</span> <span class="fu">Id</span>(<span class="at">schema =</span> <span class="st">"perimeter"</span>, <span class="at">table =</span> <span class="st">"cantonal_boundaries_ch"</span>))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>cantons2 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(dbcon, <span class="at">query =</span> <span class="st">"SELECT id, name, geom</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="st">                                    FROM perimeter.cantonal_boundaries_ch</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="st">                                    WHERE name = 'Fribourg'"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Disconnect database</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(dbcon)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Show sf objects</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>cantons1</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>cantons2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-a-csv-file-with-coordinates" class="level4" data-number="6.1.4">
<h4 data-number="6.1.4" class="anchored" data-anchor-id="importing-a-csv-file-with-coordinates"><span class="header-section-number">6.1.4</span> Importing a CSV file with coordinates</h4>
<p>If you have a table containing coordinates of point data (e.g.&nbsp;sites or bird sightings), you should use the <code>st_as_sf()</code> function. The first argument should be the dataframe containing the data, and you also need to specify the names of the columns containing the geographic coordinates, and the CRS used. This data set was extracted from the bird sightings database of the Swiss Ornithological Institute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/observations.csv"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  species_id               name       date       x       y
1       4240 Eurasian Blackbird 2022-04-12 2658433 1220946
2       3800  Eurasian Blue Tit 2022-04-12 2658442 1221138
3       4240 Eurasian Blackbird 2022-05-09 2658607 1221189
4       4240 Eurasian Blackbird 2022-05-09 2658597 1221137
5       4240 Eurasian Blackbird 2022-05-09 2658569 1220956
6       3800  Eurasian Blue Tit 2022-05-09 2658476 1220904</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(obs, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 530 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2649549 ymin: 1218571 xmax: 2660110 ymax: 1225531
Projected CRS: CH1903+ / LV95
First 10 features:
   species_id               name       date                geometry
1        4240 Eurasian Blackbird 2022-04-12 POINT (2658433 1220946)
2        3800  Eurasian Blue Tit 2022-04-12 POINT (2658442 1221138)
3        4240 Eurasian Blackbird 2022-05-09 POINT (2658607 1221189)
4        4240 Eurasian Blackbird 2022-05-09 POINT (2658597 1221137)
5        4240 Eurasian Blackbird 2022-05-09 POINT (2658569 1220956)
6        3800  Eurasian Blue Tit 2022-05-09 POINT (2658476 1220904)
7        4240 Eurasian Blackbird 2022-05-09 POINT (2658514 1221205)
8        3800  Eurasian Blue Tit 2022-05-09 POINT (2658517 1221195)
9        4240 Eurasian Blackbird 2022-05-23 POINT (2658570 1221219)
10       4240 Eurasian Blackbird 2022-05-23 POINT (2658455 1220911)</code></pre>
</div>
</div>
</section>
<section id="exporting-to-geopackage" class="level4" data-number="6.1.5">
<h4 data-number="6.1.5" class="anchored" data-anchor-id="exporting-to-geopackage"><span class="header-section-number">6.1.5</span> Exporting to GeoPackage</h4>
<p>To export vector data, you need to use the <code>st_write()</code> function. Like the <code>st_read()</code> function, it uses the GDAL library, so you’ll be able to export in many different formats. You can specify the format explicitely, otherwise <code>sf</code> will try to guess it based on the file extension. For a GeoPackage, you need to specify the name of the GeoPackage first (it will be automatically created if it doesn’t exist) and the name of the data set that will be stored inside the GeoPackage. If you specify a GeoPackage that already exists, the data set will be added to it as a new table.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(obs, <span class="st">"export/birds.gpkg"</span>, <span class="st">"observations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Writing layer `observations' to data source `export/birds.gpkg' using driver `GPKG'
Writing 530 features with 3 fields and geometry type Point.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>obs2 <span class="ot">&lt;-</span> obs[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(obs2, <span class="st">"export/birds.gpkg"</span>, <span class="st">"observations2"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_layers</span>(<span class="st">"export/birds.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Driver: GPKG 
Available layers:
     layer_name geometry_type features fields       crs_name
1  observations         Point      530      3 CH1903+ / LV95
2 observations2         Point       10      3 CH1903+ / LV95</code></pre>
</div>
</div>
<p>If you want to delete a data set, you can use the <code>st_delete()</code> function. Think twice before doing it, there will be no warning!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_delete</span>(<span class="st">"export/birds.gpkg"</span>, <span class="st">"observations2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Deleting layer `observations2' using driver `GPKG'</code></pre>
</div>
</div>
</section>
<section id="exporting-to-shapefile" class="level4" data-number="6.1.6">
<h4 data-number="6.1.6" class="anchored" data-anchor-id="exporting-to-shapefile"><span class="header-section-number">6.1.6</span> Exporting to Shapefile</h4>
<p>Please don’t!</p>
</section>
</section>
<section id="basic-geometric-computations" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="basic-geometric-computations"><span class="header-section-number">6.2</span> Basic geometric computations</h3>
<p>In this section we’ll see how to perform some basic geometric computations on spatial data. For example let’s how we can compute the area of polygons of the length of lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_area</span>(muni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m^2]
[1] 26267403 14834107 11676584 10954968  9218391  7710103  6050585</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">st_length</span>(streets))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m]
[1] 1915.1026  378.9425  345.9435 1836.5854  901.2759  232.4974</code></pre>
</div>
</div>
<p>Note that the results always have a unit of measurement. This is a feature that is provided by <code>sf</code> and will occur will all functions giving some sort of measurement. This is compatible with the <code>units</code> package which allows easy conversions between different unit types. However this can sometimes be a problem if you need a “raw” value. In this case you can use the <code>as.numeric()</code> function to remove the units.</p>
<p>For some strange reason, there is no function in <code>sf</code> to compute the perimeter of polygons. To do that you’ll need the <code>st_perimeter()</code> function in the <code>lwgeom</code> package which gives access to some functions available in the PostGIS database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lwgeom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to liblwgeom 3.0.0beta1 r16016, GEOS 3.11.0, PROJ 9.1.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_perimeter</span>(muni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m]
[1] 29717.62 17281.70 16758.24 15754.38 14897.75 15462.88 13398.87</code></pre>
</div>
</div>
<p>Computing the centroid of polygons is another useful operation that is easily computed using the <code>st_centroid()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>muni_centroid <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(muni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_centroid.sf(muni): st_centroid assumes attributes are constant
over geometries of x</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni_centroid), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Sometimes we also need to know the coordinates of the <code>sf</code> objects we’re using. For points we of course get the coordinates of the points, for lines and polygons we get the coordinates of the vertices, with additional columns showing how to reconstruct the features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_coordinates</span>(muni_centroid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        X       Y
1 2657961 1217280
2 2653276 1220227
3 2657334 1221089
4 2650683 1222874
5 2655114 1223114
6 2652705 1225584
7 2650517 1225371</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">st_coordinates</span>(muni))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           X       Y L1 L2 L3
[1,] 2654554 1217985  1  1  1
[2,] 2654481 1218031  1  1  1
[3,] 2654492 1218051  1  1  1
[4,] 2654495 1218063  1  1  1
[5,] 2654493 1218067  1  1  1
[6,] 2654494 1218083  1  1  1</code></pre>
</div>
</div>
<p>Centroid can be used to place labels inside polygons, but don’t forget that polygons with strange shapes may not contain their centroid. If for some reason you need to be sure to have the point inside the polygon, use the <code>st_point_on_surface()</code> function.</p>
<p>Unfortunately geometric computations are not always that easy… Let’s have a look at another example. We load another polygon layer and try to compute the area of each polygon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geodata.gpkg"</span>, <span class="st">"wtf"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp, <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(temp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_area</span>(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m^2]
[1] 547988.3 200939.1      0.0</code></pre>
</div>
</div>
<p>Oops, these polygons look big enough but one of them seems to have an area of 0… Why is this happening? We need to talk a bit about geometric validity…</p>
</section>
<section id="geometric-validity" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="geometric-validity"><span class="header-section-number">6.3</span> Geometric validity</h3>
<p>When we had a look a the vector data model, we discovered the Simple Feature standard but we forgot an important part: geometric validity. Validity is defined a bit differently depending on the geometry engine used for the computations. First the good news: points are always valid! Lines are always valid for the GEOS engine used by <code>sf</code> but they are considered invalid by QGIS if they have self-intersections (such lines are called non-simple). Polygons are definitely invalid if they have self-intersections (like our example). The other invalid cases are shown on this website: <a href="https://postgis.net/docs/using_postgis_dbmanagement.html#Valid_Geometry" class="uri">https://postgis.net/docs/using_postgis_dbmanagement.html#Valid_Geometry</a>. Using invalid geometries can be problematic for some analyses, such as computing areas.</p>
<p>Normally we should expect official data sets to be valid but this is often not the case. You can check the validity of each feature using the <code>st_is_valid()</code> function. If you want a short description of the problems, you can add the argument <code>reason = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>temp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 0 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 2656313 ymin: 1219730 xmax: 2659317 ymax: 1221618
Projected CRS: CH1903+ / LV95
                            geom
1 POLYGON ((2656382 1221396, ...
2 POLYGON ((2656903 1220285, ...
3 POLYGON ((2658317 1221618, ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_valid</span>(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_valid</span>(temp, <span class="at">reason =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Valid Geometry"                        
[2] "Valid Geometry"                        
[3] "Self-intersection[2658817 1221117.875]"</code></pre>
</div>
</div>
<p>If there are only a few invalid features, we can correct them manually in QGIS. But sometimes this is not feasible and we need some automatic way of correcting. This is where the <code>st_make_valid()</code> function shines. Even though it’s fully automatic, it will perform the appropriate changes 99% of the time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>temp_valid <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(temp)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_valid</span>(temp_valid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>temp_valid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 0 fields
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: 2656313 ymin: 1219730 xmax: 2659317 ymax: 1221618
Projected CRS: CH1903+ / LV95
                            geom
1 POLYGON ((2656382 1221396, ...
2 POLYGON ((2656903 1220285, ...
3 MULTIPOLYGON (((2658317 122...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry_type</span>(temp_valid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] POLYGON      POLYGON      MULTIPOLYGON
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry_type</span>(temp_valid, <span class="at">by_geometry =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] GEOMETRY
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
</div>
<p>When we look at the corrected data set, we see that the invalid polygon was converted to a multipolygon. We can also check it using the <code>st_geometry_type()</code> function. This is however a problem since we normally don’t want a data set with mixed geometry types. When we use the <code>by_geometry = FALSE</code> argument, we see that <code>sf</code> is now using a generic GEOMETRY type for the data set. The solution would be to convert all the other polygons to multipolygons.</p>
</section>
<section id="vector-type-casting" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="vector-type-casting"><span class="header-section-number">6.4</span> Vector type casting</h3>
<p>Changing the type of vector features is done with the <code>st_cast()</code> function. We can now solve our previous problem and convert everything to multipolygons (the existing multipolygon will be left untouched). Using the <code>st_as_text()</code> function we can see the WKT representation of the features geometry, and confirm that we’re now using the same vector type for all features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>temp_multipoly <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(temp_valid, <span class="at">to =</span> <span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_text</span>(<span class="fu">st_geometry</span>(temp_valid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "POLYGON ((2656382 1221396, 2657007 1221587, 2657250 1221414, 2657389 1221014, 2656730 1220824, 2656313 1221084, 2656382 1221396))"                            
[2] "POLYGON ((2656903 1220285, 2657441 1220077, 2657632 1220459, 2657754 1220129, 2657458 1219730, 2656903 1220285))"                                             
[3] "MULTIPOLYGON (((2658317 1221618, 2658817 1221118, 2658317 1220618, 2658317 1221618)), ((2658817 1221118, 2659317 1221618, 2659317 1220618, 2658817 1221118)))"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_text</span>(<span class="fu">st_geometry</span>(temp_multipoly))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MULTIPOLYGON (((2656382 1221396, 2657007 1221587, 2657250 1221414, 2657389 1221014, 2656730 1220824, 2656313 1221084, 2656382 1221396)))"                     
[2] "MULTIPOLYGON (((2656903 1220285, 2657441 1220077, 2657632 1220459, 2657754 1220129, 2657458 1219730, 2656903 1220285)))"                                      
[3] "MULTIPOLYGON (((2658317 1221618, 2658817 1221118, 2658317 1220618, 2658317 1221618)), ((2658817 1221118, 2659317 1221618, 2659317 1220618, 2658817 1221118)))"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry_type</span>(temp_multipoly, <span class="at">by_geometry =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] MULTIPOLYGON
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
</div>
<p>We can go a bit further and convert our multipolygons to other types… Note: for some reasons, it is not possible to convert a multipolygon directly to a line. You’ll need to convert it to a multiline object first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>temp_poly <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(temp_multipoly, <span class="at">to =</span> <span class="st">"POLYGON"</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>temp_multiline <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(temp_multipoly, <span class="at">to =</span> <span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>temp_line <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(temp_multiline, <span class="at">to =</span> <span class="st">"LINESTRING"</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>temp_multipts <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(temp_multipoly, <span class="at">to =</span> <span class="st">"MULTIPOINT"</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>temp_pts <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(temp_multipoly, <span class="at">to =</span> <span class="st">"POINT"</span>)</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>temp_poly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 0 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 2656313 ymin: 1219730 xmax: 2659317 ymax: 1221618
Projected CRS: CH1903+ / LV95
                            geom
1 POLYGON ((2656382 1221396, ...
2 POLYGON ((2656903 1220285, ...
3 POLYGON ((2658317 1221618, ...
4 POLYGON ((2658817 1221118, ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>temp_multiline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 0 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 2656313 ymin: 1219730 xmax: 2659317 ymax: 1221618
Projected CRS: CH1903+ / LV95
                            geom
1 MULTILINESTRING ((2656382 1...
2 MULTILINESTRING ((2656903 1...
3 MULTILINESTRING ((2658317 1...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>temp_line</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 0 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 2656313 ymin: 1219730 xmax: 2659317 ymax: 1221618
Projected CRS: CH1903+ / LV95
                            geom
1 LINESTRING (2656382 1221396...
2 LINESTRING (2656903 1220285...
3 LINESTRING (2658317 1221618...
4 LINESTRING (2658817 1221118...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>temp_multipts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 3 features and 0 fields
Geometry type: MULTIPOINT
Dimension:     XY
Bounding box:  xmin: 2656313 ymin: 1219730 xmax: 2659317 ymax: 1221618
Projected CRS: CH1903+ / LV95
                            geom
1 MULTIPOINT ((2656382 122139...
2 MULTIPOINT ((2656903 122028...
3 MULTIPOINT ((2658317 122161...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>temp_pts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 21 features and 0 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2656313 ymin: 1219730 xmax: 2659317 ymax: 1221618
Projected CRS: CH1903+ / LV95
First 10 features:
                      geom
1  POINT (2656382 1221396)
2  POINT (2657007 1221587)
3  POINT (2657250 1221414)
4  POINT (2657389 1221014)
5  POINT (2656730 1220824)
6  POINT (2656313 1221084)
7  POINT (2656382 1221396)
8  POINT (2656903 1220285)
9  POINT (2657441 1220077)
10 POINT (2657632 1220459)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(temp_multipoly), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(temp_multipoly))</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(temp_poly), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(temp_poly))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(temp_multiline), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(temp_multiline))</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(temp_line), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(temp_line))</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(temp_multipts), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(temp_multipts), <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(temp_pts), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(temp_pts), <span class="at">pch =</span> <span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is of course not possible to convert points to polygons, but if you have a line or multiline geometry forming a closed ring, we can easily convert it to a polygon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>sempach_multiline <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(muni[<span class="fu">which</span>(muni<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Sempach"</span>),], <span class="at">to =</span> <span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(sempach_multiline), <span class="at">col =</span> <span class="st">"navy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>sempach_poly <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(sempach_multiline, <span class="at">to =</span> <span class="st">"POLYGON"</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(sempach_poly), <span class="at">col =</span> <span class="st">"navy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise (5 minutes)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a new object containing only the polygon for Sursee, check its validity and compute its perimeter using the <code>st_length()</code> function, compare with the result of the <code>st_perimeter()</code> function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>sursee_poly <span class="ot">&lt;-</span> muni[<span class="fu">which</span>(muni<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Sursee"</span>),]</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>sursee_multiline <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(sursee_poly, <span class="at">to =</span> <span class="st">"MULTILINESTRING"</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_length</span>(sursee_multiline)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="fu">st_perimeter</span>(sursee_poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="spatial-predicates" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="spatial-predicates"><span class="header-section-number">6.5</span> Spatial predicates</h3>
<p>Topology describes the spatial relationships between vector objects. Two features can for example intersect, or one feature can contain another. The existence of such relationships between features is tested by functions called spatial (binary) predicates. Many are available in the <code>sf</code> package, use <code>?geos_binary_pred</code> if you want to see the full list.</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When using spatial predicates you must be sure that both objects use the same CRS.</p>
</div>
</div>
<p>We can for example easily test which bird sightings are in Sempach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>sempach <span class="ot">&lt;-</span> muni[muni<span class="sc">$</span>name<span class="sc">==</span><span class="st">"Sempach"</span>,]</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>obs_in_sempach <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(obs, sempach)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>obs_in_sempach</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sparse geometry binary predicate list of length 530, where the
predicate was `intersects'
first 10 elements:
 1: 1
 2: 1
 3: 1
 4: 1
 5: 1
 6: 1
 7: 1
 8: 1
 9: 1
 10: 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lengths</span>(obs_in_sempach) <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Mode   FALSE    TRUE 
logical     222     308 </code></pre>
</div>
</div>
<p>The output is stored in an memory efficient sparse matrix format which not easily readable by humans. We can use the <code>sparse = FALSE</code> argument to get a non-sparse matrix and perform standard operations (e.g.&nbsp;computing the number of sightings in Sempach).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>obs_in_sempach <span class="ot">&lt;-</span> <span class="fu">st_intersects</span>(obs, sempach, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(obs_in_sempach)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        [,1]
[525,] FALSE
[526,] FALSE
[527,]  TRUE
[528,] FALSE
[529,]  TRUE
[530,] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(obs_in_sempach)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 308</code></pre>
</div>
</div>
<p>Using another predicate (<code>st_disjoint</code>), we can get a list of all sightings that are in other municipalities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>obs_not_in_sempach <span class="ot">&lt;-</span> <span class="fu">st_disjoint</span>(obs, sempach, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(obs_not_in_sempach)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 222</code></pre>
</div>
</div>
<p>We can easily find all the sightings that are located within 1km of the Swiss Ornithological Institute.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>soi <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(2657271 1219754)"</span>, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_is_within_distance</span>(soi, obs, <span class="at">dist =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sparse geometry binary predicate list of length 1, where the predicate
was `is_within_distance'
 1: 62, 63, 89, 90, 92, 113, 114, 123, 135, 136, ...</code></pre>
</div>
</div>
<p>Things can get a bit more complex when the two elements used inside the predicate contain multiple feature. In this example we test for intersections between two municipalities and all the highway segments stored in the streets data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>muni_extract <span class="ot">&lt;-</span> muni[<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>,]</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>highways <span class="ot">&lt;-</span> streets[streets<span class="sc">$</span>type <span class="sc">==</span> <span class="dv">2</span>,]</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_intersects</span>(muni_extract, highways)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sparse geometry binary predicate list of length 2, where the predicate
was `intersects'
 1: 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, ...
 2: 1, 2, 3, 4, 5, 19, 20, 58</code></pre>
</div>
</div>
<p>Don’t hesitate to try other predicate (e.g.&nbsp;<code>st_within()</code>, <code>st_contains()</code>). The difference between some of them is sometimes quite subtle. If you need even more flexibility you should use the <code>st_relate()</code> function. This flexibility comes with a price, <code>st_relate()</code> is much slower since it doesn’t use spatial indices. If you want an in-depth explanation of all the possibilities, you should check the following website: <a href="https://en.wikipedia.org/wiki/DE-9IM" class="uri">https://en.wikipedia.org/wiki/DE-9IM</a>.</p>
</section>
<section id="spatial-subsetting" class="level3" data-number="6.6">
<h3 data-number="6.6" class="anchored" data-anchor-id="spatial-subsetting"><span class="header-section-number">6.6</span> Spatial subsetting</h3>
<p>Now that we know how to test different topological properties, we can use them to subset data spatially. The <code>sf</code> package allows doing that using the usual <code>[]</code> notation. This is how we create a new <code>sf</code> object containing only the sightings in Sempach. The st_intersects predicate is used by default if you don’t specify anything.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>obs_in_sempach <span class="ot">&lt;-</span> obs[sempach,]</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalent to</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>obs_in_sempach <span class="ot">&lt;-</span> obs[sempach, , op <span class="ot">=</span> st_intersects]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The empty argument can be used to specify the desired attribute columns.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise (5 minutes)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Within a 2 km radius around Swiss Ornithological Institute, how many bird sightings are in Neuenkirch? Try to make a map of the municipalities with the filtered sightings.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>neuenkirch <span class="ot">&lt;-</span> muni[<span class="fu">which</span>(muni<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Neuenkirch"</span>),]</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>obs_within_2000m <span class="ot">&lt;-</span> obs[soi, , op <span class="ot">=</span> st_is_within_distance, dist <span class="ot">=</span> <span class="dv">1000</span>]</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>obs_filtered <span class="ot">&lt;-</span> obs_within_2000m[neuenkirch,]</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(b)</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(obs_filtered), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="spatial-joins" class="level3" data-number="6.7">
<h3 data-number="6.7" class="anchored" data-anchor-id="spatial-joins"><span class="header-section-number">6.7</span> Spatial joins</h3>
<p>We’ve already seen how to join a spatial object to another table using attributes. Now we’ll do something similar but instead of using attributes, we’ll perform the join between to spatial objects based on their topological relationships. As a first example we will join the bird sightings data set with the municipalities data set. As output we will get the bird sightings with additional attributes corresponding to their respective municipality. We’ll do this using the <code>st_join()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>obs_muni <span class="ot">&lt;-</span> <span class="fu">st_join</span>(obs, muni, <span class="at">join =</span> st_intersects)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>obs_muni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 530 features and 6 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2649549 ymin: 1218571 xmax: 2660110 ymax: 1225531
Projected CRS: CH1903+ / LV95
First 10 features:
   species_id             name.x       date  bfs  name.y popsize
1        4240 Eurasian Blackbird 2022-04-12 1102 Sempach    4186
2        3800  Eurasian Blue Tit 2022-04-12 1102 Sempach    4186
3        4240 Eurasian Blackbird 2022-05-09 1102 Sempach    4186
4        4240 Eurasian Blackbird 2022-05-09 1102 Sempach    4186
5        4240 Eurasian Blackbird 2022-05-09 1102 Sempach    4186
6        3800  Eurasian Blue Tit 2022-05-09 1102 Sempach    4186
7        4240 Eurasian Blackbird 2022-05-09 1102 Sempach    4186
8        3800  Eurasian Blue Tit 2022-05-09 1102 Sempach    4186
9        4240 Eurasian Blackbird 2022-05-23 1102 Sempach    4186
10       4240 Eurasian Blackbird 2022-05-23 1102 Sempach    4186
                  geometry
1  POINT (2658433 1220946)
2  POINT (2658442 1221138)
3  POINT (2658607 1221189)
4  POINT (2658597 1221137)
5  POINT (2658569 1220956)
6  POINT (2658476 1220904)
7  POINT (2658514 1221205)
8  POINT (2658517 1221195)
9  POINT (2658570 1221219)
10 POINT (2658455 1220911)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(obs_muni<span class="sc">$</span>name.y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      Eich Neuenkirch    Nottwil  Oberkirch   Schenkon    Sempach     Sursee 
         7         52         10         86         11        308         56 </code></pre>
</div>
</div>
<p>In this example both data sets have an attributed called “name”. When we join them together, R is automatically renaming these columns to “name.x” and “name.y”. The “x” and “y” corresponds to the order of the data sets when calling the <code>st_join()</code> function.</p>
<p>Let’s try another spatial join, this time we will join the sightings with a landcover data set, which is an extract of the swissTLM3D data set provided by Swisstopo. The goal of the analysis it to add a new attribute to the bird sightings data set corresponding to the landcover value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>landcover <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geodata.gpkg"</span>, <span class="st">"landcover"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>obs_landcover <span class="ot">&lt;-</span> <span class="fu">st_join</span>(obs, landcover, <span class="at">join =</span> st_intersects)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>obs_landcover</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 548 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2649549 ymin: 1218571 xmax: 2660110 ymax: 1225531
Projected CRS: CH1903+ / LV95
First 10 features:
   species_id               name       date type year                geometry
1        4240 Eurasian Blackbird 2022-04-12   NA   NA POINT (2658433 1220946)
2        3800  Eurasian Blue Tit 2022-04-12   14 2013 POINT (2658442 1221138)
3        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658607 1221189)
4        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658597 1221137)
5        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658569 1220956)
6        3800  Eurasian Blue Tit 2022-05-09   10 2013 POINT (2658476 1220904)
7        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658514 1221205)
8        3800  Eurasian Blue Tit 2022-05-09   12 2013 POINT (2658517 1221195)
9        4240 Eurasian Blackbird 2022-05-23   12 2013 POINT (2658570 1221219)
10       4240 Eurasian Blackbird 2022-05-23   NA   NA POINT (2658455 1220911)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(obs_landcover<span class="sc">$</span>type, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   6   10   11   12   14 &lt;NA&gt; 
   4   19   55   55   54  361 </code></pre>
</div>
</div>
<p>By default the <code>st_join()</code> function will use <code>st_intersects</code> as a predicate, but you can of course specify a different one. Moreover it performs what is called a left join, which means the output will contain all rows from the first object (<code>obs</code> in our example). It is also possible to perform an inner join by adding the attribute <code>left = FALSE</code>. In this case the output will contain only the rows for which a value was found (i.e.&nbsp;where a spatial match occurred).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>obs_landcover_inner <span class="ot">&lt;-</span> <span class="fu">st_join</span>(obs, landcover, <span class="at">join =</span> st_intersects, <span class="at">left =</span> <span class="cn">FALSE</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>obs_landcover_inner</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 187 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2649549 ymin: 1218822 xmax: 2659732 ymax: 1225026
Projected CRS: CH1903+ / LV95
First 10 features:
     species_id               name       date type year                geometry
2          3800  Eurasian Blue Tit 2022-04-12   14 2013 POINT (2658442 1221138)
3          4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658607 1221189)
4          4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658597 1221137)
5          4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658569 1220956)
6          3800  Eurasian Blue Tit 2022-05-09   10 2013 POINT (2658476 1220904)
7          4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658514 1221205)
8          3800  Eurasian Blue Tit 2022-05-09   12 2013 POINT (2658517 1221195)
9          4240 Eurasian Blackbird 2022-05-23   12 2013 POINT (2658570 1221219)
11         4240 Eurasian Blackbird 2022-06-06   11 2013 POINT (2658530 1220902)
11.1       4240 Eurasian Blackbird 2022-06-06    6 2013 POINT (2658530 1220902)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(obs_landcover_inner<span class="sc">$</span>type, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   6   10   11   12   14 &lt;NA&gt; 
   4   19   55   55   54    0 </code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise (5 minutes)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Have a look at the number of features (rows) of the original <code>obs</code> data set and compare it with the number of features of the <code>obs_landcover</code> data set. Why are they different?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(obs)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(obs_landcover)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This difference is caused by overlapping polygons in the landcover data set. If a bird sighting</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co"># is inside 2 polygons, the st_join() function will create 2 rows (one row for each intersecting polygon).</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This means some sightings will be duplicated. We call this kind of joins "one-to-many".</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co"># You can find these duplicated sightings by looking at the row names with the rownames() function, or by</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="co"># adding an unique ID to all the sightings before the spatial join and then looking for duplicated IDs.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>Since the landcover data is not a complete coverage of our study area, which leads to NA values in our joined data set, we can maybe try to get more complete results by using another spatial predicate. The <code>st_nearest_feature</code> predicate will join the sightings to the nearest landcover polygon. Polygons containing points will be considered to be the closest ones. I honestly don’t know what is happening when a point is within two overlapping polygons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>obs_landcover2 <span class="ot">&lt;-</span> <span class="fu">st_join</span>(obs, landcover, <span class="at">join =</span> st_nearest_feature)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>obs_landcover2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 530 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 2649549 ymin: 1218571 xmax: 2660110 ymax: 1225531
Projected CRS: CH1903+ / LV95
First 10 features:
   species_id               name       date type year                geometry
1        4240 Eurasian Blackbird 2022-04-12   11 2013 POINT (2658433 1220946)
2        3800  Eurasian Blue Tit 2022-04-12   14 2013 POINT (2658442 1221138)
3        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658607 1221189)
4        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658597 1221137)
5        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658569 1220956)
6        3800  Eurasian Blue Tit 2022-05-09   10 2013 POINT (2658476 1220904)
7        4240 Eurasian Blackbird 2022-05-09   12 2013 POINT (2658514 1221205)
8        3800  Eurasian Blue Tit 2022-05-09   12 2013 POINT (2658517 1221195)
9        4240 Eurasian Blackbird 2022-05-23   12 2013 POINT (2658570 1221219)
10       4240 Eurasian Blackbird 2022-05-23   10 2013 POINT (2658455 1220911)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(obs_landcover2<span class="sc">$</span>type, <span class="at">useNA =</span> <span class="st">"always"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   6   10   11   12   14 &lt;NA&gt; 
   8  144   63   58  257    0 </code></pre>
</div>
</div>
<p>In this example we joined a point data set to a polygon data set and this is the most common application for a spatial join. However we’re not restricted to these combinations, we can join all the vector types (e.g.&nbsp;polygons with polygons). If you’re joining polygons to polygons, <code>st_join()</code> is also able to perform joins based on the maximum area overlay (it joins with the polygon having the largest overlap). To do this, you need to add the <code>largest = TRUE</code> argument.</p>
</section>
<section id="distance-operations" class="level3" data-number="6.8">
<h3 data-number="6.8" class="anchored" data-anchor-id="distance-operations"><span class="header-section-number">6.8</span> Distance operations</h3>
<p>Calculating distances between <code>sf</code> objects is done with the <code>st_distance()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(obs[<span class="dv">1</span>,], soi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m]
         [,1]
[1,] 1664.665</code></pre>
</div>
</div>
<p>Once again, we see that <code>sf</code> is using units. We also note that the results are stored in a matrix instead of a vector. This format is actually needed since <code>st_distance()</code> can also be used to compute all the distance combinations between two <code>sf</code> objects containing multiple features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_distance</span>(obs[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,], muni[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m]
         [,1]     [,2] [,3]
[1,] 438.6257 2585.144    0
[2,] 424.5501 2675.472    0
[3,] 254.1488 2845.707    0
[4,] 286.7366 2813.814    0
[5,] 302.5583 2714.238    0</code></pre>
</div>
</div>
<p>We will now make a short excursion in the world of geographic CRS with a quick example showing what <code>sf</code> is doing when we don’t use standard Euclidean geometry. We will compute the distance between the centroids of Switzerland and Australia. By default <code>sf</code> is using the <code>s2</code> library to perform its computation on a spheroid when we use a geographic CRS. However for distances, it is possible to obtain a better approximation by using an ellipsoid. To do this, we need to tell <code>sf</code> not to use <code>s2</code> and the <code>st_distance()</code> will use a more precise algorithm. We can of course compare the two estimates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>world_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(World)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_centroid.sf(World): st_centroid assumes attributes are constant
over geometries of x</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>pt1 <span class="ot">&lt;-</span> world_centroids[world_centroids<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Switzerland"</span>,]</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>pt2 <span class="ot">&lt;-</span> world_centroids[world_centroids<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Australia"</span>,]</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Spherical geometry (s2) switched off</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>(d1 <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(pt1, pt2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m]
         [,1]
[1,] 14776827</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Spherical geometry (s2) switched on</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>(d2 <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(pt1, pt2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m]
         [,1]
[1,] 14779867</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="sc">-</span> d1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Units: [m]
        [,1]
[1,] 3039.98</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="buffers" class="level3" data-number="6.9">
<h3 data-number="6.9" class="anchored" data-anchor-id="buffers"><span class="header-section-number">6.9</span> Buffers</h3>
<p>Buffering objects is one of the most common operations in GIS. A buffer is a polygon showing the area within a given distance of a spatial object. You can buffer all the existing vector types with the <code>st_buffer()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>obs_buff <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(obs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>),], <span class="at">dist =</span> <span class="dv">80</span>)</span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(obs_buff), <span class="at">col =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In the GIS world curves are often approximated using small segments, even though curves exists in the Simple Feature standard (but they’re often poorly implemented in GIS software). The number of segments used to create the buffers is controlled by the argument <code>nQuadSegs</code> (= number of segments per quadrant). You can change this value to create buffers with octagonal shapes. You can also increase the default value if you need better precision (especially useful for very large buffers).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>obs_buff_oct <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(obs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>),], <span class="at">dist =</span> <span class="dv">80</span>, <span class="at">nQuadSegs =</span> <span class="dv">2</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(obs_buff_oct), <span class="at">col =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Each feature will get its own buffer, which means that, if they’re close enough and/or the distance is large enough, the buffers will overlap but they’re still separate features. It is possible to merge overlapping buffers using the <code>st_union()</code> function. The function will produce a single multipolygon, that’s why we need transform the output into a polygon to recover the non-overlapping buffers as separate features. Note that you will use the attributes of the buffers with this operation. If you need to recover some of them, you can use a spatial join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>obs_buff_merged <span class="ot">&lt;-</span> <span class="fu">st_union</span>(obs_buff)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>obs_buff_merged <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(obs_buff_merged, <span class="st">"POLYGON"</span>)</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(obs_buff_merged, <span class="at">col =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="affine-transformations" class="level3" data-number="6.10">
<h3 data-number="6.10" class="anchored" data-anchor-id="affine-transformations"><span class="header-section-number">6.10</span> Affine transformations</h3>
<p><code>sf</code> provide methods to transform <code>sfc</code> and <code>sfg</code> objects, this is however not possible with <code>sf</code> objects (but have a look at the trick at the end of this section). Shifting a geometry is the easiest operation. The next example will shift the borders of Sempach, 500 meters to the north and 200 meters to the east. The shift is always done using the unit defined in the CRS used by the spatial object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>sempach_sfc <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(sempach)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>sempach_sfc_shift <span class="ot">&lt;-</span> sempach_sfc <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">500</span>, <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also scale the geometries, but we need a reference point (such as the centroid) for each feature. Once we have these reference points, we can center them by shifting the geometries, apply the scaling, and shift them back to their original locations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>muni_sfc <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(muni)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>muni_sfc_centroids <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(muni_sfc)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>muni_sfc_scale <span class="ot">&lt;-</span> (muni_sfc <span class="sc">-</span> muni_sfc_centroids) <span class="sc">*</span> <span class="fl">0.5</span> <span class="sc">+</span> muni_sfc_centroids</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_sfc, <span class="at">col =</span> <span class="st">"grey90"</span>)</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_sfc_scale, <span class="at">col =</span> <span class="st">"navy"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Rotation is the last common affine transformation. We also need to define a reference point for each feature and perform the same shifting operations. However, instead of multiplying with a scalar we now use a rotation matrix. Remember that a 2D vector (i.e.&nbsp;coordinates) will be rotated by an angle <span class="math inline">\(\theta\)</span> when we multiply it with the following matrix:</p>
<p><span class="math display">\[R=
\begin{pmatrix}
\cos(\theta) &amp; -\sin(\theta)\\
\sin(\theta) &amp; \cos(\theta)
\end{pmatrix}
\]</span></p>
<p>We can of course combine scaling and rotation…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>rotation <span class="ot">&lt;-</span> <span class="cf">function</span>(theta){</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  theta_rad <span class="ot">&lt;-</span> theta <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">cos</span>(theta_rad), <span class="fu">sin</span>(theta_rad), <span class="sc">-</span><span class="fu">sin</span>(theta_rad), <span class="fu">cos</span>(theta_rad)), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>muni_sfc_rotate <span class="ot">&lt;-</span> (muni_sfc <span class="sc">-</span> muni_sfc_centroids) <span class="sc">*</span> <span class="fu">rotation</span>(<span class="dv">30</span>) <span class="sc">+</span> muni_sfc_centroids</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>muni_sfc_scale_rotate <span class="ot">&lt;-</span> (muni_sfc <span class="sc">-</span> muni_sfc_centroids) <span class="sc">*</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">rotation</span>(<span class="dv">30</span>) <span class="sc">+</span> muni_sfc_centroids</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_sfc, <span class="at">col =</span> <span class="st">"grey90"</span>)</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_sfc_rotate, <span class="at">col =</span> <span class="st">"navy"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_sfc, <span class="at">col =</span> <span class="st">"grey90"</span>)</span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_sfc_scale_rotate, <span class="at">col =</span> <span class="st">"navy"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Once all the transformations are performed, we can use the <code>st_set_geometry()</code> function to create a new <code>sf</code> object combining the new geometry with the attributes of the original <code>sf</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>muni2 <span class="ot">&lt;-</span> <span class="fu">st_set_geometry</span>(muni, muni_sfc_scale_rotate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-geometries" class="level3" data-number="6.11">
<h3 data-number="6.11" class="anchored" data-anchor-id="combining-geometries"><span class="header-section-number">6.11</span> Combining geometries</h3>
<p>Combining geometries from two different data sets is one of the most common analysis performed in a GIS. The four main operations are the following ones: union, intersection, difference and symmetric difference. The following figure shows a graphical overview of these operations with the function names (source: Lovelace <em>et al.</em>, 2019):</p>
<p><img src="figures/venn-clip-1.png" class="img-fluid"></p>
<p>As we’ve seen earlier, the <code>st_union()</code> function can also be used with a single data set to merge geometries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>muni_merged <span class="ot">&lt;-</span> <span class="fu">st_union</span>(muni)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>muni_merged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 1 feature 
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 2648317 ymin: 1213352 xmax: 2660750 ymax: 1227618
Projected CRS: CH1903+ / LV95</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((2659099 1221637, 2659104 1221610, 265...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_merged, <span class="at">col =</span> <span class="st">"navy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>But it can also be used to merge geometries between two <code>sf</code> objects having the same vector type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>temp_poly <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(<span class="fu">st_buffer</span>(obs[<span class="dv">1</span>,], <span class="dv">2000</span>))</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_union</span>(temp_poly, sempach))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>As as another example, let’s calculate the intersection between our new polygon and the municipality of Sempach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>muni_inter <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(sempach, temp_poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout all
geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>muni_inter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 3 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 2656433 ymin: 1219021 xmax: 2659072 ymax: 1222900
Projected CRS: CH1903+ / LV95
   bfs    name popsize                           geom
3 1102 Sempach    4186 POLYGON ((2657979 1222854, ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni_inter))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In a perfect world you’ll get polygons as output when you combine polygon (or multipolygon) objects with one of these functions. However, you may also get something more exotic. Let’s have a look at the following example which comes from one of the <code>sf</code> vignettes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">7.5</span>, <span class="fl">7.5</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>))))</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">1</span>))))</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>(inter <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(a, b))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GEOMETRYCOLLECTION (POLYGON ((7 0, 7 -0.5, 6 -0.5, 5.5 0, 7 0)), LINESTRING (4 0, 3 0), POINT (1 0))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Intersecting two polygons:"</span>)</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"red"</span>)</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(a, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"GEOMETRYCOLLECTION"</span>)</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">border =</span> <span class="st">"red"</span>)</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(inter, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Geometry collections are defined in the Simple Feature standard as a collection of different vector types. For example, one feature (row) could contain 2 polygons, 1 multiline and 3 points. The output of the previous is clearly a geometry collection since the <code>st_intersection()</code> function produced 1 polygon, 1 line and 1 point. When performing an intersection or a similar operation, it is important to check that all the produced features have the expected geometry type. An geometry collection output is maybe not so common, but you may get a combination of polygons and multipolygons. Use the <code>st_geometry_type()</code> function (maybe in combination with <code>unique()</code>) to inspect the types.</p>
<p>Ideally we would use geometry collections directly in our analyses but you’ll quickly notice that most functions don’t work with them (and most GIS software don’t really know what to do with them either). Therefore you’ll need to decide which part of the collection is important for you. If you intersect polygons with polygons, most of the time you’ll be interested in the polygons and multipolygons outputs. You can use the <code>st_collection_extract()</code> function to perform this task.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_collection_extract</span>(inter, <span class="st">"POLYGON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((7 0, 7 -0.5, 6 -0.5, 5.5 0, 7 0))</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise (5 minutes)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a line object that is intersecting the streets data set. Compute the intersection using the <code>st_intersection()</code> function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>temp_line <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"LINESTRING(2657290 1219789, 2657090 1219789, 2657290 1219889)"</span>, <span class="at">crs =</span> <span class="dv">2056</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>temp_inter <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(temp_line, streets)</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry_type</span>(temp_inter)</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp_line, <span class="at">col =</span> <span class="st">"navy"</span>)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(streets), <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp_inter[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temp_inter[<span class="dv">4</span>], <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="aggregate-by-attributes" class="level3" data-number="6.12">
<h3 data-number="6.12" class="anchored" data-anchor-id="aggregate-by-attributes"><span class="header-section-number">6.12</span> Aggregate by attributes</h3>
<p>Aggregation can be based purely on the attributes, treating the <code>sf</code> object as a dataframe using the standard <code>aggregate()</code> function. However, the <code>sf</code> package also extends the <code>aggregate()</code> function if you use a <code>sf</code> object as the first argument. Note that the nice formula notation is not possible in this case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(pop_est <span class="sc">~</span> continent, <span class="at">FUN =</span> sum, <span class="at">data =</span> World, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                continent    pop_est
1                  Africa  993321977
2              Antarctica       3802
3                    Asia 4085852698
4                  Europe  728131201
5           North America  539350981
6                 Oceania   33519610
7 Seven seas (open ocean)        140
8           South America  394355478</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>world_agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(World[<span class="st">"pop_est"</span>], <span class="fu">list</span>(World<span class="sc">$</span>continent), <span class="at">FUN =</span> sum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>world_agg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 8 features and 2 fields
Attribute-geometry relationship: 0 constant, 1 aggregate, 1 identity
Geometry type: GEOMETRY
Dimension:     XY
Bounding box:  xmin: -180 ymin: -89.9 xmax: 180 ymax: 83.64513
Geodetic CRS:  WGS 84
                  Group.1    pop_est                       geometry
1                  Africa  993321977 MULTIPOLYGON (((-11.43878 6...
2              Antarctica       3802 MULTIPOLYGON (((-62.25539 -...
3                    Asia 4085852698 MULTIPOLYGON (((48.67923 14...
4                  Europe  728131201 MULTIPOLYGON (((-54.08806 2...
5           North America  539350981 MULTIPOLYGON (((-156.0237 1...
6                 Oceania   33519610 MULTIPOLYGON (((148.2891 -4...
7 Seven seas (open ocean)        140 POLYGON ((68.935 -48.625, 6...
8           South America  394355478 MULTIPOLYGON (((-68.25 -53....</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(world_agg[,<span class="st">"pop_est"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the merging is not perfect since some country borders where not perfectly contiguous.</p>
<p>Combining aggregation with intersections allows us to compute interesting parameters for our study area. For example we can compute the total street length in buffers around bird sightings. The <code>st_agr()</code> function tells <code>sf</code> how the attributes of the data set should be considered. Here we we consider that the attributes are constant within each buffer. Depending on your version of <code>sf</code> you might get an error if you don’t add this line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>obs_buff <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(obs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">400</span>), <span class="dv">1</span>], <span class="at">dist =</span> <span class="dv">1000</span>)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>obs_buff<span class="sc">$</span>site <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_agr</span>(obs_buff) <span class="ot">&lt;-</span> <span class="st">"constant"</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>streets_clip <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(obs_buff, <span class="fu">st_geometry</span>(streets))</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">st_length</span>(streets_clip), <span class="at">by =</span> <span class="fu">list</span>(<span class="at">site =</span> streets_clip<span class="sc">$</span>site), <span class="at">FUN =</span> <span class="st">"sum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  site            x
1    1 32446.10 [m]
2    2 44945.34 [m]
3    3 21131.22 [m]</code></pre>
</div>
</div>
</section>
<section id="generate-sample-points" class="level3" data-number="6.13">
<h3 data-number="6.13" class="anchored" data-anchor-id="generate-sample-points"><span class="header-section-number">6.13</span> Generate sample points</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>samples_random <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(sempach, <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"random"</span>)</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>samples_regular <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(sempach, <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"regular"</span>)</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(sempach))</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(samples_random, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(sempach))</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(samples_regular, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>samples_ssi <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(sempach, <span class="at">r =</span> <span class="dv">50</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"SSI"</span>)</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>temp_dist <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(samples_ssi)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(temp_dist[temp_dist <span class="sc">&gt;</span> <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 75.39137</code></pre>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(sempach))</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(samples_ssi, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="convex-hulls" class="level3" data-number="6.14">
<h3 data-number="6.14" class="anchored" data-anchor-id="convex-hulls"><span class="header-section-number">6.14</span> Convex hulls</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>obs_wagtail <span class="ot">&lt;-</span> obs[obs<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"White Wagtail"</span>,]</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>obs_wagtail_neuenkirch <span class="ot">&lt;-</span> obs_wagtail[muni[muni<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"Neuenkirch"</span>,],]</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>conv_hull <span class="ot">&lt;-</span> <span class="fu">st_convex_hull</span>(<span class="fu">st_union</span>(obs_wagtail_neuenkirch))</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(conv_hull)</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(obs_wagtail_neuenkirch), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="crs-transformations" class="level3" data-number="6.15">
<h3 data-number="6.15" class="anchored" data-anchor-id="crs-transformations"><span class="header-section-number">6.15</span> CRS transformations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(World)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["unknown"],
        AREA["World"],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>grat <span class="ot">&lt;-</span> <span class="fu">st_graticule</span>()</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>world_ch <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(World, <span class="dv">2056</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>grat_ch <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grat, <span class="dv">2056</span>)</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>world_equal <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(World, <span class="dv">8857</span>)</span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>grat_equal <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grat, <span class="dv">8857</span>)</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>world_rob <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(World, <span class="st">"ESRI:54030"</span>)</span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>grat_rob <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grat, <span class="st">"ESRI:54030"</span>)</span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(World), <span class="at">col =</span> <span class="st">"grey90"</span>)</span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat), <span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(world_ch), <span class="at">col =</span> <span class="st">"grey90"</span>)</span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat_ch), <span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(world_equal), <span class="at">col =</span> <span class="st">"grey90"</span>)</span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat_equal), <span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(world_rob), <span class="at">col =</span> <span class="st">"grey90"</span>)</span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(grat_rob), <span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="neighborhood-analyses" class="level3" data-number="6.16">
<h3 data-number="6.16" class="anchored" data-anchor-id="neighborhood-analyses"><span class="header-section-number">6.16</span> Neighborhood analyses</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>To access larger datasets in this package, install the spDataLarge
package with: `install.packages('spDataLarge',
repos='https://nowosad.github.io/drat/', type='source')`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>muni_neigh <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(muni)</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(muni_neigh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 7 
Number of nonzero links: 22 
Percentage nonzero weights: 44.89796 
Average number of links: 3.142857 
Link number distribution:

2 3 4 
2 2 3 
2 least connected regions:
1 7 with 2 links
3 most connected regions:
2 4 5 with 4 links</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(muni_neigh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 7
 $ : int [1:2] 2 3
 $ : int [1:4] 1 3 4 5
 $ : int [1:3] 1 2 5
 $ : int [1:4] 2 5 6 7
 $ : int [1:4] 2 3 4 6
 $ : int [1:3] 4 5 7
 $ : int [1:2] 4 6
 - attr(*, "class")= chr "nb"
 - attr(*, "region.id")= chr [1:7] "1" "2" "3" "4" ...
 - attr(*, "call")= language poly2nb(pl = muni)
 - attr(*, "type")= chr "queen"
 - attr(*, "sym")= logi TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_touches</span>(muni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sparse geometry binary predicate list of length 7, where the predicate
was `touches'
 1: 2, 3
 2: 1, 3, 4, 5
 3: 1, 2, 5
 4: 2, 5, 6, 7
 5: 2, 3, 4, 6
 6: 4, 5, 7
 7: 4, 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>muni_centroids_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(<span class="fu">st_centroid</span>(muni))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_centroid.sf(muni): st_centroid assumes attributes are constant
over geometries of x</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_neigh, muni_centroids_coords, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(muni_centroids_coords, <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(muni), <span class="at">pos =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>muni_knb <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(muni_centroids_coords, <span class="at">k =</span> <span class="dv">2</span>))</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(muni_knb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 7 
Number of nonzero links: 14 
Percentage nonzero weights: 28.57143 
Average number of links: 2 
Non-symmetric neighbours list
Link number distribution:

2 
7 
7 least connected regions:
1 2 3 4 5 6 7 with 2 links
7 most connected regions:
1 2 3 4 5 6 7 with 2 links</code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.symmetric.nb</span>(muni_knb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>muni_knb2 <span class="ot">&lt;-</span> <span class="fu">make.sym.nb</span>(muni_knb)</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.symmetric.nb</span>(muni_knb2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_knb, muni_centroids_coords, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">arrows =</span> <span class="cn">TRUE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(muni_knb2, muni_centroids_coords, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">arrows =</span> <span class="cn">TRUE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>muni_knb3 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(muni_centroids_coords, <span class="at">k =</span> <span class="dv">1</span>))</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>distances <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(muni_knb3, muni_centroids_coords))</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>dist1nb <span class="ot">&lt;-</span> <span class="fu">max</span>(distances)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>dnb1 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(muni_centroids_coords, <span class="at">d1 =</span> <span class="dv">0</span>, <span class="at">d2 =</span> <span class="fl">0.75</span> <span class="sc">*</span> dist1nb)</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>dnb2 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(muni_centroids_coords, <span class="at">d1 =</span> <span class="dv">0</span>, <span class="at">d2 =</span> <span class="dv">1</span> <span class="sc">*</span> dist1nb)</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>dnb3 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(muni_centroids_coords, <span class="at">d1 =</span> <span class="dv">0</span>, <span class="at">d2 =</span> <span class="fl">1.25</span> <span class="sc">*</span> dist1nb)</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dnb1, muni_centroids_coords, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dnb2, muni_centroids_coords, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(muni))</span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dnb3, muni_centroids_coords, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nb2mat</span>(muni_neigh, <span class="at">style =</span> <span class="st">"B"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [,1] [,2] [,3] [,4] [,5] [,6] [,7]
1    0    1    1    0    0    0    0
2    1    0    1    1    1    0    0
3    1    1    0    0    1    0    0
4    0    1    0    0    1    1    1
5    0    1    1    1    0    1    0
6    0    0    0    1    1    0    1
7    0    0    0    1    0    1    0
attr(,"call")
nb2mat(neighbours = muni_neigh, style = "B")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>neigh_sf <span class="ot">&lt;-</span> <span class="fu">nb2lines</span>(muni_neigh, <span class="at">coords =</span> <span class="fu">st_geometry</span>(muni_centroid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>nb_winbugs &lt;- nb2WB(muni_neigh) nb2INLA(file = “nbinla.txt”, muni_neigh)</p>
</section>
</section>
<section id="tips-and-tricks-for-rasters" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="tips-and-tricks-for-rasters"><span class="header-section-number">7</span> Tips and tricks for rasters</h2>
<section id="reading-and-writing-raster-data" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="reading-and-writing-raster-data"><span class="header-section-number">7.1</span> Reading and writing raster data</h3>
<p>As we saw earlier, we need another package to import raster data sets. The <code>rast()</code> function from the <code>terra</code> package is what we need. It doesn’t matter if our raster is continuous, discrete, or contains several bands, the <code>rast()</code> function will create the correct <code>terra</code> object. However don’t forget that it’s only a pointer to the data set, the full raster is not imported into memory. Calling the object will display some basic information about the data set.</p>
<p>The digital elevation model is an extract of the DHM25 data set provided by Swisstopo, the orthophoto is an extract of the SWISSIMAGE data set also provided by Swisstopo.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>terra 1.6.47</code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>elev <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/dem.tif"</span>)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>elev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 604, 840, 1  (nrow, ncol, nlyr)
resolution  : 25, 25  (x, y)
extent      : 2643988, 2664988, 1212912, 1228012  (xmin, xmax, ymin, ymax)
coord. ref. : CH1903+ / LV95 (EPSG:2056) 
source      : dem.tif 
name        : dem </code></pre>
</div>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>ortho <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/sempach_ortho.tif"</span>)</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>ortho</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 1427, 1996, 3  (nrow, ncol, nlyr)
resolution  : 0.1000104, 0.1000196  (x, y)
extent      : 2657219, 2657419, 1219699, 1219842  (xmin, xmax, ymin, ymax)
coord. ref. : CH1903+ / LV95 (EPSG:2056) 
source      : sempach_ortho.tif 
colors RGB  : 1, 2, 3 
names       : sempach_ortho_1, sempach_ortho_2, sempach_ortho_3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ortho)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-78-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that the orthophoto was plotted in a different way (no axes, no legend). The <code>terra</code> package automatically detected that the raster had 3 bands and made the assumption that the bands corresponded to red, green and blue intensity values. If this assumption is not correct, you can use the <code>plotRGB()</code> function to get the desired plot.</p>
<p>Rasters are nice objects to work with but sometimes it’s nice with more familiar R objects. You can easily convert <code>SpatRaster</code> objects to dataframes containing the geographic coordinates of all pixels and the related pixel values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>elev_vals <span class="ot">&lt;-</span> <span class="fu">values</span>(elev)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(elev_vals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     dem
[1,] 544
[2,] 544
[3,] 543
[4,] 544
[5,] 545
[6,] 546</code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(elev, <span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(elev_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        x       y dem
1 2644000 1228000 544
2 2644025 1228000 544
3 2644050 1228000 543
4 2644075 1228000 544
5 2644100 1228000 545
6 2644125 1228000 546</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(elev_df, <span class="st">"export/dem.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, if you have a dataframe containing geographic coordinates located on a regular grid and associated values, you can easily convert it to a <code>terra</code> object with the help of the <code>rast()</code> function, by adding the argument <code>type = "xyz"</code>. This is often useful if you want to plot the predictions of a statistical model on a map, for example the distribution of a species. Here we add a new column to some dataframe filled with random values and we convert it to a 2-band raster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>elev_df<span class="sc">$</span>rand <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(elev_df))</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>elev2 <span class="ot">&lt;-</span> <span class="fu">rast</span>(elev_df, <span class="at">type =</span> <span class="st">"xyz"</span>)</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>elev2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 604, 840, 2  (nrow, ncol, nlyr)
resolution  : 25, 25  (x, y)
extent      : 2643988, 2664988, 1212912, 1228012  (xmin, xmax, ymin, ymax)
coord. ref. :  
source(s)   : memory
names       : dem,      rand 
min values  : 425, -5.166262 
max values  : 930,  4.479239 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Exporting raster data set is really easy thanks to the <code>writeRaster()</code> function. The format will be automatically recognized based on the filename extension. As we saw in the introduction, the GeoTiff format is almost always the format we should use.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(elev, <span class="st">"export/dem1.tif"</span>)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(elev2, <span class="st">"export/dem2.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember that the first raster was a single band raster and the second one had two bands. What is happening when we visualize the latter with QGIS? It looks like QGIS is combining the bands like an RGB raster. If you want to only export a single band, you can subset the raster data set using <code>[[]]</code>, either using the band number or name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(elev2[[<span class="dv">1</span>]], <span class="st">"export/dem2.tif"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(elev2[[<span class="st">"dem"</span>]], <span class="st">"export/dem2.tif"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarize-rasters" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="summarize-rasters"><span class="header-section-number">7.2</span> Summarize rasters</h3>
<p>Functions with “” memory efficient, own functions possible</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global</span>(elev, <span class="at">fun =</span> <span class="st">"max"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    max
dem 930</code></pre>
</div>
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(elev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="spatial-subsetting-1" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="spatial-subsetting-1"><span class="header-section-number">7.3</span> Spatial subsetting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>rmask <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/sempach_raster.tif"</span>)</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>elev_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(elev, rmask)</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Identical to</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>elev_crop <span class="ot">&lt;-</span> elev[rmask, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev_crop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>elev_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(elev_crop, rmask)</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev_mask)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>elev_crop2 <span class="ot">&lt;-</span> <span class="fu">crop</span>(elev, sempach)</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev_crop2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>elev_mask2 <span class="ot">&lt;-</span> <span class="fu">mask</span>(elev, sempach)</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev_mask2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-86-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>elev_mask2 <span class="ot">&lt;-</span> <span class="fu">trim</span>(elev_mask2)</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev_mask2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-86-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="aggregation-and-resampling" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="aggregation-and-resampling"><span class="header-section-number">7.4</span> Aggregation and resampling</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>elev_agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(elev, <span class="at">fact =</span> <span class="dv">20</span>)</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev_agg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>landcover <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/landcover.tif"</span>)</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>landcover</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 151, 210, 1  (nrow, ncol, nlyr)
resolution  : 100, 100  (x, y)
extent      : 2644000, 2665000, 1212900, 1228000  (xmin, xmax, ymin, ymax)
coord. ref. :  
source      : landcover.tif 
name        :  X 
min value   :  1 
max value   : 26 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crs</span>(landcover) <span class="ot">&lt;-</span> <span class="st">"EPSG:2056"</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>landcover <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(landcover)</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(landcover)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>landcover_agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(landcover, <span class="at">fact =</span> <span class="dv">5</span>, <span class="at">fun =</span> <span class="st">"modal"</span>)</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(landcover_agg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-88-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>elev_resample <span class="ot">&lt;-</span> <span class="fu">resample</span>(elev, landcover, <span class="at">method =</span> <span class="st">"bilinear"</span>)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>elev_resample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 151, 210, 1  (nrow, ncol, nlyr)
resolution  : 100, 100  (x, y)
extent      : 2644000, 2665000, 1212900, 1228000  (xmin, xmax, ymin, ymax)
coord. ref. : CH1903+ / LV95 (EPSG:2056) 
source(s)   : memory
name        :      dem 
min value   : 427.0625 
max value   : 920.8250 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compareGeom</span>(elev_resample, landcover)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>landcover_resample <span class="ot">&lt;-</span> <span class="fu">resample</span>(landcover, elev, <span class="at">method =</span> <span class="st">"near"</span>)</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>landcover_resample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 604, 840, 1  (nrow, ncol, nlyr)
resolution  : 25, 25  (x, y)
extent      : 2643988, 2664988, 1212912, 1228012  (xmin, xmax, ymin, ymax)
coord. ref. : CH1903+ / LV95 (EPSG:2056) 
source(s)   : memory
categories  : label 
name        : label 
min value   :     1 
max value   :    26 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compareGeom</span>(landcover_resample, elev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="classify-rasters" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="classify-rasters"><span class="header-section-number">7.5</span> Classify rasters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>elev_recl <span class="ot">&lt;-</span> <span class="fu">classify</span>(elev, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">700</span>, <span class="cn">Inf</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elev_recl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>reclMat_landcover <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">11</span>, <span class="dv">2</span>, <span class="dv">12</span>, <span class="dv">2</span>,</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">14</span>, <span class="dv">2</span>, <span class="dv">15</span>, <span class="dv">2</span>, <span class="dv">16</span>, <span class="dv">2</span>, <span class="dv">17</span>, <span class="dv">2</span>, <span class="dv">18</span>, <span class="dv">2</span>, <span class="dv">19</span>, <span class="dv">3</span>, <span class="dv">20</span>, <span class="dv">3</span>, <span class="dv">21</span>, <span class="dv">3</span>, <span class="dv">22</span>, <span class="dv">3</span>, <span class="dv">23</span>, <span class="dv">4</span>,</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">24</span>, <span class="dv">4</span>, <span class="dv">25</span>, <span class="dv">4</span>, <span class="dv">26</span>, <span class="dv">4</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>landcover_recl <span class="ot">&lt;-</span> <span class="fu">classify</span>(landcover, reclMat_landcover)</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(landcover_recl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>landcover_layers <span class="ot">&lt;-</span> <span class="fu">segregate</span>(landcover_recl)</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(landcover_layers) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"settlements"</span>, <span class="st">"agriculture"</span>, <span class="st">"forest"</span>, <span class="st">"unproductive"</span>)</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(landcover_layers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="extract-pixel-values" class="level3" data-number="7.6">
<h3 data-number="7.6" class="anchored" data-anchor-id="extract-pixel-values"><span class="header-section-number">7.6</span> Extract pixel values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>vals <span class="ot">&lt;-</span> <span class="fu">extract</span>(elev, <span class="fu">vect</span>(obs), <span class="at">ID =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">c</span>(landcover, elev_resample)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(covariates) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"landcover"</span>, <span class="st">"elevation"</span>)</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>vals <span class="ot">&lt;-</span> <span class="fu">extract</span>(covariates, <span class="fu">vect</span>(obs), <span class="at">ID =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>vals <span class="ot">&lt;-</span> <span class="fu">extract</span>(elev, <span class="fu">vect</span>(obs_buff))</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>vals_avg <span class="ot">&lt;-</span> <span class="fu">extract</span>(elev, <span class="fu">vect</span>(obs_buff), <span class="at">fun =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-rasters" class="level3" data-number="7.7">
<h3 data-number="7.7" class="anchored" data-anchor-id="combining-rasters"><span class="header-section-number">7.7</span> Combining rasters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>layers <span class="ot">&lt;-</span> <span class="fu">c</span>(landcover_layers[[<span class="dv">1</span>]], landcover_layers[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>settlements <span class="ot">&lt;-</span> landcover_layers[[<span class="dv">1</span>]]</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>forests <span class="ot">&lt;-</span> landcover_layers[[<span class="dv">3</span>]]</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>combn <span class="ot">&lt;-</span> settlements <span class="sc">+</span> forests</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>combn2 <span class="ot">&lt;-</span> settlements <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> forests</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(combn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>combn3 <span class="ot">&lt;-</span> <span class="fu">app</span>(layers, <span class="st">"sum"</span>)</span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a>combn4 <span class="ot">&lt;-</span> <span class="fu">app</span>(layers, <span class="st">"max"</span>)</span>
<span id="cb280-3"><a href="#cb280-3" aria-hidden="true" tabindex="-1"></a>combn5 <span class="ot">&lt;-</span> <span class="fu">app</span>(layers, <span class="cf">function</span>(i) {pi <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> i)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>reclMat_elev <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">700</span>, <span class="dv">200</span>, <span class="dv">700</span>, <span class="cn">Inf</span>, <span class="dv">300</span>), <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>elev_recl2 <span class="ot">&lt;-</span> <span class="fu">classify</span>(elev, reclMat_elev, <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>landcover_recl2 <span class="ot">&lt;-</span> <span class="fu">classify</span>(landcover_resample, reclMat_landcover)</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>elev_land <span class="ot">&lt;-</span> elev_recl2 <span class="sc">+</span> landcover_recl2</span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.factor</span>(elev_land))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="focal-analysis" class="level3" data-number="7.8">
<h3 data-number="7.8" class="anchored" data-anchor-id="focal-analysis"><span class="header-section-number">7.8</span> Focal analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>elev_focal_mean <span class="ot">&lt;-</span> <span class="fu">focal</span>(elev, <span class="at">w =</span> <span class="dv">21</span>, <span class="at">fun =</span> <span class="st">"mean"</span>)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(elev, elev_focal_mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>forests_focal_sum <span class="ot">&lt;-</span> <span class="fu">focal</span>(forests, <span class="dv">5</span>, <span class="at">fun =</span> <span class="st">"sum"</span>)</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(forests, forests_focal_sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>(fwin_rect <span class="ot">&lt;-</span> <span class="fu">focalMat</span>(forests, <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">200</span>), <span class="at">type =</span> <span class="st">"rectangle"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,] 0.04 0.04 0.04 0.04 0.04
[2,] 0.04 0.04 0.04 0.04 0.04
[3,] 0.04 0.04 0.04 0.04 0.04
[4,] 0.04 0.04 0.04 0.04 0.04
[5,] 0.04 0.04 0.04 0.04 0.04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>fwin_rect[fwin_rect <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>forests_focal_sum2 <span class="ot">&lt;-</span> <span class="fu">focal</span>(forests, fwin_rect, <span class="at">fun =</span> <span class="st">"sum"</span>)</span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">values</span>(forests_focal_sum), <span class="fu">values</span>(forests_focal_sum2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>(fwin_circle <span class="ot">&lt;-</span> <span class="fu">focalMat</span>(forests, <span class="dv">200</span>, <span class="at">type =</span> <span class="st">"circle"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]       [,3]       [,4]       [,5]
[1,] 0.00000000 0.00000000 0.07692308 0.00000000 0.00000000
[2,] 0.00000000 0.07692308 0.07692308 0.07692308 0.00000000
[3,] 0.07692308 0.07692308 0.07692308 0.07692308 0.07692308
[4,] 0.00000000 0.07692308 0.07692308 0.07692308 0.00000000
[5,] 0.00000000 0.00000000 0.07692308 0.00000000 0.00000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>fwin_circle[fwin_circle <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>forests_focal_sum3 <span class="ot">&lt;-</span> <span class="fu">focal</span>(forests, fwin_circle, <span class="at">fun =</span> <span class="st">"sum"</span>)</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(forests_focal_sum, forests_focal_sum3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-100-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Spatial-Data-Processing-with-R_cache/html/unnamed-chunk-101_619ee85ef6aa2a7b519a33dd1d5b3278">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>ortho_red <span class="ot">&lt;-</span> ortho[[<span class="dv">1</span>]]</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a>fwin_gauss <span class="ot">&lt;-</span> <span class="fu">focalMat</span>(ortho_red, <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"Gauss"</span>)</span>
<span id="cb291-3"><a href="#cb291-3" aria-hidden="true" tabindex="-1"></a>ortho_red_focal <span class="ot">&lt;-</span> <span class="fu">focal</span>(ortho_red, fwin_gauss, <span class="at">type =</span> <span class="st">"sum"</span>)</span>
<span id="cb291-4"><a href="#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(ortho_red, ortho_red_focal), <span class="at">col =</span> <span class="fu">grey.colors</span>(<span class="dv">256</span>), <span class="at">legend =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Spatial-Data-Processing-with-R_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="generate-raster-covariates" class="level3" data-number="7.9">
<h3 data-number="7.9" class="anchored" data-anchor-id="generate-raster-covariates"><span class="header-section-number">7.9</span> Generate raster covariates</h3>
</section>
<section id="rasterize-vector-data" class="level3" data-number="7.10">
<h3 data-number="7.10" class="anchored" data-anchor-id="rasterize-vector-data"><span class="header-section-number">7.10</span> Rasterize vector data</h3>
</section>
<section id="crs-transformations-1" class="level3" data-number="7.11">
<h3 data-number="7.11" class="anchored" data-anchor-id="crs-transformations-1"><span class="header-section-number">7.11</span> CRS transformations</h3>
</section>
</section>
<section id="making-maps" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="making-maps"><span class="header-section-number">8</span> Making maps</h2>
<section id="basic-maps" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="basic-maps"><span class="header-section-number">8.1</span> Basic maps</h3>
</section>
<section id="swiss-map" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="swiss-map"><span class="header-section-number">8.2</span> Swiss map</h3>
</section>
<section id="static-maps-with-tmap" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="static-maps-with-tmap"><span class="header-section-number">8.3</span> Static maps with tmap</h3>
</section>
<section id="dynamic-maps" class="level3" data-number="8.4">
<h3 data-number="8.4" class="anchored" data-anchor-id="dynamic-maps"><span class="header-section-number">8.4</span> Dynamic maps</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(muni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-56e93639b305b12eb240" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-56e93639b305b12eb240">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[8.157408214931,8.15645081318675,8.15660027327897,8.15663944570936,8.15661544833022,8.15662923888085,8.15664945592348,8.15680393852416,8.15688457079333,8.15696087479913,8.15702793487249,8.15701827513731,8.15703095824217,8.15706299571596,8.15708714591982,8.15708876204158,8.1571093420207,8.15713378608454,8.15719885250568,8.15730133423261,8.15736651988884,8.15737591637368,8.15735064228886,8.15736223797184,8.15739070118574,8.15741706086388,8.15743204835447,8.15957512545185,8.15947653292908,8.15940866008383,8.15913841728069,8.15937116150908,8.15939584615161,8.15953418757534,8.15955183572263,8.15960044153356,8.15968135735048,8.15976263804082,8.15976437528847,8.15980647280524,8.15981630443711,8.15991195717845,8.15994201334323,8.15999192201321,8.16001663660908,8.16007462204531,8.16012525679669,8.16016569113121,8.16019620885638,8.16027702246897,8.16032797636784,8.16032416046659,8.16039501946966,8.16040719975972,8.16046272255621,8.16050322738668,8.16058882468501,8.16059890469217,8.1606324305408,8.16063795693652,8.16071569369693,8.16072898336697,8.1607789719703,8.16097822320863,8.16132304673822,8.16193611995626,8.16204159265134,8.16226048495499,8.16232354310844,8.16234557694313,8.16229133670904,8.16229513453867,8.16238482326585,8.16246920455623,8.16258650386538,8.16276438278,8.16291397700574,8.1629784621407,8.16298088771376,8.16302351913538,8.16304908043348,8.16311504941467,8.16317599102097,8.16324755942976,8.16336714646856,8.16347743608223,8.16358133875475,8.16362684845277,8.16360249247431,8.16358047006314,8.16367095103103,8.16377737935214,8.16387130618785,8.16391987443617,8.16389077328521,8.16391248652733,8.16387099361065,8.16380798374047,8.16380149784482,8.16376812519792,8.16379026809417,8.16377432593811,8.16386627295171,8.16390202260432,8.16419893222583,8.16579417551345,8.16794024976046,8.16849174289166,8.16796871852082,8.16803221632991,8.16860644949405,8.16864331592615,8.16881783447631,8.16883981121046,8.16920923636941,8.17750965084198,8.18644744678248,8.18779869837158,8.18832050777541,8.1889990460716,8.18963153018126,8.19023958020212,8.19033556841664,8.19044830588155,8.19081088149795,8.1907959954613,8.19346532966828,8.19368572050126,8.1938318458287,8.19403298803548,8.19418145766,8.19548473602384,8.19572003995684,8.19596530417314,8.19648705251388,8.19715290023143,8.19730400524772,8.19730209496221,8.19741061240929,8.1976900016756,8.19797128333846,8.19828138592852,8.19857483445519,8.19883690176165,8.19897675363429,8.20007707207958,8.20040132781519,8.20056680525713,8.20059202423002,8.20061252612136,8.20058850652591,8.20059997825829,8.20065097364837,8.20065567603293,8.20056775078787,8.20044884836188,8.20041707807041,8.20040288441407,8.20041798159693,8.20039988460042,8.20032993993899,8.20024746011952,8.20018916250493,8.20017163132536,8.20018872669406,8.20018516201746,8.20008040592066,8.20071886407315,8.20042782337275,8.20056172589951,8.20066490347576,8.20072965763584,8.20089693256045,8.2009485475843,8.20099880804851,8.2011377625204,8.20120914862381,8.20125934704345,8.20130159660187,8.20134368457201,8.20135584160567,8.20145699267342,8.20153558496806,8.20159440164406,8.20165831734545,8.20168358829736,8.2016767340469,8.20169575560013,8.2017370636012,8.20181097674393,8.20184359728072,8.20184898284921,8.20188241696717,8.2019381133189,8.20207107434425,8.20208456932018,8.20217824612967,8.20227179690759,8.20229752734419,8.2023487335631,8.20239504773563,8.2024656667591,8.20250806351738,8.20271334314386,8.20279884371485,8.20285669347076,8.20289996320529,8.20291955505952,8.20301055294929,8.20324238220385,8.20338120278242,8.20345758411021,8.20377502627714,8.20392689906258,8.20404333931404,8.2041339076106,8.20415781388881,8.2041748104581,8.2042182435966,8.20445347967719,8.20460065907864,8.20463305168872,8.20470657812145,8.20476788324838,8.20484234115087,8.20495973020988,8.20502970832265,8.20504376329204,8.20542160931482,8.20581969020192,8.20643816964074,8.20671254212656,8.207027082849,8.20714321592592,8.20724708693528,8.20732538077547,8.20742589713142,8.20745443720449,8.20749763172861,8.20763102772315,8.20769236896892,8.20780594995052,8.20788724868299,8.20797967410581,8.20806473309665,8.20823416155656,8.20833227453092,8.20849547740985,8.20858607808094,8.20864073486821,8.20869984690932,8.20887973243963,8.20895224169031,8.20902989777411,8.20907699444962,8.20912169918195,8.20922899760074,8.209268942879,8.20930876823665,8.20938457475323,8.20942997962423,8.20951490895938,8.20956073218479,8.20958494752879,8.20963237911508,8.20971793927961,8.20984660724469,8.20989004596043,8.20994131608296,8.21017370575061,8.21030793270191,8.21034861363437,8.21040103480886,8.21044722068818,8.21057851775985,8.21083747091732,8.21099702582215,8.21105018459802,8.21112622168504,8.21118066303078,8.21126176242191,8.21127168493214,8.21145341856145,8.21151131299031,8.21153436948096,8.21153588684988,8.211528972219,8.21156299394612,8.21163851968806,8.2117215800457,8.21171653969822,8.21173147285745,8.21176467402355,8.21181341111063,8.21183365903094,8.211847624087,8.21190328327339,8.21189948244484,8.21187487829722,8.21187424059043,8.21200129544987,8.21214076267124,8.21216906730564,8.2122469580419,8.21226842052559,8.21228838965386,8.21229227053629,8.21224953242771,8.21225767794593,8.21226943605098,8.21230888912826,8.2123752553369,8.21240291354357,8.21241398441853,8.21243586816129,8.21247670754981,8.21253061372878,8.21261743893946,8.21271937054568,8.21282158657655,8.21290351316153,8.21294649775975,8.21301779435509,8.21312954797611,8.21320590714804,8.21336200053759,8.2134078050369,8.21351150215902,8.21356192754585,8.21358962164502,8.21361605231936,8.21367370294254,8.21379111066311,8.2138406522541,8.21386433394024,8.21389581265547,8.21394770381154,8.21399215222713,8.21409300339825,8.21418419171911,8.21423212235637,8.21426896075391,8.21434305523787,8.21442140545783,8.21451240313887,8.21458126588302,8.21462150371254,8.21472128616419,8.21475089675215,8.2149507034095,8.21500098476187,8.21512545866841,8.21520187957128,8.21525798496342,8.21534560021397,8.21544128626787,8.21553898504076,8.21560201235935,8.21564977509265,8.21582112547086,8.21587842855227,8.21588186724862,8.21592521610001,8.21594666814528,8.21593942244683,8.21590650488143,8.21590151943323,8.21592867842066,8.21596017349887,8.21596847468237,8.21596180965648,8.2159723597498,8.21597336180662,8.21598696292414,8.21601679600161,8.21604502007206,8.21606272034156,8.21605943661051,8.21612147481539,8.21618956837626,8.21623455108459,8.21634594148776,8.21643797577487,8.21650119712761,8.21651059361007,8.2165258768834,8.21654250131413,8.21554805846977,8.2166224826682,8.21682959696835,8.21629801283888,8.21675274320273,8.21533191070746,8.21609196020478,8.2165854079919,8.21713440824425,8.21711586953083,8.21676988531684,8.21674075801117,8.21611948442659,8.21584693752419,8.21519396247577,8.21495405490438,8.21471160791007,8.21512881023243,8.21559453454388,8.2159422115499,8.21612159121518,8.21629867517278,8.21481967375566,8.21467221724059,8.21484684579249,8.21521352611178,8.21561722968047,8.21514752997068,8.21479037634635,8.21456625574184,8.21438759040877,8.21413916900931,8.21402976099997,8.21391493020324,8.21383634761712,8.21348272345787,8.21348149215902,8.21347457616874,8.21352847530847,8.21358330235132,8.21372157825803,8.21378751701882,8.21381432784761,8.21387409463967,8.21391978229457,8.21398152739028,8.21399819695329,8.21402692222422,8.21403533017411,8.21401155176257,8.21400377498561,8.21402388244292,8.21408647742869,8.2140951089653,8.21412808551442,8.21419545964256,8.21421645411858,8.2142575791398,8.21428218919569,8.2142972035235,8.21428292009328,8.21428095245636,8.21431690373434,8.21429184671135,8.21432381941835,8.21432641338778,8.2143350970509,8.21433116159364,8.21434562612348,8.21435598088616,8.21433645538451,8.21433402122517,8.21434748395098,8.21431152688607,8.21429303582349,8.21428771989688,8.21429698134245,8.21431723023982,8.21436264748813,8.21441643859722,8.2144698870569,8.21450616069053,8.21453624127404,8.21459004138435,8.21461474003786,8.2146642128911,8.21471721969306,8.21477529460385,8.21488724147186,8.21487324947692,8.21492289167242,8.21497156614062,8.21513050447526,8.21563493540833,8.21771247463522,8.2177537361941,8.21781590852511,8.21819436224112,8.2182612200439,8.21791239391946,8.2180846476636,8.21792654933477,8.21798735927833,8.21800882000804,8.21833935963791,8.21857971922977,8.21835574610103,8.21905662431889,8.2191110009163,8.22071541367614,8.22213979469674,8.22293796263939,8.22391761668555,8.22449758124458,8.22539112149103,8.22548384036429,8.22563812195718,8.22573722394987,8.22592864477135,8.22617599761446,8.22631267446446,8.22683805126682,8.22703667642705,8.22725151060451,8.22815195271453,8.22838959593654,8.22857632512011,8.22877435075375,8.22911317105277,8.22975573979713,8.22998934395359,8.23064670162428,8.23088886708488,8.23118500155802,8.23146300689315,8.23141621822158,8.23029579592268,8.23033754157785,8.23067573668988,8.23065198189828,8.23089937101741,8.23126058154166,8.23160749887381,8.23252895587445,8.23251770108608,8.23259162626212,8.2326024000989,8.23289513953742,8.23273033151109,8.23249126972262,8.23245784895595,8.23236131167387,8.23249744807256,8.23250836655911,8.23247205571595,8.23219736696629,8.2321050892786,8.23368032869089,8.23379419310674,8.23479740810668,8.23428415829377,8.23561065967469,8.23579233995605,8.23850077970245,8.23878220306933,8.2389691915898,8.23919850679236,8.23918823415616,8.23903106359169,8.23872216339171,8.2381310239142,8.23688817050778,8.23619755540058,8.23527381659214,8.23386002549948,8.23222517156963,8.23303937976383,8.23332889864412,8.23378304151016,8.23413407229377,8.23448325814992,8.23503061840697,8.23524281064144,8.23549522321849,8.23568032029594,8.23555929245524,8.2354277801154,8.23544648371158,8.23555636011217,8.23566553185512,8.23570571084279,8.23572818895517,8.23578519718813,8.23583517508458,8.23587126241971,8.23595217985431,8.23605074795735,8.2362337115775,8.2363203037743,8.23661111989622,8.2366051715825,8.23665780112501,8.23673286752362,8.23677186834187,8.23678526677678,8.23684820465956,8.23689654683224,8.23682544652985,8.23676205357314,8.23660857827881,8.23656947177834,8.23651246496045,8.23637186993213,8.2362254512924,8.23618500261457,8.23619612684233,8.23618186974566,8.23621430687195,8.23619039592126,8.23619350836097,8.23617388033278,8.23617543490181,8.23615669750376,8.23617294553902,8.23616522854591,8.23617608856104,8.23611929275972,8.23607936729704,8.23600410836424,8.235958580021,8.23591919181139,8.23590970238008,8.23587060928651,8.23586077116851,8.23581490580828,8.23579056331722,8.23568628900366,8.2356682691485,8.23566470368087,8.23563847947754,8.23564607435417,8.23559884240712,8.23559187773923,8.23555030364191,8.23547046788966,8.23527959927754,8.23523400273188,8.23525216855524,8.23528132895086,8.23529079415433,8.23528304352238,8.23519259670494,8.23515381218498,8.23511330162209,8.23508968106411,8.23504555315216,8.23495568900728,8.23469318069892,8.23450142089095,8.23439381767509,8.23426950763837,8.23425443477237,8.2342308043602,8.23417930024807,8.23415219947879,8.23389843785559,8.23386275436559,8.23337746075586,8.23311226396382,8.23293103762433,8.23283209577292,8.23263321965679,8.23249538215509,8.2321586415052,8.23139580918522,8.23115246419296,8.23097617424565,8.23084245872104,8.23084931354205,8.23116757381468,8.23119294076679,8.2310344441715,8.23105887300256,8.23095224378462,8.23083889837239,8.23064976673154,8.23065782829002,8.23066764004687,8.2306351902299,8.2304505769531,8.23030116846057,8.2301516431703,8.23004793901382,8.22984848093024,8.22956637456469,8.22967034659219,8.22971734608598,8.22999570410045,8.230284474022,8.23040160104331,8.23055497908961,8.23104915259413,8.23179875211172,8.23243745934833,8.23307107015297,8.23347414293345,8.23379402975832,8.23303307806999,8.23243057295488,8.2317557567502,8.23001059935546,8.22865470188703,8.22814993675549,8.22782551538422,8.22740794706461,8.2263433650876,8.22607078363284,8.22528866040576,8.22500629211769,8.2247788755288,8.2242355310182,8.22372338952037,8.22503498823757,8.22476964195969,8.22520251101798,8.22556990173745,8.22699215003177,8.22705504011845,8.22709202688574,8.22714912950352,8.22716460322435,8.22729567588052,8.22739367988692,8.22725939080135,8.22669622256985,8.22611433242038,8.2255054939726,8.22466702812873,8.22008296860725,8.21913855077807,8.21929487949472,8.21890011283497,8.21872999895062,8.21845795312061,8.21823912538523,8.2181295258091,8.2180212306421,8.21793089052649,8.21785723636104,8.21766024084293,8.2175534947519,8.21728129525455,8.21715465307967,8.2169342049984,8.21680511727001,8.21666327976797,8.21653202160126,8.21624514724331,8.21597825352688,8.21572041742037,8.21568166682638,8.21557348739345,8.21545529360215,8.21506971201886,8.21495552190382,8.21485216143402,8.21468972120134,8.21457805865411,8.21446331000991,8.21435183685362,8.2140760128943,8.2139193849855,8.21359249427848,8.21340843599831,8.21323836207406,8.21307188010156,8.21302028740484,8.21304444212532,8.21300048344716,8.21294253795806,8.21283084270064,8.21267676936718,8.21255959678499,8.21235860211494,8.21188696613747,8.21147366293834,8.21133670599307,8.21100620433018,8.21088342312381,8.21071165558542,8.21041838959023,8.21023913794283,8.21011969952605,8.20994231518542,8.20982202832957,8.20974109638109,8.20955555884858,8.20955671486811,8.20938909850605,8.20908797808648,8.20898565186232,8.20885141554915,8.20869626818325,8.2085875204755,8.20813832072065,8.20802769537857,8.20790983874568,8.20771459028434,8.20743730368028,8.20728039463171,8.20711323004852,8.20694979157492,8.20683201464638,8.20660027938067,8.20651975047263,8.20660745082631,8.20679137730566,8.20683048401617,8.20667244802225,8.20635646863058,8.2061565621676,8.20589849465539,8.20586796051725,8.20566660447752,8.20506254260071,8.2042495098554,8.2037843257745,8.20276106465898,8.20222459300986,8.20166551087685,8.20131184558632,8.20083203179914,8.20042015530665,8.20019331549846,8.20011668236411,8.19999627446019,8.1996842450231,8.19909763044503,8.19830500618873,8.19783759458237,8.19735584097361,8.19675414015363,8.19625808870466,8.19618922791522,8.19602449037866,8.1958994637777,8.19579952090261,8.19570954581201,8.19541621919317,8.19534575475692,8.19531982800727,8.19524803718139,8.19519728501878,8.19516396420761,8.19512712313617,8.19510587774343,8.1950400771378,8.19496987176774,8.19492127621643,8.19490185471698,8.19320812197041,8.19319671019445,8.1932191005266,8.19326310609824,8.19322557168019,8.19313778401586,8.19297734466683,8.19280657941731,8.19251046720094,8.19237284450728,8.19228735708758,8.19222253927587,8.19212616283203,8.19207613082092,8.19199571248182,8.19195334071046,8.19193984890365,8.19194302176198,8.19196460489855,8.1920172572564,8.19203306943332,8.19208694254269,8.19208710685145,8.19208020094164,8.19208350816452,8.19209989725604,8.19210915689832,8.19212879766031,8.19217369564509,8.1922366238387,8.1922675026345,8.1922249381575,8.19217069197726,8.19249344912446,8.19258897248627,8.19301051519096,8.19332599058762,8.19354090544668,8.19371996951817,8.19384104280638,8.19390402557303,8.19387476766713,8.19389368080197,8.19372169624429,8.19347642371806,8.1932990273467,8.19356756700986,8.19412335680118,8.19404436441339,8.19393880381372,8.1937118838614,8.19360467430544,8.19341357862443,8.19312477248789,8.19282797604486,8.19256105393836,8.19256646028565,8.19260950009314,8.19255528856939,8.1925378187188,8.1925325160276,8.19256160423756,8.19258784727196,8.19260297788649,8.19262614430452,8.19263982345373,8.19264189854345,8.19261718248982,8.1926135423801,8.19261985619145,8.19266324153919,8.1926882643545,8.19270590105271,8.19266773828892,8.19263120506609,8.19256341900082,8.19249467280287,8.19245928376517,8.19240498860313,8.19234512607707,8.19195579832079,8.19165203449003,8.19138766376421,8.19122137161461,8.19098613589154,8.19076358525582,8.19080122149592,8.19082649809383,8.19088771614082,8.19098452549627,8.19104851168534,8.19106956817296,8.19099786966845,8.19083019846714,8.19078761758369,8.19071452369714,8.1906966853094,8.19072551180934,8.19072687629786,8.19067001120116,8.19058789837111,8.19057136977598,8.19053144509838,8.19046880669047,8.19044026538164,8.19040571826651,8.19039794219573,8.19040128779078,8.19039774893952,8.19037982537079,8.19035074815945,8.19031775196265,8.19029799903268,8.19023128866858,8.19019370484882,8.19012820869718,8.19010076794584,8.19005982475263,8.1900152206238,8.18998918425593,8.1876092672391,8.18755647853075,8.18366446323361,8.18341339634815,8.18306723302077,8.18018659989452,8.17976358069021,8.17951866852656,8.17942583318974,8.17807730303057,8.17786491200801,8.17758467356467,8.17744194466142,8.17726015142398,8.17714337620172,8.17706457443678,8.1770425940361,8.17689305294237,8.17679104649822,8.17655013823977,8.17647606390139,8.1763341071991,8.17601204206045,8.17580836439791,8.17577696715045,8.17579316332535,8.17577383029283,8.17574898929344,8.17555912711826,8.1754377358968,8.17535495911723,8.17525135212609,8.17555911604624,8.17549688404609,8.17559995453964,8.17564701427778,8.17597844423467,8.17602471092015,8.1760581354877,8.1760967136103,8.17612531116998,8.17611977047442,8.17586308626892,8.17582617106498,8.17584083233015,8.17590615649794,8.17581855804091,8.17573500581252,8.17561617326528,8.1749578482132,8.17473985828608,8.17451229609244,8.17424728514208,8.17392148615975,8.17370152198558,8.17358030837435,8.17340750078257,8.17288857139072,8.17242142809411,8.17181882085211,8.17137024286166,8.17131367044548,8.17112353783199,8.17122645633715,8.17129706926241,8.17129008482827,8.17122531078124,8.17106559667048,8.17091662756537,8.17056324348818,8.17026309457498,8.16998958810034,8.16985733304122,8.16966241101006,8.16951507189867,8.16929351618405,8.16908175362834,8.16888506786226,8.16804798524728,8.16781559296156,8.16758468668987,8.16744147638837,8.16726990152306,8.16691723344616,8.16652086239352,8.16623858747233,8.16611253099105,8.16593832684335,8.16567721947959,8.1655056043957,8.16528815484711,8.16503232948723,8.16469384264778,8.16421934072117,8.1632008070958,8.16308420582237,8.16293357380376,8.16080487016904,8.16033928239968,8.15947010147047,8.15909425075247,8.15878578600695,8.1586923562827,8.15848601340936,8.15844912861652,8.15841349264174,8.15851208309183,8.15855889589203,8.15855951160582,8.15851697041312,8.15840587026313,8.15824024491703,8.1578552091143,8.157408214931],"lat":[47.1106170065572,47.1110326312014,47.1112130425809,47.1113222343354,47.1113534178189,47.1115025630788,47.1115540786326,47.1117128787506,47.111784247273,47.1117961301385,47.1118310445964,47.1118564805704,47.1118944063081,47.1119007726961,47.1119370166342,47.1119897547388,47.1120211185612,47.1120743616932,47.1121158190669,47.1121991403929,47.112278943717,47.1122977480455,47.1124243433719,47.1124469839268,47.1124727123708,47.1125076291201,47.1125778333854,47.1133381809579,47.1134425593319,47.1135248146351,47.1140105699612,47.114192191972,47.1142023368311,47.1143217812474,47.1143544403358,47.1144100321473,47.1144519464619,47.1145405528118,47.1145687960204,47.1145950590422,47.1146235843131,47.1147118665494,47.1147138099081,47.1147476878271,47.1147786293998,47.1148251759111,47.1148239047488,47.1148489457242,47.1148929929184,47.1149604989633,47.1150308639348,47.1150664911077,47.1151667842832,47.1152092104236,47.1152704794398,47.1152879998201,47.1153848091487,47.1154434669,47.1154818730569,47.1155331203158,47.1156029571497,47.1156543445584,47.115697963497,47.1157566655143,47.1155850824337,47.1152226951344,47.1151556556952,47.1152393466983,47.115304219487,47.1154087676414,47.1154631434844,47.1155521546477,47.1156023414743,47.1156741952321,47.1156847009409,47.1156848133694,47.115748781096,47.1157670401078,47.115806109226,47.1158209887131,47.1159027025371,47.1159595507771,47.1160470685011,47.1160804397457,47.1161840311649,47.116248065947,47.1162909480592,47.1163412684855,47.1164276325745,47.1165374685622,47.1165690562008,47.1166329801113,47.1167984312702,47.116926694181,47.1169759468331,47.1170419250335,47.1170752352766,47.1171388692644,47.1171912625522,47.1173085552318,47.1173527262415,47.1173743434149,47.1174654612558,47.1175773616668,47.1176965649811,47.1187243981252,47.1202986514643,47.1211886065494,47.1214288503944,47.1214881851801,47.1218571703113,47.1218866206486,47.121978064956,47.1219989563281,47.122249403849,47.127856543987,47.1214427914398,47.1208756246777,47.1206851856211,47.1204573177924,47.1202705582297,47.1201309641633,47.1202322802888,47.1203908407357,47.1202886223315,47.1202636588443,47.119519009011,47.1194564033089,47.1194064105336,47.1193703587033,47.1193492789147,47.1190216103838,47.1189935164583,47.1193326430111,47.1197195833562,47.1202211064643,47.1203721120748,47.1205620241504,47.1205690351731,47.1205277741302,47.120465711803,47.1204390167795,47.1203308077317,47.1203273755858,47.1203090811414,47.1198833042818,47.119754008458,47.1198549907796,47.119894555889,47.1199443619019,47.1200048974358,47.1200563374551,47.1201236801283,47.1201930206457,47.1202449213431,47.1203370382252,47.1203854184507,47.1204307947544,47.1204943903929,47.1205701786362,47.1206299298653,47.1206598457355,47.1206934693875,47.1207367718565,47.1208074515701,47.1208607722568,47.120961790342,47.1213761300627,47.1216361870353,47.1221019754466,47.1223995215425,47.12251581529,47.122416424236,47.122401158944,47.1224018422541,47.122384054903,47.1223384432424,47.1223181048658,47.122276329441,47.1222167264136,47.1221893900711,47.1221258151559,47.1220985778355,47.1220717415136,47.1220170668983,47.1219750171745,47.1219416091775,47.1219114027306,47.1218877678843,47.1218586634126,47.1218348433039,47.1217642125444,47.1217151732319,47.1216700880057,47.1215786588787,47.1215305704343,47.1214392580297,47.1213677899897,47.1213423153867,47.1213262066098,47.1212960346798,47.1211533411418,47.1211238698289,47.1210683095268,47.1210404947005,47.121010668707,47.1209786727638,47.1209543362357,47.120930370681,47.1208948723618,47.1208661808569,47.1208439672747,47.1207683281899,47.1207271536678,47.1206835161837,47.1206424615341,47.1206249864644,47.120597068874,47.1205572184452,47.1204154065948,47.1203483919571,47.1203179969918,47.1202150958034,47.1201505689509,47.1200842723129,47.1199937890567,47.1199202089683,47.1199142503692,47.1199889112815,47.120108115604,47.1197778455275,47.1196870588488,47.1196166473319,47.119665867178,47.1197522924581,47.1198057409381,47.1198410951878,47.1198555217501,47.1198966023473,47.1199374486038,47.1199464025109,47.1199710546089,47.1199950859764,47.1200533689092,47.1200877915517,47.120178337923,47.1202095876221,47.1202455828121,47.1202767656468,47.1203028908522,47.120322662504,47.1203530403177,47.120345862147,47.1203254443528,47.1203197676435,47.1203191263174,47.1203375044076,47.1203513773477,47.1203752358597,47.1204424534294,47.1204465028378,47.1204397448029,47.1204453925185,47.1204522735048,47.1204762788109,47.1204968711024,47.1205120649231,47.1205278302199,47.1205374261725,47.1206181473237,47.1206505383293,47.1206660431046,47.120692407363,47.1207067417525,47.1207177702795,47.1207240106086,47.1207425758744,47.1207652288212,47.1208409352688,47.1208794112688,47.120961614208,47.1210017655313,47.1211252912421,47.1211573572186,47.121181615509,47.1212137185322,47.1212231381058,47.1213123047423,47.1214027036125,47.1215549484391,47.1215764451062,47.1216140170346,47.121659975706,47.1217021598373,47.1217326796871,47.1217862607459,47.1218816234837,47.1219241698179,47.1219872123872,47.1220115129768,47.1222515617362,47.1223754515399,47.122360607823,47.1224092611926,47.1224453678697,47.1224994392038,47.1226093986059,47.1227354223749,47.1228477548291,47.1228771353331,47.1229069322134,47.1229669611171,47.1230323597471,47.123109051127,47.1231806863584,47.1232398345026,47.123273869789,47.1233095725266,47.1233318065113,47.1233162582437,47.1233166512197,47.1233491047055,47.1233772297076,47.1233896642829,47.1234242856617,47.1235346050463,47.1235861363811,47.1236893784153,47.123731433493,47.1238000968891,47.1238306107422,47.1238464407695,47.1238542579981,47.1238843911473,47.1239170913399,47.1239394213629,47.1239406547292,47.1239257377194,47.1239688108862,47.1240353728801,47.1240561616161,47.1241073123061,47.1242766797667,47.1243594657249,47.1244701236897,47.1244783665529,47.1244757293053,47.1247933815663,47.124831348792,47.1248754714954,47.1249019740501,47.1250234247847,47.1251093356102,47.1251502721599,47.1252328599963,47.1253021341885,47.125422029226,47.125462199227,47.1255530708607,47.1257485772417,47.1258556388085,47.1259155152412,47.125933743596,47.1259788539441,47.126018131396,47.1260430279572,47.1260754896877,47.1261133382478,47.1261302884116,47.1261573980973,47.1262158046161,47.126271648063,47.1263606947058,47.1264487746542,47.1265346489843,47.126584112236,47.1267139745901,47.1267964926246,47.1269363818556,47.1270394123786,47.1270738840681,47.1271469642838,47.1271949704808,47.1272129113091,47.1272900093833,47.1273195814895,47.1273226084081,47.1285943557589,47.1291372452414,47.1292848870858,47.1300883974087,47.1304338444572,47.1311060042307,47.131800495678,47.1318748426562,47.1319060389758,47.1319827233096,47.1322255982634,47.1323555882411,47.1326597818872,47.1327654292983,47.1330484682496,47.133129048192,47.1332973397322,47.1341790388782,47.1345780729825,47.1349273494999,47.1350527007742,47.1352105402384,47.1363742541495,47.1369502267579,47.137764478825,47.1381240636834,47.1384182895676,47.1390094996349,47.139393255153,47.1396210069402,47.1398734585968,47.1402077063731,47.1405819361526,47.1408657999478,47.1412659079898,47.1414460545712,47.1415796514711,47.1416064499534,47.1416332076382,47.1416475545842,47.1416726193831,47.1417788229269,47.1418413572315,47.1418626870588,47.1418458279077,47.1418371541514,47.1418921737554,47.1419057069236,47.1419337154662,47.1419668343582,47.1420042800649,47.1420527099542,47.1421081846065,47.1421780375835,47.1422211184842,47.1422633738125,47.1422901910747,47.1423069238634,47.1423330510891,47.142358406446,47.1424099196462,47.1424433772849,47.1424724504478,47.1425183332909,47.1425703621897,47.142597447415,47.142618986483,47.1426476539207,47.1426787339615,47.1427228038783,47.1427537352928,47.1427941224244,47.1428288522982,47.1428840557586,47.1428871938377,47.1429489011662,47.142982112185,47.143008403733,47.1430256112807,47.1430575235638,47.1431495084642,47.1431926029998,47.1432195478267,47.1432420509289,47.143272432241,47.143308376424,47.1433188851445,47.1433788965346,47.1434554195334,47.1435379374815,47.1435646152961,47.1436127533082,47.1437394763386,47.1446269879786,47.1433362055082,47.1430712765075,47.1428309248343,47.1426460091147,47.1424333578087,47.1421227669094,47.1418787908408,47.1418361808594,47.1416074511246,47.1414569139036,47.141016964541,47.140792423557,47.1406664698423,47.1401760898563,47.1399342519507,47.1390357654422,47.1384936158114,47.1381219701153,47.1379912239457,47.1378128359569,47.1376662220254,47.1376423800355,47.1375144731712,47.1373840921536,47.1372045407058,47.1370393492882,47.1368260888082,47.1361743258522,47.1359895148174,47.1358080374947,47.1347471181295,47.1345021641528,47.1343570562424,47.1342745496203,47.1340956441191,47.1337020001378,47.1335244002787,47.1332127315108,47.1330590882626,47.1329147335905,47.1328111348646,47.1326547412583,47.1311086640638,47.1301170134864,47.1300503956687,47.1299895620929,47.1299334367116,47.1298341136075,47.1297202705284,47.1293946075636,47.1293804726632,47.1293543707339,47.1293689587127,47.1292666668425,47.1289920086886,47.1286081470516,47.1285808880605,47.1285548022646,47.1285092009869,47.1284597413778,47.1283895407427,47.1279999784686,47.1278814272699,47.1272523101722,47.127210711266,47.1268961131762,47.1256167081139,47.1254277789871,47.1253019706496,47.123851532698,47.1222230578881,47.1215168916345,47.1208382258518,47.1205043906119,47.1201017830921,47.1195898583616,47.1184890008239,47.1176924537343,47.1170144098864,47.1166168326694,47.115909285673,47.1147656062261,47.1143623090222,47.1142359208716,47.1140558698746,47.113934334533,47.1138732235854,47.1138074828222,47.1137769489795,47.1137272727773,47.1136841165279,47.1136035025899,47.1133538847112,47.1133126373836,47.1132672230092,47.1131815322626,47.1131729150566,47.1131489215697,47.1131369493433,47.1131191788586,47.113093273925,47.1130879722958,47.1130406568796,47.1129871428755,47.1129957264147,47.1128601276036,47.1128482410572,47.1128068300287,47.112773206129,47.1127288672092,47.1126951136171,47.1126655137929,47.1125866398102,47.1124300476746,47.1123503391946,47.1122319822186,47.112180719276,47.1121351846395,47.1119287095,47.1116442759253,47.1113496170396,47.1112985092635,47.1112542071205,47.1111717106545,47.1111152957768,47.1110225321403,47.1109767830182,47.110939585462,47.1108987865958,47.1108537691081,47.1107805645128,47.1107055129438,47.1106589781627,47.1106198644486,47.1105084302833,47.1104593525551,47.1103978816155,47.1103569556094,47.1103161988972,47.1102562591345,47.110160587772,47.1100768749081,47.1098376288669,47.1097768102864,47.1097390635251,47.1096492828114,47.1095982804941,47.1094912753732,47.1094251808318,47.1093459950736,47.1090869425655,47.1087452185116,47.1086869747,47.1086264900175,47.1085939046958,47.1085534859573,47.1084947550317,47.1084328730074,47.1084003356618,47.1083199190009,47.1082952914412,47.1082613608142,47.1082111595322,47.1080433520791,47.1079772774958,47.1078858469353,47.1077553031585,47.1076993664169,47.107527592757,47.107450220308,47.1073970024176,47.1070164464872,47.1070249600448,47.1060945260053,47.1052999461243,47.1048904074037,47.1046245045451,47.1037578351686,47.1033205511543,47.1030093697492,47.1021596057915,47.1015352245007,47.1011066233193,47.1008791076497,47.1007653320333,47.1004740812656,47.1003623728516,47.1001034724881,47.0999238465598,47.0996971877164,47.0997005685621,47.0991413705847,47.09834255343,47.0980910113133,47.0977911134184,47.0976005050515,47.0972613562714,47.0970899087702,47.0968457058876,47.0961041513354,47.0959644157501,47.0954067158348,47.0949149841403,47.0940962790038,47.0935193959631,47.0934206745033,47.0933061051725,47.093184805853,47.0931848527903,47.0930612456441,47.0928303552464,47.0927457195496,47.0925558632605,47.0923144718133,47.0921692212463,47.0919614089201,47.0915728829645,47.091160237641,47.090959421053,47.0907793128011,47.0906168531966,47.0902693766258,47.0904525823107,47.0905025372461,47.0904615346143,47.0903730646368,47.0899647825856,47.0896819502602,47.0883512562363,47.0882281257198,47.0876327281277,47.0875030183812,47.0867412478142,47.0863375441944,47.0858937278731,47.0857118181488,47.0850983703559,47.084361189202,47.0835552850448,47.0835220241881,47.083312525831,47.0827345128297,47.0823733804502,47.0820951341271,47.0800646996827,47.0799855810636,47.0787749177805,47.0767269548982,47.0753627524867,47.0752950287318,47.0752179388707,47.0751430491361,47.0750401117915,47.074962176719,47.0748672260634,47.0747528720315,47.0747093293609,47.0747685289569,47.0748319500963,47.0749124051494,47.0749833806046,47.0750350481672,47.0750544763893,47.0750680132702,47.0750538163836,47.0751013020199,47.0751431318103,47.0752069030777,47.0752029256581,47.075058798929,47.0749930045714,47.0749130681436,47.0749824044615,47.074932910307,47.0748639438612,47.0748502678729,47.0748576078643,47.0748108092992,47.0748196351001,47.0748017341408,47.0748203498663,47.0749144664535,47.0750345608516,47.0751589932478,47.0752834619108,47.0753147066057,47.0753349342685,47.0753228300167,47.0753011128175,47.0752858069691,47.0753525163138,47.0751937577041,47.0751056873936,47.0751720376284,47.0752325832892,47.0752498663229,47.0751808358992,47.0749525043949,47.0749305840414,47.0749893993754,47.0749570047789,47.0749043402078,47.0746424070736,47.0745597856545,47.0744122883006,47.0743588332374,47.0743006984684,47.0740633194816,47.0739146580923,47.0738548748744,47.0734915558258,47.0732393012838,47.0731657704995,47.0731400913926,47.0730870841947,47.0729978472487,47.0729325524492,47.0728332209205,47.0727788756739,47.0725276363287,47.0723426356149,47.0718699173384,47.0715623497268,47.0713152816644,47.0712903415056,47.0712404599189,47.0708859917276,47.0704903798614,47.0702352944809,47.0701766756215,47.0701300537171,47.0700602099567,47.0698807743629,47.0697415172247,47.0695739196202,47.0696861453889,47.0699468951948,47.0696025333846,47.0693802453568,47.069210063168,47.0691324821228,47.0689436662737,47.0690204133285,47.0688705304147,47.0686789639202,47.0690430384519,47.0688907085951,47.0689462060938,47.068806640495,47.0687904620887,47.0688550466187,47.0689171023402,47.068946762152,47.0689560086326,47.0689320164119,47.0689169455005,47.0688784271064,47.0688318540369,47.0688114089103,47.0688077693022,47.0688103057064,47.068806847438,47.0687695810037,47.068772858743,47.06876249212,47.0687623321097,47.0713072962677,47.0713356077042,47.071406344239,47.0716377581707,47.0716444993448,47.0716916629117,47.0717444577622,47.0717829815323,47.0718119108945,47.0718619195402,47.0718863990099,47.0719538756796,47.0720280089552,47.0720598928225,47.0720872173511,47.0720917409783,47.0721285665466,47.0721585453211,47.0721887811976,47.0722412568192,47.0722899440547,47.0723768189491,47.0724119448107,47.0724405234244,47.072462252554,47.0724938897607,47.0725288210475,47.0725632344881,47.0726007296173,47.0728859650211,47.0730923232654,47.0734926716638,47.073903180429,47.0744369716219,47.0749968284571,47.0750387687308,47.0750849123428,47.0751710255658,47.0752722973022,47.0753985972286,47.0755802585709,47.0758111821302,47.0758751048568,47.0759485579128,47.0760165462263,47.0761359195683,47.0762241093047,47.0764479314047,47.0766825102297,47.0769108769087,47.0771510153388,47.0773643702445,47.0775875412861,47.0776972023863,47.0777443974022,47.0777764003747,47.0778106552357,47.0778439615392,47.0779320310279,47.0779482293554,47.0779606867432,47.0779785136182,47.0780318638579,47.0780328530225,47.0780275286853,47.0780348601056,47.0780466484082,47.0780775567378,47.0781043058498,47.0781197454451,47.0781260993487,47.0781394821718,47.0781623046187,47.0781818141159,47.078172059983,47.0781450598818,47.0781349953152,47.0781382499139,47.0781567047482,47.0781491185121,47.0783961654193,47.0784829826261,47.0784287635585,47.0784582780949,47.0785199974167,47.0786233717047,47.078829119139,47.0791103195831,47.0793064674837,47.0795427715038,47.0797681361034,47.0799267663292,47.0800715213221,47.0802265295273,47.0803076765046,47.0804281439715,47.0806566528452,47.0807862671996,47.0809380099443,47.0811471733097,47.0811392010197,47.0811146439025,47.0811279753814,47.0811057708688,47.0810913311404,47.0810674315969,47.0810556895532,47.0810322617501,47.080998696239,47.0809873444078,47.0809825781711,47.0809678527153,47.0809631514103,47.0809322658979,47.0808946322517,47.0808799033946,47.0808697471705,47.0808752322005,47.0808731940485,47.0808589447238,47.0821804794299,47.0820978863149,47.0832560664879,47.0832439309286,47.0833720185871,47.0825141626006,47.0835999034091,47.0841933848094,47.0842893338174,47.0847783690003,47.0848094199008,47.0847718224804,47.0847834445228,47.0848368758963,47.0849161555884,47.0850283839685,47.0852024049958,47.0854166450219,47.0855069836796,47.0856384232731,47.0857316407139,47.0860006128421,47.0863982042599,47.0869256386385,47.0872341099275,47.087812486596,47.0885549769034,47.0887570003171,47.0895640908893,47.0899131590227,47.0902650379095,47.0906356615149,47.0923642444155,47.0923692309792,47.0929473559296,47.0931110478311,47.0939256430916,47.0940516405366,47.0941833963891,47.0944207151675,47.094526145688,47.0946298972104,47.0950626261196,47.0951942933808,47.0954548925138,47.0956361788755,47.0959022193002,47.0960238319647,47.0960895400113,47.0963503228947,47.0964011032192,47.0964051867862,47.0964352091423,47.0965633897197,47.096702802458,47.0967498133478,47.096798943959,47.0969219871585,47.097073473433,47.0971945181689,47.0974807303139,47.0975533051818,47.0979843213722,47.0982571047592,47.0984889134456,47.0986043676749,47.0987130748946,47.0988736691902,47.098988705577,47.0992265968654,47.0994552609028,47.0996951966614,47.0998692783701,47.1002886463617,47.1005353346284,47.1008267602292,47.101042373777,47.1011879797285,47.1018861740027,47.1020414766296,47.102372996077,47.1024923359689,47.102582557784,47.1027858999595,47.1030327310777,47.1031805293035,47.1031935605724,47.1031612092289,47.1030544674667,47.1030002315569,47.1029710671,47.1029652086114,47.1029830614423,47.1033011348117,47.1037701855523,47.1038376743002,47.1039693967332,47.1059414097466,47.1063811436219,47.1072137922087,47.1075386282883,47.1077781257195,47.1078748522766,47.1081863011271,47.1084408282686,47.108777582299,47.109338629574,47.1097133491319,47.1098376598457,47.1099565737286,47.1100809541025,47.1101864257287,47.1103689198204,47.1106170065572]}]],[[{"lng":[8.157408214931,8.15728267073652,8.15689173220656,8.15652638674861,8.1556124469027,8.15542326377977,8.15525154726376,8.15493273589494,8.15451697471928,8.15369306664639,8.15318529584092,8.15311120687379,8.15282027645206,8.15198248942342,8.15175675190414,8.15152185965987,8.15097625662112,8.15066619273659,8.14992017361212,8.14945101505055,8.14917577038276,8.14888988851575,8.14861351500502,8.14795254776241,8.14773405055266,8.14698224601123,8.14643326023803,8.14627425260613,8.14575833134721,8.1455328941118,8.14487370378343,8.14406792817796,8.14350161228155,8.14259578383446,8.14209328962892,8.14211282416579,8.14153607290642,8.14023050985483,8.13971715128311,8.1392221167101,8.13893118981525,8.1389221483709,8.13856517684137,8.13826670332616,8.13803793103739,8.13768522226057,8.13716806782453,8.13707329671809,8.13577964875426,8.13527535073029,8.13321801798377,8.13327260894006,8.13295633379539,8.13298868139938,8.13242475053906,8.13199182007013,8.13164975581855,8.1308498788848,8.1297257265609,8.12947716597912,8.129268424717,8.12938752942235,8.12949188350537,8.12947085759406,8.12950736927038,8.12954385344394,8.12954500361031,8.12956499468077,8.12939305790788,8.12906792426153,8.12881931231899,8.12795960527211,8.12075196112327,8.12080254411186,8.12063880672586,8.12032524745552,8.12008016446133,8.11987627634311,8.11946671161409,8.1192360521206,8.11904217593959,8.11872236635729,8.1184334695631,8.11428533179937,8.11422138507159,8.11120216578136,8.10972593110482,8.10968826320826,8.10975849178745,8.10976147798917,8.10972067216941,8.10955228644709,8.10953028300126,8.10945296071017,8.10927536886305,8.10914518918312,8.1090600824,8.10894772348754,8.10888924432187,8.10873914483469,8.10838797781257,8.10829049278747,8.10672710231306,8.10475327644324,8.10463091675793,8.10449161591625,8.10430357695837,8.10433970739379,8.10440729919932,8.10389687466588,8.10322109468641,8.10288802920271,8.10217167012238,8.10168218466923,8.10199071955067,8.10216581144866,8.10226435995745,8.10233326851369,8.10603449397818,8.1068500656378,8.10702544389202,8.10726928820247,8.10808051175077,8.10815844997271,8.10820982601697,8.10831578276508,8.10842603564452,8.10850251393564,8.10856491514398,8.10866329679622,8.10868080907019,8.1087528281206,8.10885584916483,8.10898303258035,8.10904604477736,8.10924796825763,8.10926375656206,8.10953999879556,8.10959565263335,8.10963026884813,8.10976300683974,8.10990335786157,8.10997004278421,8.1101279136795,8.11025916392814,8.1104783329922,8.11067277454319,8.11073637302973,8.11097056678664,8.11108448068654,8.11130594583363,8.11148101252511,8.11167861305063,8.11224206207064,8.1126340393629,8.11269583377142,8.11274774404294,8.11282665204717,8.112891536169,8.11305360484863,8.11308591553217,8.11311136687327,8.1134920927584,8.11425040686582,8.11433698447527,8.11440387664,8.11444926248569,8.11446307068459,8.1144735870495,8.11450073299968,8.11455749777056,8.11464312649596,8.11476030151727,8.11495309902489,8.11515343975478,8.11593286344055,8.11610891733637,8.11627389631642,8.11640192534449,8.116477812464,8.11660178409705,8.117254636154,8.11757327461926,8.11855606837974,8.11909463418713,8.11976826478357,8.12042455708561,8.12025585017919,8.12193878097271,8.1220540956447,8.12375215224784,8.12394174031184,8.12435045211942,8.12455550724792,8.12463981354961,8.12469568542203,8.12510179854639,8.12520463856704,8.12529689363481,8.124585658277,8.12608601012337,8.1260556691037,8.12715081390187,8.12745562466605,8.12850163944205,8.12930048065789,8.14223185574039,8.16475951242095,8.17750965084198,8.16920923636941,8.16883981121046,8.16881783447631,8.16864331592615,8.16860644949405,8.16803221632991,8.16796871852082,8.16849174289166,8.16794024976046,8.16579417551345,8.16419893222583,8.16390202260432,8.16386627295171,8.16377432593811,8.16379026809417,8.16376812519792,8.16380149784482,8.16380798374047,8.16387099361065,8.16391248652733,8.16389077328521,8.16391987443617,8.16387130618785,8.16377737935214,8.16367095103103,8.16358047006314,8.16360249247431,8.16362684845277,8.16358133875475,8.16347743608223,8.16336714646856,8.16324755942976,8.16317599102097,8.16311504941467,8.16304908043348,8.16302351913538,8.16298088771376,8.1629784621407,8.16291397700574,8.16276438278,8.16258650386538,8.16246920455623,8.16238482326585,8.16229513453867,8.16229133670904,8.16234557694313,8.16232354310844,8.16226048495499,8.16204159265134,8.16193611995626,8.16132304673822,8.16097822320863,8.1607789719703,8.16072898336697,8.16071569369693,8.16063795693652,8.1606324305408,8.16059890469217,8.16058882468501,8.16050322738668,8.16046272255621,8.16040719975972,8.16039501946966,8.16032416046659,8.16032797636784,8.16027702246897,8.16019620885638,8.16016569113121,8.16012525679669,8.16007462204531,8.16001663660908,8.15999192201321,8.15994201334323,8.15991195717845,8.15981630443711,8.15980647280524,8.15976437528847,8.15976263804082,8.15968135735048,8.15960044153356,8.15955183572263,8.15953418757534,8.15939584615161,8.15937116150908,8.15913841728069,8.15940866008383,8.15947653292908,8.15957512545185,8.15743204835447,8.15741706086388,8.15739070118574,8.15736223797184,8.15735064228886,8.15737591637368,8.15736651988884,8.15730133423261,8.15719885250568,8.15713378608454,8.1571093420207,8.15708876204158,8.15708714591982,8.15706299571596,8.15703095824217,8.15701827513731,8.15702793487249,8.15696087479913,8.15688457079333,8.15680393852416,8.15664945592348,8.15662923888085,8.15661544833022,8.15663944570936,8.15660027327897,8.15645081318675,8.157408214931],"lat":[47.1106170065572,47.1094148636188,47.1090515137829,47.1090866460026,47.1089843061737,47.108944116407,47.1088503946055,47.1083569668745,47.1085668879106,47.1089241699513,47.1093379601024,47.1092220847666,47.1093879926174,47.1097011456699,47.1098229383652,47.1100093733126,47.1102969596338,47.1104814836767,47.1110369789953,47.1112483090088,47.1114282959666,47.111679698282,47.1118434094176,47.1120793049043,47.11218411579,47.1127386286798,47.1129525966606,47.1130018706987,47.1130538344628,47.1131026253933,47.113304570927,47.1135722226402,47.1137444098981,47.113980776249,47.1140457653209,47.1141024957423,47.1141480301145,47.1143468993384,47.114410837836,47.1144986886791,47.1145351912124,47.1145138466034,47.1145269579562,47.1145153352498,47.1144761492725,47.1143766206263,47.1142112372886,47.1141482075918,47.1133355656614,47.113191972332,47.1137578572043,47.1141076218673,47.1142177713822,47.1142624352954,47.1144582466806,47.1146001487238,47.1146993499616,47.1148569960899,47.1150656366539,47.115104082405,47.1151291644689,47.1154368054538,47.115828757187,47.1158301428195,47.1160231858625,47.1163684192202,47.1164995446588,47.1166917963763,47.1167040911855,47.1167503179764,47.1168028130825,47.1171157944197,47.1218263714653,47.1222107512969,47.123191929238,47.1237435025107,47.123926441795,47.1241642231596,47.1243345163702,47.1247175564922,47.1248942896383,47.1251081166346,47.1254089324475,47.1279824184294,47.1280171375972,47.1291531995075,47.1298846368601,47.1299037374566,47.1299818376746,47.1300329398316,47.1301014332555,47.1302095209144,47.130217538,47.1302603021866,47.1303458742193,47.1304368725921,47.1305254043421,47.1305996485665,47.130645234999,47.1307233959004,47.130864155343,47.1309105352294,47.1319003229843,47.1328058245373,47.1331834572392,47.1335259807496,47.1339477185894,47.134322211961,47.1344927289009,47.1347661658125,47.1350896872027,47.1353787449739,47.1358008833395,47.1380643038722,47.1381749019508,47.138262305721,47.1383439080806,47.1384463251944,47.1401203857687,47.1404674078232,47.1402383981551,47.1400945522506,47.1395876810895,47.1396141321232,47.1396396312715,47.1396706775892,47.1397142470406,47.1397261791682,47.1397498869042,47.1398192513831,47.1398397033322,47.1398787456671,47.1399500978772,47.1400476020654,47.1400832155649,47.1401821549689,47.1402091383628,47.1403505779526,47.1403680638468,47.1403931203812,47.1404560589277,47.1405110641604,47.140535636668,47.140577946196,47.140620977586,47.1406745325793,47.1407315327993,47.1407244059803,47.1407922645245,47.1408099579777,47.1408184142714,47.1408200262935,47.1408303304932,47.1409225259704,47.1406291834115,47.1406442481261,47.1406689955302,47.1406684882466,47.14068393054,47.140773579954,47.1408027957355,47.1407845662896,47.1410322194071,47.1412977590578,47.1412927531081,47.1416156821455,47.1418964242298,47.1420671611114,47.142375102407,47.1425580393129,47.1427363946038,47.1429015193357,47.1430611874883,47.1432500591032,47.1433972294983,47.1438838068345,47.1439991497484,47.1441446284039,47.1442935537188,47.1444185531078,47.1444916010132,47.1437517964223,47.1437670975987,47.1437492592678,47.1437878492903,47.1441951133966,47.1445817964434,47.1447287062825,47.1457320835074,47.1456269739793,47.1441487232046,47.1439654243006,47.1435953033044,47.1434372145572,47.1434852498726,47.1435036716812,47.1438480760931,47.1439605946796,47.1440979040345,47.1446283538199,47.1452998301894,47.1453580841889,47.1457089684828,47.1457428101231,47.1459619987059,47.1463755807853,47.1531514038906,47.1370032622615,47.127856543987,47.122249403849,47.1219989563281,47.121978064956,47.1218866206486,47.1218571703113,47.1214881851801,47.1214288503944,47.1211886065494,47.1202986514643,47.1187243981252,47.1176965649811,47.1175773616668,47.1174654612558,47.1173743434149,47.1173527262415,47.1173085552318,47.1171912625522,47.1171388692644,47.1170752352766,47.1170419250335,47.1169759468331,47.116926694181,47.1167984312702,47.1166329801113,47.1165690562008,47.1165374685622,47.1164276325745,47.1163412684855,47.1162909480592,47.116248065947,47.1161840311649,47.1160804397457,47.1160470685011,47.1159595507771,47.1159027025371,47.1158209887131,47.115806109226,47.1157670401078,47.115748781096,47.1156848133694,47.1156847009409,47.1156741952321,47.1156023414743,47.1155521546477,47.1154631434844,47.1154087676414,47.115304219487,47.1152393466983,47.1151556556952,47.1152226951344,47.1155850824337,47.1157566655143,47.115697963497,47.1156543445584,47.1156029571497,47.1155331203158,47.1154818730569,47.1154434669,47.1153848091487,47.1152879998201,47.1152704794398,47.1152092104236,47.1151667842832,47.1150664911077,47.1150308639348,47.1149604989633,47.1148929929184,47.1148489457242,47.1148239047488,47.1148251759111,47.1147786293998,47.1147476878271,47.1147138099081,47.1147118665494,47.1146235843131,47.1145950590422,47.1145687960204,47.1145405528118,47.1144519464619,47.1144100321473,47.1143544403358,47.1143217812474,47.1142023368311,47.114192191972,47.1140105699612,47.1135248146351,47.1134425593319,47.1133381809579,47.1125778333854,47.1125076291201,47.1124727123708,47.1124469839268,47.1124243433719,47.1122977480455,47.112278943717,47.1121991403929,47.1121158190669,47.1120743616932,47.1120211185612,47.1119897547388,47.1119370166342,47.1119007726961,47.1118944063081,47.1118564805704,47.1118310445964,47.1117961301385,47.111784247273,47.1117128787506,47.1115540786326,47.1115025630788,47.1113534178189,47.1113222343354,47.1112130425809,47.1110326312014,47.1106170065572]}]],[[{"lng":[8.17750965084198,8.16475951242095,8.17479432176833,8.17483969539334,8.17515768864281,8.17557173760884,8.17755615729804,8.17913767195627,8.18129705757099,8.18269447927565,8.18300999089264,8.18297542916546,8.18301647041816,8.18316882467275,8.18328611870757,8.18331395312107,8.18335423662542,8.18336835159419,8.18339868880265,8.18336084465806,8.18342308407083,8.1835071705235,8.18359763836708,8.18363606624695,8.18378476322535,8.18389650215899,8.1839980849425,8.18410640064742,8.18421425458623,8.18423187690456,8.18437996802686,8.18447103448638,8.18449734687506,8.18470778339445,8.18489959517911,8.1851859499535,8.18529013651566,8.18535192148068,8.18544672224542,8.1854584177503,8.18583984066219,8.18603077074828,8.18614630477992,8.18639593997715,8.18706219995273,8.1880446791762,8.18850681621803,8.18904286567353,8.18953465077813,8.19004311160158,8.19029617176239,8.19124144867472,8.19134991997765,8.19246021051182,8.19402820455495,8.1949589919949,8.19495941025846,8.19532351821162,8.1956077529501,8.19587974431634,8.19608276713044,8.19638390993391,8.19667350614313,8.19686738054976,8.19770921162274,8.19820340770992,8.19867041247465,8.19915987710291,8.1996361185962,8.20024961467149,8.20067501064993,8.20118798312074,8.20121010076409,8.20168192731827,8.20220973031823,8.20318125564979,8.20415560972409,8.20434157936042,8.20434598642281,8.2039840731132,8.20432908112604,8.2045970586028,8.20489694611227,8.20503458406722,8.20528603365011,8.20545046891677,8.20561216504642,8.20600953549943,8.20681892631508,8.20730341985839,8.20736581888857,8.20740529178683,8.20749528967228,8.20765574883552,8.20771683071442,8.20778822755222,8.20785244439534,8.20791064077372,8.20794405333378,8.20811824180333,8.20826575524305,8.20847989773451,8.20859114471222,8.20911242989337,8.20870703724733,8.20854012330915,8.20833649986565,8.20815651975779,8.20804152232131,8.20781643144543,8.20774472690525,8.20756609881728,8.20740458291057,8.20721658304184,8.20703343137201,8.20696475376788,8.20670492652055,8.20656477736504,8.20610167055958,8.20603866115102,8.20596456673249,8.20573162582242,8.20564934467116,8.20519285486876,8.20505201229511,8.20490081146013,8.20470620323034,8.20460259287634,8.20445823421996,8.2042948182854,8.20408316564062,8.20399860098562,8.20392974994186,8.20383252931402,8.20368376371608,8.20364147487395,8.20346940911762,8.20335635616138,8.20293310704878,8.20276830945712,8.20217779985361,8.20289761793354,8.20356245855411,8.20380028646866,8.203952426438,8.2031493287154,8.20380620547157,8.20321452615083,8.20410278165163,8.20586728560344,8.20656154644935,8.20689705250137,8.20694206102851,8.20973239997713,8.20975169297903,8.20974756233164,8.20968988060429,8.20946177573024,8.20941548616909,8.20938935811246,8.20951942826452,8.20954619658199,8.20956584028106,8.20935360741683,8.20999570099396,8.20993184288139,8.20991811782738,8.20988092224031,8.20985923800671,8.20985828647436,8.20982584687104,8.20979373730506,8.20973624829425,8.20972653642145,8.2096374010394,8.20964871858257,8.20960056708475,8.20959650016183,8.20955001844421,8.20957574532408,8.20955535207982,8.20959047054106,8.20964040522509,8.21063156287273,8.21166455009348,8.21264295032408,8.21497191999371,8.21603691692188,8.217380098558,8.21744614553889,8.21705732521815,8.21664220702484,8.21563493540833,8.21513050447526,8.21497156614062,8.21492289167242,8.21487324947692,8.21488724147186,8.21477529460385,8.21471721969306,8.2146642128911,8.21461474003786,8.21459004138435,8.21453624127404,8.21450616069053,8.2144698870569,8.21441643859722,8.21436264748813,8.21431723023982,8.21429698134245,8.21428771989688,8.21429303582349,8.21431152688607,8.21434748395098,8.21433402122517,8.21433645538451,8.21435598088616,8.21434562612348,8.21433116159364,8.2143350970509,8.21432641338778,8.21432381941835,8.21429184671135,8.21431690373434,8.21428095245636,8.21428292009328,8.2142972035235,8.21428218919569,8.2142575791398,8.21421645411858,8.21419545964256,8.21412808551442,8.2140951089653,8.21408647742869,8.21402388244292,8.21400377498561,8.21401155176257,8.21403533017411,8.21402692222422,8.21399819695329,8.21398152739028,8.21391978229457,8.21387409463967,8.21381432784761,8.21378751701882,8.21372157825803,8.21358330235132,8.21352847530847,8.21347457616874,8.21348149215902,8.21348272345787,8.21383634761712,8.21391493020324,8.21402976099997,8.21413916900931,8.21438759040877,8.21456625574184,8.21479037634635,8.21514752997068,8.21561722968047,8.21521352611178,8.21484684579249,8.21467221724059,8.21481967375566,8.21629867517278,8.21612159121518,8.2159422115499,8.21559453454388,8.21512881023243,8.21471160791007,8.21495405490438,8.21519396247577,8.21584693752419,8.21611948442659,8.21674075801117,8.21676988531684,8.21711586953083,8.21713440824425,8.2165854079919,8.21609196020478,8.21533191070746,8.21675274320273,8.21629801283888,8.21682959696835,8.2166224826682,8.21554805846977,8.21654250131413,8.2165258768834,8.21651059361007,8.21650119712761,8.21643797577487,8.21634594148776,8.21623455108459,8.21618956837626,8.21612147481539,8.21605943661051,8.21606272034156,8.21604502007206,8.21601679600161,8.21598696292414,8.21597336180662,8.2159723597498,8.21596180965648,8.21596847468237,8.21596017349887,8.21592867842066,8.21590151943323,8.21590650488143,8.21593942244683,8.21594666814528,8.21592521610001,8.21588186724862,8.21587842855227,8.21582112547086,8.21564977509265,8.21560201235935,8.21553898504076,8.21544128626787,8.21534560021397,8.21525798496342,8.21520187957128,8.21512545866841,8.21500098476187,8.2149507034095,8.21475089675215,8.21472128616419,8.21462150371254,8.21458126588302,8.21451240313887,8.21442140545783,8.21434305523787,8.21426896075391,8.21423212235637,8.21418419171911,8.21409300339825,8.21399215222713,8.21394770381154,8.21389581265547,8.21386433394024,8.2138406522541,8.21379111066311,8.21367370294254,8.21361605231936,8.21358962164502,8.21356192754585,8.21351150215902,8.2134078050369,8.21336200053759,8.21320590714804,8.21312954797611,8.21301779435509,8.21294649775975,8.21290351316153,8.21282158657655,8.21271937054568,8.21261743893946,8.21253061372878,8.21247670754981,8.21243586816129,8.21241398441853,8.21240291354357,8.2123752553369,8.21230888912826,8.21226943605098,8.21225767794593,8.21224953242771,8.21229227053629,8.21228838965386,8.21226842052559,8.2122469580419,8.21216906730564,8.21214076267124,8.21200129544987,8.21187424059043,8.21187487829722,8.21189948244484,8.21190328327339,8.211847624087,8.21183365903094,8.21181341111063,8.21176467402355,8.21173147285745,8.21171653969822,8.2117215800457,8.21163851968806,8.21156299394612,8.211528972219,8.21153588684988,8.21153436948096,8.21151131299031,8.21145341856145,8.21127168493214,8.21126176242191,8.21118066303078,8.21112622168504,8.21105018459802,8.21099702582215,8.21083747091732,8.21057851775985,8.21044722068818,8.21040103480886,8.21034861363437,8.21030793270191,8.21017370575061,8.20994131608296,8.20989004596043,8.20984660724469,8.20971793927961,8.20963237911508,8.20958494752879,8.20956073218479,8.20951490895938,8.20942997962423,8.20938457475323,8.20930876823665,8.209268942879,8.20922899760074,8.20912169918195,8.20907699444962,8.20902989777411,8.20895224169031,8.20887973243963,8.20869984690932,8.20864073486821,8.20858607808094,8.20849547740985,8.20833227453092,8.20823416155656,8.20806473309665,8.20797967410581,8.20788724868299,8.20780594995052,8.20769236896892,8.20763102772315,8.20749763172861,8.20745443720449,8.20742589713142,8.20732538077547,8.20724708693528,8.20714321592592,8.207027082849,8.20671254212656,8.20643816964074,8.20581969020192,8.20542160931482,8.20504376329204,8.20502970832265,8.20495973020988,8.20484234115087,8.20476788324838,8.20470657812145,8.20463305168872,8.20460065907864,8.20445347967719,8.2042182435966,8.2041748104581,8.20415781388881,8.2041339076106,8.20404333931404,8.20392689906258,8.20377502627714,8.20345758411021,8.20338120278242,8.20324238220385,8.20301055294929,8.20291955505952,8.20289996320529,8.20285669347076,8.20279884371485,8.20271334314386,8.20250806351738,8.2024656667591,8.20239504773563,8.2023487335631,8.20229752734419,8.20227179690759,8.20217824612967,8.20208456932018,8.20207107434425,8.2019381133189,8.20188241696717,8.20184898284921,8.20184359728072,8.20181097674393,8.2017370636012,8.20169575560013,8.2016767340469,8.20168358829736,8.20165831734545,8.20159440164406,8.20153558496806,8.20145699267342,8.20135584160567,8.20134368457201,8.20130159660187,8.20125934704345,8.20120914862381,8.2011377625204,8.20099880804851,8.2009485475843,8.20089693256045,8.20072965763584,8.20066490347576,8.20056172589951,8.20042782337275,8.20071886407315,8.20008040592066,8.20018516201746,8.20018872669406,8.20017163132536,8.20018916250493,8.20024746011952,8.20032993993899,8.20039988460042,8.20041798159693,8.20040288441407,8.20041707807041,8.20044884836188,8.20056775078787,8.20065567603293,8.20065097364837,8.20059997825829,8.20058850652591,8.20061252612136,8.20059202423002,8.20056680525713,8.20040132781519,8.20007707207958,8.19897675363429,8.19883690176165,8.19857483445519,8.19828138592852,8.19797128333846,8.1976900016756,8.19741061240929,8.19730209496221,8.19730400524772,8.19715290023143,8.19648705251388,8.19596530417314,8.19572003995684,8.19548473602384,8.19418145766,8.19403298803548,8.1938318458287,8.19368572050126,8.19346532966828,8.1907959954613,8.19081088149795,8.19044830588155,8.19033556841664,8.19023958020212,8.18963153018126,8.1889990460716,8.18832050777541,8.18779869837158,8.18644744678248,8.17750965084198],"lat":[47.127856543987,47.1370032622615,47.1469075286676,47.1469567929606,47.1471093945518,47.1475429030821,47.1494154190918,47.1504188501952,47.1495875306379,47.15105853863,47.1515803698844,47.1518449535172,47.151865332036,47.1519698691486,47.1520801649909,47.1521350625066,47.1521767824335,47.1522170255816,47.1522669865021,47.1522831079561,47.1524206465998,47.1525475553894,47.1525976037688,47.1526698743242,47.1527766651104,47.1528798451122,47.1529392211827,47.1530266185819,47.1531045019466,47.1532052779677,47.1533479088007,47.1533688261515,47.1534184530564,47.1534805321129,47.1535620532622,47.1535571735492,47.1536139499708,47.1537278871048,47.1537517478731,47.1538339420997,47.153976855622,47.1540932100474,47.154122953377,47.1540568449554,47.1539385715409,47.1546916158113,47.1550509682063,47.1550127615356,47.1546579670995,47.1542609640355,47.1543837151098,47.1556056255369,47.1575649979163,47.1576886468944,47.158172139344,47.1583770806235,47.1584253641271,47.1584157925407,47.1590436595673,47.1593890940866,47.1595835836411,47.1597650134783,47.1602019643246,47.1603134420651,47.1602683049918,47.160827775343,47.1616004204922,47.1614621961999,47.161295722348,47.1611167254936,47.1609633479347,47.1608568922387,47.1607717679887,47.1607757289819,47.1606552277989,47.1605666787684,47.160501859036,47.1603849525042,47.1600900152247,47.1599622888464,47.1599130839664,47.1599386462112,47.1601066684206,47.1601062376823,47.1599979337119,47.1597193719112,47.1596373015397,47.1595547301839,47.1595229925095,47.1594132992113,47.1593880646294,47.1593578558881,47.1593342269205,47.1592618227636,47.1592183634868,47.1591548568639,47.1590900399073,47.1590688179943,47.1590234656459,47.1588686358294,47.1586058796023,47.1583499905821,47.1581717886707,47.157133786511,47.1569284044722,47.1568548879129,47.1567898652641,47.1567559065755,47.1567464209313,47.1567475208407,47.1567581646808,47.1568210745649,47.15686897377,47.1569111127794,47.1569226173689,47.1569457258738,47.1569955397438,47.1570262851917,47.157110430452,47.1571150154235,47.1571475954304,47.1571789405341,47.1571969936569,47.157249805765,47.1572957828777,47.1573653063016,47.1574417029795,47.1574493099574,47.1574846414097,47.1574645540134,47.1574160655078,47.1573860621975,47.157338116819,47.1571893347667,47.1570860422951,47.1570788663833,47.1570079673753,47.1570422708241,47.1566439678817,47.1565416262573,47.1560616930297,47.1556219601098,47.155331575833,47.1551849827986,47.1549997399911,47.1541209289006,47.1538144674511,47.1531975948745,47.1528032938096,47.1524181418091,47.1523901591557,47.1524193310138,47.1525188685624,47.1519649608558,47.151914719122,47.1518357326679,47.1517245153257,47.1515376653888,47.1514584126175,47.1513223637996,47.1512667744731,47.1511825706486,47.1509671021013,47.1503024175947,47.1501928167793,47.1500939464134,47.150024451252,47.1499421242819,47.1498482423968,47.1497107565541,47.14962538428,47.1494631184807,47.1494108995983,47.1493636857046,47.1491739887144,47.1490671483793,47.1489454415974,47.1488992423087,47.1488055804687,47.1486839273761,47.148641183701,47.1485207090187,47.1484668257595,47.14839256273,47.1483664045228,47.1484123593053,47.1480356536794,47.1476365129651,47.1459361153354,47.1458612235482,47.145684804273,47.1455312565523,47.1446269879786,47.1437394763386,47.1436127533082,47.1435646152961,47.1435379374815,47.1434554195334,47.1433788965346,47.1433188851445,47.143308376424,47.143272432241,47.1432420509289,47.1432195478267,47.1431926029998,47.1431495084642,47.1430575235638,47.1430256112807,47.143008403733,47.142982112185,47.1429489011662,47.1428871938377,47.1428840557586,47.1428288522982,47.1427941224244,47.1427537352928,47.1427228038783,47.1426787339615,47.1426476539207,47.142618986483,47.142597447415,47.1425703621897,47.1425183332909,47.1424724504478,47.1424433772849,47.1424099196462,47.142358406446,47.1423330510891,47.1423069238634,47.1422901910747,47.1422633738125,47.1422211184842,47.1421780375835,47.1421081846065,47.1420527099542,47.1420042800649,47.1419668343582,47.1419337154662,47.1419057069236,47.1418921737554,47.1418371541514,47.1418458279077,47.1418626870588,47.1418413572315,47.1417788229269,47.1416726193831,47.1416475545842,47.1416332076382,47.1416064499534,47.1415796514711,47.1414460545712,47.1412659079898,47.1408657999478,47.1405819361526,47.1402077063731,47.1398734585968,47.1396210069402,47.139393255153,47.1390094996349,47.1384182895676,47.1381240636834,47.137764478825,47.1369502267579,47.1363742541495,47.1352105402384,47.1350527007742,47.1349273494999,47.1345780729825,47.1341790388782,47.1332973397322,47.133129048192,47.1330484682496,47.1327654292983,47.1326597818872,47.1323555882411,47.1322255982634,47.1319827233096,47.1319060389758,47.1318748426562,47.131800495678,47.1311060042307,47.1304338444572,47.1300883974087,47.1292848870858,47.1291372452414,47.1285943557589,47.1273226084081,47.1273195814895,47.1272900093833,47.1272129113091,47.1271949704808,47.1271469642838,47.1270738840681,47.1270394123786,47.1269363818556,47.1267964926246,47.1267139745901,47.126584112236,47.1265346489843,47.1264487746542,47.1263606947058,47.126271648063,47.1262158046161,47.1261573980973,47.1261302884116,47.1261133382478,47.1260754896877,47.1260430279572,47.126018131396,47.1259788539441,47.125933743596,47.1259155152412,47.1258556388085,47.1257485772417,47.1255530708607,47.125462199227,47.125422029226,47.1253021341885,47.1252328599963,47.1251502721599,47.1251093356102,47.1250234247847,47.1249019740501,47.1248754714954,47.124831348792,47.1247933815663,47.1244757293053,47.1244783665529,47.1244701236897,47.1243594657249,47.1242766797667,47.1241073123061,47.1240561616161,47.1240353728801,47.1239688108862,47.1239257377194,47.1239406547292,47.1239394213629,47.1239170913399,47.1238843911473,47.1238542579981,47.1238464407695,47.1238306107422,47.1238000968891,47.123731433493,47.1236893784153,47.1235861363811,47.1235346050463,47.1234242856617,47.1233896642829,47.1233772297076,47.1233491047055,47.1233166512197,47.1233162582437,47.1233318065113,47.1233095725266,47.123273869789,47.1232398345026,47.1231806863584,47.123109051127,47.1230323597471,47.1229669611171,47.1229069322134,47.1228771353331,47.1228477548291,47.1227354223749,47.1226093986059,47.1224994392038,47.1224453678697,47.1224092611926,47.122360607823,47.1223754515399,47.1222515617362,47.1220115129768,47.1219872123872,47.1219241698179,47.1218816234837,47.1217862607459,47.1217326796871,47.1217021598373,47.121659975706,47.1216140170346,47.1215764451062,47.1215549484391,47.1214027036125,47.1213123047423,47.1212231381058,47.1212137185322,47.121181615509,47.1211573572186,47.1211252912421,47.1210017655313,47.120961614208,47.1208794112688,47.1208409352688,47.1207652288212,47.1207425758744,47.1207240106086,47.1207177702795,47.1207067417525,47.120692407363,47.1206660431046,47.1206505383293,47.1206181473237,47.1205374261725,47.1205278302199,47.1205120649231,47.1204968711024,47.1204762788109,47.1204522735048,47.1204453925185,47.1204397448029,47.1204465028378,47.1204424534294,47.1203752358597,47.1203513773477,47.1203375044076,47.1203191263174,47.1203197676435,47.1203254443528,47.120345862147,47.1203530403177,47.120322662504,47.1203028908522,47.1202767656468,47.1202455828121,47.1202095876221,47.120178337923,47.1200877915517,47.1200533689092,47.1199950859764,47.1199710546089,47.1199464025109,47.1199374486038,47.1198966023473,47.1198555217501,47.1198410951878,47.1198057409381,47.1197522924581,47.119665867178,47.1196166473319,47.1196870588488,47.1197778455275,47.120108115604,47.1199889112815,47.1199142503692,47.1199202089683,47.1199937890567,47.1200842723129,47.1201505689509,47.1202150958034,47.1203179969918,47.1203483919571,47.1204154065948,47.1205572184452,47.120597068874,47.1206249864644,47.1206424615341,47.1206835161837,47.1207271536678,47.1207683281899,47.1208439672747,47.1208661808569,47.1208948723618,47.120930370681,47.1209543362357,47.1209786727638,47.121010668707,47.1210404947005,47.1210683095268,47.1211238698289,47.1211533411418,47.1212960346798,47.1213262066098,47.1213423153867,47.1213677899897,47.1214392580297,47.1215305704343,47.1215786588787,47.1216700880057,47.1217151732319,47.1217642125444,47.1218348433039,47.1218586634126,47.1218877678843,47.1219114027306,47.1219416091775,47.1219750171745,47.1220170668983,47.1220717415136,47.1220985778355,47.1221258151559,47.1221893900711,47.1222167264136,47.122276329441,47.1223181048658,47.1223384432424,47.122384054903,47.1224018422541,47.122401158944,47.122416424236,47.12251581529,47.1223995215425,47.1221019754466,47.1216361870353,47.1213761300627,47.120961790342,47.1208607722568,47.1208074515701,47.1207367718565,47.1206934693875,47.1206598457355,47.1206299298653,47.1205701786362,47.1204943903929,47.1204307947544,47.1203854184507,47.1203370382252,47.1202449213431,47.1201930206457,47.1201236801283,47.1200563374551,47.1200048974358,47.1199443619019,47.119894555889,47.1198549907796,47.119754008458,47.1198833042818,47.1203090811414,47.1203273755858,47.1203308077317,47.1204390167795,47.120465711803,47.1205277741302,47.1205690351731,47.1205620241504,47.1203721120748,47.1202211064643,47.1197195833562,47.1193326430111,47.1189935164583,47.1190216103838,47.1193492789147,47.1193703587033,47.1194064105336,47.1194564033089,47.119519009011,47.1202636588443,47.1202886223315,47.1203908407357,47.1202322802888,47.1201309641633,47.1202705582297,47.1204573177924,47.1206851856211,47.1208756246777,47.1214427914398,47.127856543987]}]],[[{"lng":[8.09419137136025,8.09211712947669,8.09122825800191,8.09071334185938,8.09054852123129,8.09024316545574,8.08998119591677,8.08984151768032,8.08979734285412,8.09017790641403,8.09031591163791,8.09012766649405,8.08984924677134,8.08968974523009,8.08941664864656,8.08911148248075,8.08854023214832,8.08983839681796,8.08861244674402,8.0888284377161,8.0889742679355,8.08925005647411,8.08908294868988,8.08877337058678,8.08875300376645,8.08861715316341,8.08779957931057,8.08739222315019,8.08757507596975,8.08838320097585,8.08785390848087,8.08726835487298,8.08701630825671,8.08657419635002,8.08628389072267,8.08596621964849,8.0854848113661,8.08509285736644,8.08483528543157,8.08425967329963,8.08434835827195,8.0828632592529,8.08252910503952,8.0822363845934,8.08201148774903,8.08195796090115,8.08207733953216,8.08099598962353,8.07809953559789,8.07577693996246,8.0771802757019,8.07748349388276,8.07787772908502,8.07850796105169,8.07851211982711,8.07843325524001,8.07846713533514,8.0785268189873,8.07853172381603,8.07862575661898,8.07862863909543,8.07869554959193,8.0787175870144,8.07880562760719,8.07891121915437,8.07893659160598,8.07900718666959,8.07918203512531,8.07922944170472,8.07929050626959,8.07935473921487,8.07943314329347,8.07951986966621,8.07958151017596,8.07961009325754,8.07958315865705,8.07962607145499,8.07968312092265,8.07968830023713,8.07975837273072,8.07987459961402,8.07989050290557,8.07992420435413,8.07995115618685,8.08003121292269,8.08011173452903,8.08012584719588,8.08010679503737,8.08011984076439,8.08012126616909,8.0801574831565,8.08021844113816,8.08023307274777,8.08020214882161,8.08025788901322,8.08030472836852,8.08035642727331,8.08041872736212,8.08054022589432,8.08061632617004,8.08060727260201,8.08061435387567,8.08063692900098,8.08067203589954,8.08064909008278,8.08064899957704,8.08070046036502,8.08063961047627,8.08060673385292,8.08058405820138,8.08052447373136,8.08051006711459,8.0804520269886,8.08047750267761,8.08045689625472,8.08050848427973,8.08052954412252,8.08052630895671,8.08045764242613,8.08046971721157,8.08057200507318,8.08055891118801,8.08053377939293,8.08055900915528,8.08059288602508,8.08049269256104,8.08049448613884,8.08059923904036,8.08063807553811,8.08065230857017,8.08067997877662,8.0807211179961,8.08072427467158,8.08076335767373,8.08075615659449,8.08076986599665,8.08080407307417,8.08077750534678,8.08084437928599,8.08089379014763,8.08089431866433,8.08091732108675,8.08100642559261,8.08108507938737,8.08112127105083,8.08124045756984,8.08134946344756,8.08140252838577,8.0814316715675,8.08188299839702,8.08206701140778,8.08225165105311,8.08255407637638,8.08299765524093,8.0836454329111,8.08389709057378,8.08412507129471,8.08442624394525,8.08495892291809,8.0858156261476,8.08660217784524,8.08714395112245,8.087224318954,8.08759262310237,8.08840499594258,8.0886787115321,8.08930281314381,8.0895688799302,8.08984338640459,8.09007497857303,8.09031291548803,8.0926311373835,8.09262399781899,8.09294805470378,8.09324511994261,8.09350480989942,8.09381031018858,8.09400513199123,8.09400036147863,8.09400870687345,8.09403692879188,8.09409769983651,8.09515807880644,8.09572071777399,8.09622150871021,8.09671176096611,8.09812047341992,8.0992619561579,8.09966639054952,8.09980640261384,8.10058811233938,8.1014100605929,8.10166420945123,8.10191343046702,8.10253580317686,8.10297491349635,8.10370303408844,8.10376948791451,8.10478895827302,8.1057881157753,8.10600251104159,8.10666917833901,8.10671114068127,8.10736284219437,8.10745085639153,8.10765618754466,8.10774268434996,8.10780728837196,8.10785282974149,8.1080559874484,8.10838638557806,8.10867181770233,8.108879485741,8.10900292579856,8.10900745959724,8.1090270280884,8.10903813236563,8.10909270590585,8.10930631529981,8.10956732253738,8.10966473951033,8.10968882487017,8.10979295401932,8.10978681978823,8.11001123020883,8.11026902949634,8.11052045538406,8.11061768908747,8.11091670650045,8.11107531068003,8.11200331696883,8.11221808907835,8.1123820941655,8.11248340083164,8.11251434425146,8.1125312576867,8.11300673374558,8.11301559518874,8.11338853462043,8.11373244537145,8.11397208132914,8.11410825088376,8.11524029182991,8.1154854361694,8.11626679230172,8.11696313334401,8.11702438836585,8.11702285871132,8.11847795203865,8.11860858093777,8.11867462094915,8.11873327487121,8.11878231783094,8.11881929812579,8.11890161740182,8.1190836620982,8.12126678889468,8.12207671983828,8.12230542892681,8.1297096688233,8.13430259928469,8.14223185574039,8.12930048065789,8.12850163944205,8.12745562466605,8.12715081390187,8.1260556691037,8.12608601012337,8.124585658277,8.12529689363481,8.12520463856704,8.12510179854639,8.12469568542203,8.12463981354961,8.12455550724792,8.12435045211942,8.12394174031184,8.12375215224784,8.1220540956447,8.12193878097271,8.12025585017919,8.12042455708561,8.11976826478357,8.11909463418713,8.11855606837974,8.11757327461926,8.117254636154,8.11660178409705,8.116477812464,8.11640192534449,8.11627389631642,8.11610891733637,8.11593286344055,8.11515343975478,8.11495309902489,8.11476030151727,8.11464312649596,8.11455749777056,8.11450073299968,8.1144735870495,8.11446307068459,8.11444926248569,8.11440387664,8.11433698447527,8.11425040686582,8.1134920927584,8.11311136687327,8.11308591553217,8.11305360484863,8.112891536169,8.11282665204717,8.11274774404294,8.11269583377142,8.1126340393629,8.11224206207064,8.11167861305063,8.11148101252511,8.11130594583363,8.11108448068654,8.11097056678664,8.11073637302973,8.11067277454319,8.1104783329922,8.11025916392814,8.1101279136795,8.10997004278421,8.10990335786157,8.10976300683974,8.10963026884813,8.10959565263335,8.10953999879556,8.10926375656206,8.10924796825763,8.10904604477736,8.10898303258035,8.10885584916483,8.1087528281206,8.10868080907019,8.10866329679622,8.10856491514398,8.10850251393564,8.10842603564452,8.10831578276508,8.10820982601697,8.10815844997271,8.10808051175077,8.10726928820247,8.10702544389202,8.1068500656378,8.10603449397818,8.10233326851369,8.10226435995745,8.10216581144866,8.10199071955067,8.10168218466923,8.10167327928874,8.10156086548621,8.10141599287038,8.10113632986338,8.10107287067049,8.10107889331029,8.10107024115282,8.10101158976975,8.10095349614492,8.10087684957276,8.10076945510219,8.10066050843446,8.1005695577084,8.10051411434895,8.10045474515021,8.10026258040328,8.10022560209876,8.10018001040416,8.10012764357917,8.10004413567536,8.10005265673328,8.10003063583974,8.10004427658618,8.10004670669139,8.10002847347746,8.1000315452257,8.10001322866358,8.09778454456184,8.09660399059281,8.09551106430845,8.09545829318887,8.09518132384491,8.09434331344255,8.09419137136025],"lat":[47.1404717416857,47.1406282446642,47.1411802112051,47.1410888522207,47.1410397821409,47.140842017587,47.1405823090321,47.1409063216906,47.1412557357227,47.1416754083164,47.1418912116283,47.1421829101991,47.1424412431054,47.1425014325109,47.1426947084284,47.1428278616181,47.1430210932845,47.1434401235674,47.1442386974255,47.1444546465876,47.1446730427409,47.1451596312633,47.1453498422646,47.1457834473914,47.1459803307242,47.1460728393117,47.1463606743051,47.1468216774388,47.1471249153793,47.1478331558524,47.1481705362744,47.1482960995047,47.1482087829363,47.1482812907936,47.1484984387376,47.1486366997901,47.1488140375918,47.1490893763911,47.1491867197323,47.1493203252719,47.1494516600752,47.1506344825473,47.1508194028227,47.1509950053668,47.151361472937,47.1517726774207,47.151813882313,47.1527635353812,47.1551793118047,47.1568433295572,47.1587140960491,47.1589968382114,47.159355172584,47.1597429482472,47.1597830701816,47.1599551616687,47.1600070818718,47.1600453210381,47.1600904850628,47.1602308972623,47.1603496073112,47.1603922048066,47.1604308510737,47.1605520109857,47.1605935207217,47.1606364300555,47.1606540365323,47.1608052155528,47.1608279881627,47.1608823204426,47.1608928200196,47.1608818683682,47.1609007250042,47.1609183000254,47.1609759702524,47.1610262857826,47.1610779574574,47.1610876693025,47.1611843195827,47.161191242356,47.1612760122867,47.1613320440049,47.1613710568297,47.1614257137094,47.1614646031809,47.1615896358845,47.1616392820442,47.1616540052122,47.1616806389089,47.1617335760031,47.1617755701022,47.1618032230772,47.1618400303519,47.16192612369,47.1619585641195,47.1619547859763,47.1619735403835,47.1620427250461,47.1621236420052,47.1621679141987,47.1622432984704,47.1622795271385,47.1623023386956,47.1623737797136,47.1624388611414,47.1625171188262,47.1625852573863,47.1626580251123,47.1627484380751,47.1627480607975,47.1627811890909,47.162843515352,47.1629086754602,47.1629534008731,47.1629881288137,47.1630591631586,47.1631315820354,47.1633073009022,47.1634443369385,47.1634867443686,47.1635623263647,47.1636406565342,47.1636884705643,47.1637544526876,47.1638035298159,47.1639467413646,47.163976442097,47.1641101454896,47.1642461593256,47.1642793437385,47.1643937327026,47.1644830672184,47.1645307414944,47.1646168672248,47.164657574117,47.16478896065,47.1648918983649,47.164935483762,47.1650414954689,47.1651529296406,47.1652046933348,47.1652619175917,47.1653728334221,47.1655075005209,47.1655910786554,47.1657181704672,47.1658090778457,47.1659149234396,47.1659848053502,47.1659936093857,47.166003078373,47.1660273674418,47.1661024762962,47.1662652429744,47.1665503754518,47.1666796996561,47.1668044066638,47.1669773840261,47.167267256448,47.1677131060028,47.1680906486789,47.1683704393348,47.1684152048441,47.1686013693181,47.1689828919116,47.169107385787,47.1694078129025,47.1695299102313,47.1696419746836,47.1697241568091,47.1697987107185,47.1704713593137,47.170480790723,47.1706054382858,47.1707425976338,47.1708855817308,47.1710963073188,47.170970985589,47.1709368674482,47.1709074240485,47.1708746112885,47.1708295238486,47.1701154170221,47.1705036460548,47.1701031056113,47.1696946175232,47.1684943220592,47.1689374779415,47.1685250167776,47.1684331645644,47.1676462082158,47.166761768724,47.1665113662242,47.1662924383604,47.1657989782687,47.1654777400151,47.1649102181519,47.1648704357054,47.163956944701,47.1629994769883,47.1631032250895,47.1634969687367,47.1635304478516,47.1642626340377,47.1643294960257,47.1645811371762,47.1647059272037,47.1648392188628,47.1648528875383,47.1648765598176,47.1649543886345,47.165095048143,47.1651691642243,47.1652209768565,47.1652944584067,47.1654289561113,47.1654604732388,47.1654907297601,47.1655198889492,47.1654918325366,47.1655098036429,47.1655278333498,47.1655467546826,47.1655624419181,47.1656861382918,47.1658418239048,47.1659446009857,47.1659688959137,47.1660571910622,47.1661087691416,47.1664201072542,47.1665035216936,47.1665333881883,47.166621253065,47.1666904781289,47.1667159791772,47.1664597939224,47.1663653924013,47.1663805586809,47.16628074769,47.166290918861,47.1657599036448,47.1659685985721,47.1653388764238,47.1654742705722,47.1655606693267,47.1658732840965,47.1658878831722,47.1659398993153,47.1659524495623,47.1659701576231,47.1659982446598,47.1660380730946,47.1660856096272,47.1660651630729,47.1664048758182,47.166189561225,47.1663439601275,47.1663638305623,47.1666420499496,47.1588325192923,47.1531514038906,47.1463755807853,47.1459619987059,47.1457428101231,47.1457089684828,47.1453580841889,47.1452998301894,47.1446283538199,47.1440979040345,47.1439605946796,47.1438480760931,47.1435036716812,47.1434852498726,47.1434372145572,47.1435953033044,47.1439654243006,47.1441487232046,47.1456269739793,47.1457320835074,47.1447287062825,47.1445817964434,47.1441951133966,47.1437878492903,47.1437492592678,47.1437670975987,47.1437517964223,47.1444916010132,47.1444185531078,47.1442935537188,47.1441446284039,47.1439991497484,47.1438838068345,47.1433972294983,47.1432500591032,47.1430611874883,47.1429015193357,47.1427363946038,47.1425580393129,47.142375102407,47.1420671611114,47.1418964242298,47.1416156821455,47.1412927531081,47.1412977590578,47.1410322194071,47.1407845662896,47.1408027957355,47.140773579954,47.14068393054,47.1406684882466,47.1406689955302,47.1406442481261,47.1406291834115,47.1409225259704,47.1408303304932,47.1408200262935,47.1408184142714,47.1408099579777,47.1407922645245,47.1407244059803,47.1407315327993,47.1406745325793,47.140620977586,47.140577946196,47.140535636668,47.1405110641604,47.1404560589277,47.1403931203812,47.1403680638468,47.1403505779526,47.1402091383628,47.1401821549689,47.1400832155649,47.1400476020654,47.1399500978772,47.1398787456671,47.1398397033322,47.1398192513831,47.1397498869042,47.1397261791682,47.1397142470406,47.1396706775892,47.1396396312715,47.1396141321232,47.1395876810895,47.1400945522506,47.1402383981551,47.1404674078232,47.1401203857687,47.1384463251944,47.1383439080806,47.138262305721,47.1381749019508,47.1380643038722,47.1380850260434,47.1381580037584,47.1382850762619,47.1385626399858,47.1386342289285,47.1386618003653,47.1386870365915,47.1387913851321,47.1388566285217,47.1389108246775,47.1390040297715,47.1391231407192,47.1392445407436,47.1393344513336,47.1394128526967,47.1396339250863,47.1396456424938,47.1396804459768,47.139708919827,47.1397926769141,47.139816564015,47.1398577714167,47.1399098018833,47.1400361606994,47.14008411967,47.1401428582956,47.1401723237254,47.1398056518444,47.1394699453585,47.1405674530257,47.1405427927459,47.1404745710823,47.1405272485002,47.1404717416857]}]],[[{"lng":[8.15934357806286,8.15959547472549,8.15962453352916,8.15971594186577,8.15993547482626,8.16005799923552,8.16021573257105,8.1603911010522,8.16045397681899,8.16055546826071,8.16057504756909,8.16067550766803,8.16073467519895,8.16080228137639,8.16095019217461,8.16122902445922,8.16135284179607,8.16140124517615,8.16156337532743,8.16156084494593,8.1616352141026,8.16202342846317,8.16206304129038,8.16222647035567,8.16234301781581,8.16249794070669,8.16264783732736,8.16274640044868,8.16276486094459,8.1629206042573,8.16308394907746,8.16320769604985,8.1632735982491,8.16346877986171,8.16352909590265,8.16358509603004,8.16366772142558,8.16397858257198,8.16406798938206,8.16414996562908,8.16427854583389,8.16442492267928,8.1646306634654,8.16484407072838,8.1648595887642,8.16485396905659,8.16513624174944,8.16525405302283,8.16552089947901,8.16564862893634,8.16580799428768,8.16586281419843,8.16590471873658,8.16597760306242,8.16611786724499,8.16627735453596,8.16646405341446,8.16655584692921,8.1667426121266,8.16693479026123,8.16707508478767,8.16723812502789,8.167475246361,8.16764276108815,8.16805981774455,8.16827715466587,8.16842788537965,8.16882540533457,8.16892021039047,8.16892477240811,8.169158632954,8.16940288764792,8.16961661893084,8.16978079200698,8.16990184692076,8.17006956663887,8.1703842451592,8.17063881340841,8.17077270583655,8.17106054609668,8.171139633148,8.17124009049476,8.17134673215985,8.17138239467842,8.17153332202977,8.17155142655873,8.17155942393502,8.17172044451484,8.17177613619607,8.17183789511092,8.1719600491618,8.17209706794855,8.17224304553384,8.17232275608317,8.17244639947801,8.17255723031837,8.17265110950698,8.17293147249117,8.17316749285482,8.17335767040482,8.17351010874457,8.17359347912116,8.17372916818656,8.17390382668274,8.17398990125555,8.17409500765178,8.17418401368747,8.17426100286187,8.17438522479916,8.17452554446409,8.17460109776015,8.17475088990106,8.17483421784427,8.17496959465917,8.17507082525042,8.17518454550218,8.1752390261565,8.1752914865447,8.17538044922179,8.1754674880323,8.17545910245253,8.17555428650122,8.17565762510972,8.17564854771268,8.17600902768633,8.17610255936721,8.17607631205246,8.17617208928561,8.17620517177633,8.17621578962136,8.17631509272299,8.17637540264348,8.17651570468346,8.17648994426446,8.17673067028894,8.17697236971347,8.17703784467321,8.17724616808959,8.17759001401662,8.17770976131074,8.17783017697937,8.17790050425516,8.17800279247774,8.17807977224268,8.17805280123106,8.17812703733808,8.17833403201607,8.17838630446653,8.17848743997892,8.1786327317518,8.17877628843927,8.17888175171014,8.17893376458701,8.17874045372569,8.17878960477899,8.17885983188232,8.17886639981184,8.17901318932842,8.17910362415206,8.17928261485027,8.17936797917343,8.17944964584258,8.17955776938957,8.17964899628018,8.17970438305925,8.1797967971701,8.17987768714666,8.17992790692452,8.18006773172033,8.1801322410204,8.18026988723409,8.18031553941469,8.18040830069703,8.18040522561383,8.1804552099764,8.18055838651974,8.18062319114741,8.18067759969608,8.18080239369805,8.18090292104302,8.18099525644106,8.1810904287952,8.1812429660202,8.18138905527145,8.18143893348104,8.18151669416299,8.18155527667339,8.18162982719519,8.18175743958603,8.18182272232184,8.18196999594249,8.18218506051566,8.18220765578853,8.18229627784021,8.1823634249073,8.18242686252262,8.18245352790598,8.18269219670383,8.18320912343959,8.18339685552442,8.18432635354758,8.18445048303671,8.18436172496321,8.18440784080007,8.18448927713765,8.18464774626988,8.18474083660874,8.18483447367362,8.18492559449541,8.18502234836904,8.18520799878378,8.18521244139983,8.18546587670765,8.18567555306908,8.18594159839497,8.18599703784324,8.18621292734187,8.18642646416688,8.18767380317897,8.18774165110306,8.18790911303946,8.18815266388987,8.18866919611208,8.18900772773325,8.189053860716,8.18918305474144,8.18942093929774,8.18953953351357,8.19002299633329,8.19028386731831,8.19058741132931,8.19090647916481,8.19104348948576,8.19148046478606,8.19212613562228,8.19231750518166,8.1925491995494,8.19267675268948,8.19278707980336,8.19282142285032,8.19322457991206,8.19356789479131,8.19449288430475,8.19524970581002,8.19567934173161,8.19605905808059,8.19641639435132,8.19677730486739,8.1970414155669,8.19727829566713,8.19867041247465,8.19820340770992,8.19770921162274,8.19686738054976,8.19667350614313,8.19638390993391,8.19608276713044,8.19587974431634,8.1956077529501,8.19532351821162,8.19495941025846,8.1949589919949,8.19402820455495,8.19246021051182,8.19134991997765,8.19124144867472,8.19029617176239,8.19004311160158,8.18953465077813,8.18904286567353,8.18850681621803,8.1880446791762,8.18706219995273,8.18639593997715,8.18614630477992,8.18603077074828,8.18583984066219,8.1854584177503,8.18544672224542,8.18535192148068,8.18529013651566,8.1851859499535,8.18489959517911,8.18470778339445,8.18449734687506,8.18447103448638,8.18437996802686,8.18423187690456,8.18421425458623,8.18410640064742,8.1839980849425,8.18389650215899,8.18378476322535,8.18363606624695,8.18359763836708,8.1835071705235,8.18342308407083,8.18336084465806,8.18339868880265,8.18336835159419,8.18335423662542,8.18331395312107,8.18328611870757,8.18316882467275,8.18301647041816,8.18297542916546,8.18300999089264,8.18269447927565,8.18129705757099,8.17913767195627,8.17755615729804,8.17557173760884,8.17515768864281,8.17483969539334,8.17479432176833,8.16475951242095,8.14223185574039,8.13430259928469,8.14494321742923,8.14634443986236,8.14584170515832,8.14545645139033,8.14517572938894,8.14572814711766,8.14641623604265,8.1466668714026,8.14777527298088,8.14822160586604,8.14854279724504,8.14862748314655,8.1489383426673,8.14978399004384,8.14992299522876,8.15045252879456,8.1506407308575,8.15111160579489,8.15149225943734,8.15175087097328,8.15247587626106,8.15226828067313,8.15209805023389,8.15242178989022,8.15270516372966,8.15267311010595,8.1529386757357,8.15302972473568,8.15288920297643,8.15326283773655,8.15331363507235,8.15370321487294,8.15404908680435,8.15436770548068,8.15475567343016,8.15513412420671,8.15537226041757,8.15554241261804,8.15604204854835,8.15613506721406,8.15601608331882,8.15604428687105,8.15624763666374,8.15637756044833,8.15648974871608,8.15655894138961,8.15673279329249,8.15700256794799,8.15714606242557,8.15721045771044,8.15740597708301,8.15759935753305,8.15776163669401,8.15800818009831,8.15810386749449,8.1581999866224,8.15830603814901,8.15847637834279,8.1586267355091,8.15893016875076,8.15902427764748,8.15914321903692,8.15934357806286],"lat":[47.1704464050424,47.1703677754063,47.1702522037648,47.1701932977596,47.1701534052584,47.1701463948681,47.1700995220739,47.1700115386432,47.1699203204754,47.1698717219634,47.1697869728847,47.1696766020949,47.1696381275486,47.1696238689276,47.1695325037834,47.1692540992635,47.1692072128845,47.1691238028568,47.1689994253907,47.1689800477497,47.168932392162,47.168795754714,47.1687481283486,47.1686390514951,47.1685872983752,47.1684901122144,47.1684494739601,47.1684099949732,47.1683413178372,47.1681956870606,47.1681527687963,47.1680522607449,47.1680078056654,47.1679383666255,47.1679324008321,47.1678921366985,47.1678777907757,47.1678427842462,47.1677750450703,47.1677663518437,47.1677180559828,47.1676826817422,47.1675993845649,47.1675008098576,47.1673992106696,47.1673194141527,47.167310490856,47.1673814296264,47.1674749226164,47.167439880439,47.1673888337931,47.1673123435106,47.167204604681,47.1671403505521,47.1670756255909,47.1670860683808,47.1670674824454,47.167074718803,47.1670464711991,47.1670855177746,47.1670929145941,47.1670755925119,47.167102426132,47.1670969667396,47.1670463715565,47.1669464162348,47.1669298631112,47.1669236991381,47.1669186720968,47.1669146852853,47.1668977926733,47.1668993186471,47.1668745831794,47.1668601557232,47.1668379333025,47.1668417610632,47.1668011358853,47.1668016671661,47.1667961651456,47.1668734194642,47.1668696779618,47.1668083213284,47.1667748102352,47.1667399428652,47.1667330452097,47.1666970392484,47.1666646057511,47.1666627708238,47.1667421132533,47.1667829177238,47.1667649408387,47.1668114723514,47.1667898622358,47.1668605059236,47.1668934496296,47.1669635169667,47.1669515844667,47.1670344408101,47.1671154116045,47.167123642818,47.1670730164446,47.167073824447,47.1671386226932,47.1672365439178,47.1672613604378,47.1672313647145,47.1672295366812,47.1672842749912,47.1673111681765,47.1673001156713,47.1673463175311,47.1674486151914,47.1674750677761,47.1674786185066,47.1674928848926,47.1674754262926,47.1674567275464,47.1673295510458,47.1672574701415,47.1671510399566,47.1671455166323,47.1671134152462,47.1671371305301,47.1672250713979,47.1671869620344,47.1673030301223,47.1673988168656,47.1674193418725,47.1674846146909,47.1675564180118,47.1675647768381,47.1675383943061,47.1675547567454,47.1676571159245,47.1676961228234,47.167623969737,47.1676086897397,47.1675075068851,47.1675351550129,47.1675339364681,47.1675715726195,47.1675542910277,47.1674540575811,47.1674132647606,47.1673408470276,47.167292416911,47.1672957734197,47.1673369052182,47.1673633306761,47.1673685134518,47.1673054338864,47.1672918926312,47.1673237608311,47.1674611007698,47.1675340143873,47.1675762898455,47.1676220330049,47.1675733246271,47.1675603295915,47.1674938731455,47.1674385432892,47.1674591563751,47.1674472165103,47.1674152361419,47.1673382407506,47.1673539270076,47.1673470195779,47.1673160226556,47.1673264560221,47.1672224971106,47.1672765798254,47.1673157744728,47.1672708305674,47.1671916839054,47.1671151727117,47.1670889614613,47.1670920518653,47.1670683136955,47.1670696679877,47.1670426639417,47.1670907323533,47.1670675406498,47.1670626077948,47.1670492518889,47.1670602639451,47.1670370043416,47.1670039139659,47.1670059604271,47.1670678329867,47.1670768564407,47.1670633122459,47.1669364405847,47.166901393362,47.1668919156276,47.1669202663478,47.1669104115203,47.1668835235541,47.1669082469442,47.1669761461243,47.1669791593566,47.16700967102,47.1670485355297,47.1670965331378,47.1671404006664,47.1671443706056,47.1671013272222,47.1671370643667,47.1671647022361,47.167210526594,47.1672251910538,47.1672396476987,47.1672366414819,47.1672408623007,47.1672567724426,47.1675038610351,47.167686381976,47.1677409300557,47.1680047297495,47.1676916923742,47.1680064507834,47.1689829023848,47.1691001520509,47.1690154712542,47.169059949922,47.1688599923002,47.1684504362315,47.1675607551377,47.1673579048766,47.1667725639806,47.1665286565395,47.1663209361778,47.1661621732574,47.166105660523,47.1659738033677,47.1658138628601,47.1657588277456,47.1656723059051,47.1656169145733,47.1655259160813,47.1631354626255,47.1630007977677,47.1628930598235,47.1626414561817,47.1624063504271,47.1622638298881,47.1622174350932,47.1621171072669,47.1619544810204,47.161848135818,47.1617132658144,47.1616004204922,47.160827775343,47.1602683049918,47.1603134420651,47.1602019643246,47.1597650134783,47.1595835836411,47.1593890940866,47.1590436595673,47.1584157925407,47.1584253641271,47.1583770806235,47.158172139344,47.1576886468944,47.1575649979163,47.1556056255369,47.1543837151098,47.1542609640355,47.1546579670995,47.1550127615356,47.1550509682063,47.1546916158113,47.1539385715409,47.1540568449554,47.154122953377,47.1540932100474,47.153976855622,47.1538339420997,47.1537517478731,47.1537278871048,47.1536139499708,47.1535571735492,47.1535620532622,47.1534805321129,47.1534184530564,47.1533688261515,47.1533479088007,47.1532052779677,47.1531045019466,47.1530266185819,47.1529392211827,47.1528798451122,47.1527766651104,47.1526698743242,47.1525976037688,47.1525475553894,47.1524206465998,47.1522831079561,47.1522669865021,47.1522170255816,47.1521767824335,47.1521350625066,47.1520801649909,47.1519698691486,47.151865332036,47.1518449535172,47.1515803698844,47.15105853863,47.1495875306379,47.1504188501952,47.1494154190918,47.1475429030821,47.1471093945518,47.1469567929606,47.1469075286676,47.1370032622615,47.1531514038906,47.1588325192923,47.1644472752689,47.1651359720189,47.1655693081032,47.1660504043699,47.1663564420804,47.1666490800079,47.1669962912306,47.1666784810388,47.1670916321423,47.1673199667586,47.1670190871124,47.1670614626288,47.1671781008151,47.1675087581287,47.1673189474919,47.1669174056454,47.1668438938394,47.1668263363304,47.1665776838169,47.1664788805571,47.167541372372,47.1678302700358,47.1680023857312,47.1684519436742,47.1687920194242,47.1688275061636,47.168993213145,47.1692302276705,47.1696242679576,47.1696710625898,47.1697828086282,47.1699626488259,47.1702354811837,47.1700974942663,47.169832954281,47.1696519560425,47.1696379614094,47.1696948305903,47.1699614012174,47.1699554693972,47.1707208514348,47.1709070368838,47.1707566481341,47.1707002662319,47.1707436968564,47.1707993590405,47.1707688066654,47.1707461648982,47.1707053849566,47.1706571289004,47.170617445116,47.1705520932392,47.1705478144074,47.1704799349174,47.1704467835363,47.1704830538501,47.170543836709,47.1705337945618,47.170536560287,47.1705529942342,47.1705064761903,47.1704683930079,47.1704464050424]}]],[[{"lng":[8.1297096688233,8.1278238735793,8.12481896355328,8.12631020724782,8.12642958441591,8.12568254711832,8.12568084104297,8.12568429337916,8.12564126859812,8.12543047752821,8.12508535124256,8.1247569293149,8.12447136034923,8.12406869360999,8.12406916365208,8.12290469274241,8.12255480961393,8.12252772568161,8.12278333027279,8.12296934716341,8.12330091147134,8.12310779118399,8.12293837495166,8.12250417270175,8.12206612313811,8.12163441971764,8.12157111032515,8.12161435535741,8.11930588498872,8.11717164521339,8.11706021194609,8.11686672850033,8.11683300016068,8.11630679946474,8.11552879605892,8.11511001062172,8.11691720462005,8.11425280660225,8.11414442366144,8.11408793589854,8.11395410086477,8.11384893758301,8.11365807840932,8.11364010136345,8.11327612223547,8.11314999425924,8.11296653819986,8.11269926860657,8.11218894900319,8.11199144062518,8.11181920979371,8.11166293646899,8.11156401210492,8.11149178652493,8.11147142686933,8.11150560990157,8.11150687784309,8.11148234231262,8.11118349972469,8.11118801307343,8.11123799072427,8.11137767266666,8.11157484932274,8.11164156252363,8.11042921098087,8.11048502266777,8.11049426870029,8.11049288987057,8.11047111277632,8.11042181821177,8.11032895763345,8.11017200140325,8.11009650967517,8.10974270799045,8.10928640749921,8.10879761735156,8.10849953837653,8.10826354097034,8.10815264710798,8.10808573372434,8.10825568565351,8.10882542778345,8.10910533643551,8.10947013830195,8.10980085321996,8.10994121089822,8.11027299186123,8.11035794780695,8.11062741056469,8.11073824780801,8.11087862716125,8.11100419639102,8.11110060941791,8.11139228557117,8.11148973686696,8.11162507184872,8.11176075487035,8.11192072683014,8.11204699743465,8.11213155461402,8.1122729819487,8.11245654102549,8.11265594654689,8.11286893285712,8.11294289337345,8.11313168641953,8.11345683123837,8.11350126580339,8.11387789188549,8.11396407317451,8.11405291062579,8.11417143342103,8.1143271095822,8.11442588470456,8.11457759140382,8.11467059604436,8.11472391848999,8.11478477349687,8.11494198042712,8.11505814724969,8.11512208760842,8.11519960310061,8.11528781788317,8.1153493427395,8.11548213730986,8.11552662820439,8.11555445035427,8.11560339484522,8.11573639322052,8.11579691253505,8.11581236018648,8.11585480749991,8.11593237938206,8.11602324318622,8.11612291211111,8.11616864871279,8.11621656062435,8.11628502445892,8.11633623364983,8.11638077056031,8.11654441812935,8.11662375837741,8.11664959062286,8.11677614121876,8.11685266761889,8.11696408543145,8.11706546735263,8.11722802426105,8.11726824408072,8.11736909338459,8.11742005460924,8.11748308390876,8.1175653364752,8.11765728930236,8.11777630431725,8.11784888730369,8.11792301726898,8.11818369866644,8.11827029845069,8.11837002957071,8.11843876971303,8.11862315524277,8.11868770816112,8.11888102211799,8.11896267224755,8.11926136759964,8.11932118727325,8.11934523171008,8.11938773945266,8.11946471610526,8.11953644140907,8.11960181742299,8.11975832524725,8.11984982881137,8.11995138469902,8.12002926226352,8.12008978301488,8.12016252761451,8.12021654434115,8.12032644985616,8.12048998345128,8.12060169803188,8.12075359920088,8.12079899783039,8.12083936317391,8.1209690572487,8.12101920217694,8.12129833308455,8.12147118706965,8.12150944444288,8.12158021191766,8.12166713402946,8.12173439007119,8.12179311153692,8.12191640183049,8.12208909767264,8.12213580432798,8.12224913143631,8.12230443432064,8.12235161745744,8.12246125889429,8.12251304452261,8.12264504961581,8.12270671532288,8.12278415007825,8.12283081649006,8.12293399586225,8.12295231925922,8.12302714881034,8.12308906635874,8.12310863290043,8.12310405705698,8.12314708506808,8.12316374522936,8.12322250314626,8.12326693274367,8.12334093145736,8.12341770191104,8.12347335876857,8.12355926063735,8.1236085951508,8.1235878825108,8.12362939334321,8.12368574373703,8.12375616531907,8.12388455353576,8.12395696138946,8.12398489158073,8.12407590864087,8.12413898455811,8.12419158757967,8.12424208955207,8.12431326529007,8.1243854117808,8.12440626465658,8.12447120031677,8.12448058104856,8.12448233126242,8.12452993810257,8.12452705967239,8.12450536157884,8.12448350675108,8.12450423502647,8.12448679157566,8.12450671240308,8.12450404551709,8.12455843594388,8.12455221287566,8.12451937189356,8.12454731952249,8.12453375183584,8.12456331271561,8.12454418241645,8.12457693696692,8.12459537270907,8.12461657449949,8.12470603512994,8.12481060614597,8.12492989563497,8.12492257776459,8.12500292720446,8.12501315670161,8.12507079918859,8.1251157177753,8.12518557400545,8.12521520593909,8.12524318313172,8.12532200133227,8.12536815718233,8.12542656657996,8.12546571338454,8.12546494230003,8.12551034438458,8.12561889347495,8.12569140907005,8.12574224359857,8.12578255178826,8.12588773325417,8.12593394807289,8.12601754964235,8.12606808250345,8.12614577687592,8.12619747222851,8.12623014236608,8.12626760459256,8.12627879930734,8.12639486555084,8.12640465135729,8.12640643610342,8.12643716613071,8.12650661212317,8.12654254010929,8.12663315640709,8.12675478275583,8.1268512062141,8.12683693867189,8.12691937131195,8.12692275100606,8.1269569768112,8.12704676499254,8.12709333000912,8.12715365924029,8.12740051477824,8.12749774050721,8.1276414558754,8.12770113332571,8.12775569126218,8.12783483568926,8.12787897803657,8.12808755386923,8.12815723033957,8.12821655262842,8.12840545610273,8.12838024541216,8.12843970748888,8.12849014369698,8.12856626200758,8.12858071022718,8.12862962542678,8.1286630742456,8.1287048447934,8.12876797762629,8.12883668909211,8.12889696219552,8.12893075014593,8.12898029506811,8.12908624818718,8.12910249313955,8.12921412153604,8.129217324396,8.12942249939404,8.12945299576783,8.12958437128763,8.12963026121791,8.12968707945641,8.12972257785084,8.129789003134,8.12991078160746,8.12991576844358,8.13004071022888,8.13006705680622,8.13012785880587,8.13022959351891,8.13028922781016,8.13030939130283,8.13044053593596,8.13045092622346,8.13051348240756,8.13051759383207,8.13059264095845,8.13062165087068,8.13068449326187,8.13069370137199,8.13076857755833,8.1307802417943,8.13082510412356,8.13090442966974,8.13116478143628,8.13130676385434,8.13128983552203,8.13144861618684,8.13173030124921,8.13184404872507,8.13186975941611,8.13191310335714,8.13190608674844,8.13199907032116,8.13202679964977,8.13203221493393,8.13209050788006,8.13210852358719,8.13217522473203,8.13221545072392,8.13227730417485,8.13227083643735,8.13230275141259,8.13239030782939,8.13256677009152,8.13277291983639,8.13284671423583,8.13299986450108,8.13305753416196,8.13310563668733,8.13312142027347,8.13449800362532,8.13393107194186,8.134212057631,8.13442002179433,8.13511548315379,8.13525242657376,8.13556117317934,8.13613954600192,8.13595227313534,8.1360975041548,8.13626281218336,8.13680441570561,8.13744084723641,8.13696271807728,8.13784442864591,8.13880506184243,8.13967377259994,8.1400687499285,8.14064193309865,8.14069079370351,8.14064905821135,8.1427729576221,8.14221898348124,8.14173631452237,8.14213355553264,8.14278351407578,8.14343304861664,8.14361123282505,8.14366530037163,8.14374022475684,8.14398733302831,8.14410832271694,8.14469415452745,8.14460875990464,8.14457887650298,8.14456626728772,8.14453304313053,8.14450470964436,8.14448205001728,8.14454938176168,8.14458902170105,8.14599993110769,8.14600857607197,8.14607895321592,8.14640571187663,8.14657137844653,8.14668320433998,8.14722232631593,8.1473241759463,8.14739542014075,8.14745243873106,8.14757952879462,8.14768722906038,8.14848643731681,8.14864072786382,8.14867979761768,8.14883454761,8.14897785937957,8.14905549706152,8.14909027850935,8.14925343924063,8.14912349288916,8.14914562261695,8.14911773740029,8.14896997819686,8.14886304151965,8.1487911653167,8.14870997431588,8.14864603196518,8.1484015151331,8.14832730171439,8.1482888335185,8.14823417486873,8.14817686188345,8.14807334002409,8.14772695838938,8.14745458845751,8.14737627892112,8.14823362030867,8.14800963089563,8.14844952703789,8.14880508337193,8.14905377753969,8.14930697272274,8.14974604371802,8.15019548344846,8.14980198618613,8.15013592616633,8.15075821508189,8.15074419076449,8.15063159025015,8.15058759742116,8.15057779842234,8.15094562017628,8.15077516087198,8.15082671232268,8.15082183249783,8.15089485205886,8.15089322926672,8.15102059102527,8.15107398055745,8.15112946487595,8.1512160104679,8.1513012943624,8.15137002265682,8.15143639673224,8.15155908423118,8.15161663100454,8.15171833708294,8.15178529717585,8.151817763247,8.15184491967032,8.15188650761557,8.15200543699051,8.15207032933133,8.15211374964754,8.15217715017697,8.15230919158588,8.15237876476571,8.15241306653314,8.15263581911505,8.15273409390518,8.15280191968126,8.1529749731149,8.15298321637315,8.15305838596965,8.153126766389,8.15315354858738,8.15320642518865,8.1532857492687,8.15336366194651,8.15343263401949,8.15348916909254,8.15357226873892,8.15371246230145,8.15380447708744,8.15385473817837,8.15389759936469,8.15396669142935,8.15410324452865,8.15412475831038,8.15424643945993,8.15433273077186,8.1543667411491,8.15425121493444,8.15447421180259,8.15561096528759,8.15612578713261,8.15872570065711,8.15938473546419,8.15971534697598,8.16015013931772,8.15882185168152,8.158743664321,8.15909917978978,8.15946993234082,8.15969463065312,8.15934357806286,8.15914321903692,8.15902427764748,8.15893016875076,8.1586267355091,8.15847637834279,8.15830603814901,8.1581999866224,8.15810386749449,8.15800818009831,8.15776163669401,8.15759935753305,8.15740597708301,8.15721045771044,8.15714606242557,8.15700256794799,8.15673279329249,8.15655894138961,8.15648974871608,8.15637756044833,8.15624763666374,8.15604428687105,8.15601608331882,8.15613506721406,8.15604204854835,8.15554241261804,8.15537226041757,8.15513412420671,8.15475567343016,8.15436770548068,8.15404908680435,8.15370321487294,8.15331363507235,8.15326283773655,8.15288920297643,8.15302972473568,8.1529386757357,8.15267311010595,8.15270516372966,8.15242178989022,8.15209805023389,8.15226828067313,8.15247587626106,8.15175087097328,8.15149225943734,8.15111160579489,8.1506407308575,8.15045252879456,8.14992299522876,8.14978399004384,8.1489383426673,8.14862748314655,8.14854279724504,8.14822160586604,8.14777527298088,8.1466668714026,8.14641623604265,8.14572814711766,8.14517572938894,8.14545645139033,8.14584170515832,8.14634443986236,8.14494321742923,8.13430259928469,8.1297096688233],"lat":[47.1666420499496,47.1698502627853,47.1721115366508,47.1735427726728,47.1744840082137,47.1744036986064,47.1749707505974,47.1749827834235,47.1750223397207,47.1749851882266,47.1749383760366,47.1748856344507,47.1748107066386,47.174675227691,47.1746707273459,47.1742734412653,47.17571343047,47.1757453530048,47.1758826287545,47.1759764215147,47.1761342031902,47.1761978762531,47.1762779500819,47.1764584886278,47.176912427031,47.1772842818536,47.1773122003209,47.1773567393448,47.1783856568432,47.1793107678962,47.1793247282004,47.1794070395525,47.179379353472,47.1796130851762,47.1799031648365,47.1800280307848,47.1816789608115,47.182497217676,47.1825192887444,47.1824957741659,47.1821318181326,47.1821998978049,47.1816712882279,47.1816759001344,47.180658154215,47.180699820652,47.1807160248146,47.1807837213684,47.1809452545249,47.1810190987567,47.1811013401908,47.181202017937,47.1812984025204,47.1814207167078,47.1815328242432,47.1819148158596,47.1822025066098,47.1822301298929,47.1823068854444,47.1823090808659,47.1824288550853,47.182730363248,47.1832823266081,47.1834538503755,47.1835688428588,47.183836012369,47.1839545672874,47.1841400894409,47.184369725421,47.1845819185774,47.1848446661716,47.1851885720439,47.1853835573041,47.1860454968384,47.1869647688313,47.1879239589055,47.1885305650381,47.1889730725071,47.1892175908958,47.1893504408953,47.1893566309616,47.1894747681644,47.1895399992212,47.1896100512376,47.1896397510763,47.1896576337675,47.1897301784407,47.1897337217623,47.189804326125,47.1898082848444,47.1898236296655,47.1898627267453,47.1898780850916,47.1899511035685,47.189957712339,47.1899947457959,47.1899985853347,47.1900325510628,47.1900391977721,47.1900539949233,47.1900917115987,47.1900999836923,47.1901353997636,47.1902160530418,47.1902359848389,47.190312947384,47.1904037457414,47.1904104655422,47.1904325986778,47.1904411154161,47.1904384356676,47.1904552719017,47.1904476663852,47.1904639165958,47.1904679916152,47.1904807764081,47.1904755251277,47.1904784690668,47.1905293485391,47.190544533612,47.190598434199,47.1906259894627,47.1906721465442,47.1906883899291,47.1907620796257,47.1908013783851,47.1908467118288,47.1908729685464,47.1908949082334,47.1909171659848,47.1909324656902,47.1909489289128,47.1909631436954,47.1910131165292,47.1910487713495,47.1910311058803,47.191033090774,47.1910543390611,47.1911166343032,47.1911324014136,47.1911455965245,47.1911983262326,47.1912073221315,47.1912045531963,47.1912549246221,47.1912731760713,47.1912970994403,47.1914292415516,47.1914520858748,47.1914485412337,47.1914693073128,47.1915197668607,47.1915502250044,47.1915443848458,47.1915789257332,47.1916241475989,47.1916446508929,47.1916290268932,47.1916162556593,47.1916701051625,47.191749332638,47.1918252328265,47.1917607799501,47.1920345361063,47.192009173533,47.1924310396787,47.1923700235507,47.1923805135965,47.1923870266404,47.1923687344613,47.1923795362817,47.1924161014399,47.1924423410564,47.1925306889797,47.1925140860897,47.1924960760457,47.1925274885032,47.1925975792747,47.1926073430856,47.1926857771296,47.1928459644377,47.1928498635214,47.1928986436773,47.1929497005592,47.1929599407137,47.1929684643437,47.193050211117,47.1931469808784,47.1931478631913,47.1931542117573,47.1931249990099,47.1931704392877,47.1931752485592,47.1931689455555,47.1932949544766,47.1932834146373,47.1932569798695,47.1932217483137,47.1932598019444,47.1932985603878,47.1933322166107,47.1933531734425,47.1933410828008,47.1933854759435,47.1933751214584,47.1933920068121,47.193455870374,47.1934399122298,47.1934280888765,47.1934488053448,47.1934702052302,47.1935055379984,47.193534048462,47.1935809845701,47.1935950454176,47.1935886916836,47.193612997191,47.1936280572496,47.1936060212763,47.1936251736646,47.193658710668,47.1937374955665,47.1937701256114,47.1937919542755,47.193784195446,47.1938111184486,47.1938708735276,47.1939332319376,47.1939519397334,47.1940527046992,47.1940734940038,47.1940322569251,47.1940256626239,47.1940340662442,47.1940260354395,47.1940442955395,47.1940812183367,47.1941405572614,47.1941833600667,47.194227506927,47.1942941815214,47.1943228889354,47.1943617590494,47.1944391573872,47.1944675350844,47.1945251012959,47.1945823367284,47.1946095478338,47.1946295055264,47.1946571068179,47.1947362541012,47.1948114655741,47.194847865527,47.1948613069626,47.1948870579373,47.1948887216833,47.1949866036859,47.1950484603804,47.1950962239917,47.1951399295627,47.1951766003417,47.1951952850661,47.195206572154,47.1952485362049,47.1952726943172,47.1952967773376,47.1953533693264,47.1953632257755,47.1953730340467,47.1953607673464,47.1953797023705,47.1954316983522,47.1954609133821,47.1954562632153,47.195490164789,47.1954943410872,47.1954906555223,47.1954940307863,47.1954878632719,47.1955187211288,47.1955209831379,47.1955594050137,47.195619273319,47.1956209402707,47.1956720333861,47.1957144411764,47.1958243693144,47.1958659849449,47.1959432417581,47.196005456915,47.19605096193,47.1961366500778,47.1961587224093,47.1961754552533,47.1962221841294,47.1962384694588,47.1962552653927,47.1962964065395,47.1963717874085,47.1963950966865,47.1963945575189,47.19644733966,47.1965688531027,47.1966091181977,47.1967567308837,47.1967465243145,47.1966913011404,47.1967037534961,47.1967507583445,47.1968058370695,47.196748184496,47.1967565095854,47.1968334015657,47.1968893758068,47.1969085299835,47.1968622362416,47.196918359192,47.1969355611332,47.1969453066001,47.196962259784,47.196947050779,47.1969530410288,47.1969403240946,47.1969732266061,47.19700111566,47.1969962402498,47.1970203055899,47.197051960735,47.1970821895266,47.1971156229116,47.1972096411942,47.1972483169093,47.1972706461924,47.197333255296,47.197425572429,47.1974335899218,47.1974073216055,47.1974242930838,47.1974067947704,47.1973877039649,47.1974054549583,47.1973811451406,47.1973768823615,47.1973571939292,47.1973325523465,47.1973083956239,47.1972740081089,47.1972516844499,47.1972308002328,47.1971967349198,47.1971499932677,47.1971283873983,47.197097506036,47.1970900399972,47.1971051895329,47.1971127456403,47.1970340209676,47.1969493506564,47.1968827071115,47.1968279211053,47.1966368377569,47.1965743185672,47.196516461499,47.1964759459579,47.1964631010027,47.1964338823269,47.1963878886187,47.1963442935751,47.1962825189271,47.1962684325428,47.1962074815334,47.1961691028112,47.1960888136061,47.196069452573,47.1960103040637,47.1959913481807,47.1960011741584,47.1959478049237,47.1958431825842,47.1958603141791,47.1958085509685,47.1957546287426,47.1957424472605,47.1957943255276,47.194995648389,47.194677273916,47.1943853067718,47.19415908419,47.1936043560217,47.1934659303493,47.19324260407,47.1926420913907,47.1925229703458,47.1921611998834,47.1916148097378,47.1913030239139,47.1910183289754,47.1905410721897,47.1900533077896,47.1896596938697,47.1892919705238,47.1892440774229,47.1892318327176,47.1891653580785,47.1890728732343,47.1886433626813,47.1879673499423,47.1874711336717,47.1872944639126,47.1870367762122,47.1867443573494,47.1871594243591,47.1871470849209,47.1872305953238,47.1874176730306,47.1874932911946,47.1869960505355,47.1866400267837,47.1864601373061,47.1862644275022,47.1861303344864,47.1860529165231,47.1860135309929,47.186011589104,47.1859988879055,47.1860922791953,47.18603158119,47.1860034979541,47.1855604697543,47.1853738736582,47.1852635269558,47.1848474529317,47.1847361775037,47.1846193155063,47.184421594157,47.1843602478107,47.1843740218289,47.1839747618639,47.1840643642931,47.1840745037332,47.1840415808399,47.18394511496,47.1838788818346,47.1838571959466,47.1837840664672,47.1836548441542,47.1835438070284,47.1835025476547,47.183450693982,47.1833720527979,47.1832897681622,47.1832174085459,47.183128463496,47.1830082042485,47.1829624988112,47.1829071101929,47.1828744620022,47.1828704885306,47.1827895048375,47.1827021011538,47.1827428168221,47.1827354191336,47.1816643004391,47.1813890631592,47.1813607162365,47.1814103086901,47.1813696458858,47.1813907781155,47.1812447573551,47.180737589256,47.1797595085758,47.1795224842925,47.1786080351814,47.1786030306854,47.178608836258,47.1785962722654,47.178596503763,47.1780571756028,47.1780363629103,47.1779447976165,47.1778080660888,47.1775284600215,47.1774759026094,47.1774920164796,47.1774801453993,47.1774393240457,47.1774237845977,47.1774631051072,47.177444014814,47.1775057151907,47.1774888093491,47.1773790184302,47.1773963698107,47.1774238039631,47.1773950793534,47.1773846926857,47.1773861261457,47.1774129323851,47.1773940903158,47.1773390050184,47.177321080639,47.177319110882,47.1772971363073,47.1772705679696,47.1772390351881,47.1772127716357,47.1771656482966,47.1771160640808,47.1770585881041,47.177014144566,47.1769641391502,47.1769405766434,47.1768794864597,47.1768340095308,47.1767974464751,47.1767502976463,47.1767182118634,47.1766907465045,47.1766256507258,47.176562455181,47.1765870864365,47.1765653758078,47.1765183788229,47.1764632627757,47.1764364315652,47.1764046871362,47.1763989335944,47.1763911392872,47.1763879085396,47.1756015899652,47.1751859400129,47.1745413713443,47.1738479498593,47.1733084895958,47.172831458273,47.1721716934825,47.1715720653614,47.1714863630665,47.1712645764218,47.1710735105834,47.1708821170969,47.1704464050424,47.1704683930079,47.1705064761903,47.1705529942342,47.170536560287,47.1705337945618,47.170543836709,47.1704830538501,47.1704467835363,47.1704799349174,47.1705478144074,47.1705520932392,47.170617445116,47.1706571289004,47.1707053849566,47.1707461648982,47.1707688066654,47.1707993590405,47.1707436968564,47.1707002662319,47.1707566481341,47.1709070368838,47.1707208514348,47.1699554693972,47.1699614012174,47.1696948305903,47.1696379614094,47.1696519560425,47.169832954281,47.1700974942663,47.1702354811837,47.1699626488259,47.1697828086282,47.1696710625898,47.1696242679576,47.1692302276705,47.168993213145,47.1688275061636,47.1687920194242,47.1684519436742,47.1680023857312,47.1678302700358,47.167541372372,47.1664788805571,47.1665776838169,47.1668263363304,47.1668438938394,47.1669174056454,47.1673189474919,47.1675087581287,47.1671781008151,47.1670614626288,47.1670190871124,47.1673199667586,47.1670916321423,47.1666784810388,47.1669962912306,47.1666490800079,47.1663564420804,47.1660504043699,47.1655693081032,47.1651359720189,47.1644472752689,47.1588325192923,47.1666420499496]}]],[[{"lng":[8.08243322041053,8.08261287353554,8.08289027438778,8.08328296140265,8.08347655619269,8.08385428350199,8.08422496829425,8.08512260944065,8.08524686646859,8.08541757988467,8.08563862480946,8.08564919764589,8.08563267784944,8.08583023855469,8.08593423644945,8.08618523785354,8.08630582170164,8.08651057402546,8.08685555791511,8.0869983171292,8.08705955421914,8.08730803481507,8.08764598406458,8.08773780993105,8.08783114813815,8.08791373032312,8.0879933620781,8.08814090085005,8.08828132682214,8.08890958252523,8.08899846221224,8.08934595638991,8.0902546194708,8.09029110273919,8.09037645072472,8.09044488194108,8.09059141089929,8.09082003485704,8.09088396553207,8.0911445675748,8.09127309273741,8.09137521918372,8.09174821040031,8.09186936928458,8.0919381753001,8.09223320559144,8.09433542305214,8.09399664659524,8.09371504565192,8.09345370820898,8.09310758600837,8.09289588143402,8.09267308955494,8.09236965882273,8.09210424396666,8.09186709234021,8.09176057239421,8.09166917296236,8.09130662352614,8.09126817392282,8.09125041225796,8.09125503448957,8.0912877388042,8.09161720062576,8.09165492826997,8.09170384012045,8.09172378757255,8.09181843590449,8.0918228013746,8.09180591760511,8.09175926554185,8.0916942338011,8.09160379606706,8.09149320347121,8.09135916073744,8.09121384434385,8.09104047237165,8.09085224141021,8.09062485492684,8.0905449694232,8.09192361044963,8.09235963647775,8.09254327601076,8.09327356743476,8.09525364812263,8.09690409178961,8.09870760629639,8.09993063811905,8.10051615007366,8.10109981757214,8.10132974149156,8.10224473643606,8.10266673777858,8.10442679731129,8.10489203914549,8.10500379813298,8.10585071196069,8.10643911854937,8.10669001565951,8.1067803444363,8.10950208467016,8.10980085321996,8.10947013830195,8.10910533643551,8.10882542778345,8.10825568565351,8.10808573372434,8.10815264710798,8.10826354097034,8.10849953837653,8.10879761735156,8.10928640749921,8.10974270799045,8.11009650967517,8.11017200140325,8.11032895763345,8.11042181821177,8.11047111277632,8.11049288987057,8.11049426870029,8.11048502266777,8.11042921098087,8.11164156252363,8.11157484932274,8.11137767266666,8.11123799072427,8.11118801307343,8.11118349972469,8.11148234231262,8.11150687784309,8.11150560990157,8.11147142686933,8.11149178652493,8.11156401210492,8.11166293646899,8.11181920979371,8.11199144062518,8.11218894900319,8.11269926860657,8.11296653819986,8.11314999425924,8.11327612223547,8.11364010136345,8.11365807840932,8.11384893758301,8.11395410086477,8.11408793589854,8.11414442366144,8.11425280660225,8.11691720462005,8.11511001062172,8.11552879605892,8.11630679946474,8.11683300016068,8.11686672850033,8.11706021194609,8.11717164521339,8.11930588498872,8.12161435535741,8.12157111032515,8.12163441971764,8.12206612313811,8.12250417270175,8.12293837495166,8.12310779118399,8.12330091147134,8.12296934716341,8.12278333027279,8.12252772568161,8.12255480961393,8.12290469274241,8.12406916365208,8.12406869360999,8.12447136034923,8.1247569293149,8.12508535124256,8.12543047752821,8.12564126859812,8.12568429337916,8.12568084104297,8.12568254711832,8.12642958441591,8.12631020724782,8.12481896355328,8.1278238735793,8.1297096688233,8.12230542892681,8.12207671983828,8.12126678889468,8.1190836620982,8.11890161740182,8.11881929812579,8.11878231783094,8.11873327487121,8.11867462094915,8.11860858093777,8.11847795203865,8.11702285871132,8.11702438836585,8.11696313334401,8.11626679230172,8.1154854361694,8.11524029182991,8.11410825088376,8.11397208132914,8.11373244537145,8.11338853462043,8.11301559518874,8.11300673374558,8.1125312576867,8.11251434425146,8.11248340083164,8.1123820941655,8.11221808907835,8.11200331696883,8.11107531068003,8.11091670650045,8.11061768908747,8.11052045538406,8.11026902949634,8.11001123020883,8.10978681978823,8.10979295401932,8.10968882487017,8.10966473951033,8.10956732253738,8.10930631529981,8.10909270590585,8.10903813236563,8.1090270280884,8.10900745959724,8.10900292579856,8.108879485741,8.10867181770233,8.10838638557806,8.1080559874484,8.10785282974149,8.10780728837196,8.10774268434996,8.10765618754466,8.10745085639153,8.10736284219437,8.10671114068127,8.10666917833901,8.10600251104159,8.1057881157753,8.10478895827302,8.10376948791451,8.10370303408844,8.10297491349635,8.10253580317686,8.10191343046702,8.10166420945123,8.1014100605929,8.10058811233938,8.09980640261384,8.09966639054952,8.0992619561579,8.09812047341992,8.09671176096611,8.09622150871021,8.09572071777399,8.09515807880644,8.09409769983651,8.09403692879188,8.09400870687345,8.09400036147863,8.09400513199123,8.09381031018858,8.09410669753024,8.09415962784058,8.09419012588198,8.09419781967812,8.09419009459813,8.09417171867725,8.0941397571085,8.09408544004688,8.09375622179522,8.09352377282536,8.09331605938808,8.09309779723873,8.09281784252347,8.09224315548277,8.09225902400125,8.09202039230853,8.09179269332825,8.09156445222525,8.09142207414653,8.09132027962655,8.09122167319703,8.09095922246212,8.0905301519527,8.09031906322838,8.08972261373881,8.08963541136787,8.08903853081898,8.08874265561913,8.08857152695577,8.08825562481626,8.08808517948583,8.08792497823621,8.08778838009021,8.08766397318748,8.08757422472608,8.08748721519512,8.08746023256869,8.0874829112923,8.08752565559023,8.08758882670272,8.08762572989705,8.08763196170459,8.08761446925628,8.08757204994889,8.08750569666653,8.08739089421055,8.0870579635831,8.08654984847421,8.0863058690638,8.0859199288573,8.08572984227146,8.08548741806939,8.0841375844789,8.08384593243659,8.08365894962292,8.08370059697956,8.08243322041053],"lat":[47.1802036140801,47.1804388013842,47.1806454310487,47.180904926252,47.1810549860524,47.1813983878536,47.1817230102694,47.1821785027413,47.1822758780534,47.1823734150999,47.1825089880044,47.1825323157062,47.1825845797426,47.1827746142464,47.1828537258016,47.1830212415676,47.1830862272673,47.1832160433517,47.1834097531731,47.1834754228854,47.1835096190624,47.1836656329319,47.1838009932232,47.1838769335339,47.18393721388,47.1839700299744,47.1839640940315,47.1839221547261,47.1839366542444,47.1840762286471,47.1841049606408,47.1842662577217,47.1845578663943,47.1844886680158,47.1845089635963,47.1846016749729,47.1846739932318,47.1847247800555,47.1847425789875,47.1848730690001,47.1849078711447,47.1849190668714,47.1850906464646,47.1851261283675,47.1851638680505,47.1847648921657,47.1847134541995,47.1850824791701,47.1854253531209,47.1857628939993,47.186268133829,47.1865973047314,47.1868734584578,47.1871578951466,47.1873573820847,47.1875700207414,47.1877182333436,47.1878729264804,47.1886674528396,47.1887713834202,47.188883831993,47.1889923758164,47.1891206395285,47.1897917982423,47.1898979865389,47.1900783383789,47.1901883244165,47.1914478200112,47.1916552295236,47.1918612213768,47.1920392275911,47.1922141897277,47.1923834580749,47.192544817019,47.1926985820113,47.1928488126996,47.192991466385,47.1931168525415,47.1932453384264,47.193284640066,47.1931909267777,47.1931499542892,47.1931242745488,47.1929954463513,47.1926632332788,47.1923820191339,47.1919063310301,47.1914583971644,47.1914738965926,47.1914501583175,47.1914450397573,47.1914605321617,47.1914746598725,47.1914486950254,47.1914287162877,47.1914195694466,47.1914187322419,47.1914027560909,47.1914002217085,47.1914048069313,47.1914123371024,47.1896397510763,47.1896100512376,47.1895399992212,47.1894747681644,47.1893566309616,47.1893504408953,47.1892175908958,47.1889730725071,47.1885305650381,47.1879239589055,47.1869647688313,47.1860454968384,47.1853835573041,47.1851885720439,47.1848446661716,47.1845819185774,47.184369725421,47.1841400894409,47.1839545672874,47.183836012369,47.1835688428588,47.1834538503755,47.1832823266081,47.182730363248,47.1824288550853,47.1823090808659,47.1823068854444,47.1822301298929,47.1822025066098,47.1819148158596,47.1815328242432,47.1814207167078,47.1812984025204,47.181202017937,47.1811013401908,47.1810190987567,47.1809452545249,47.1807837213684,47.1807160248146,47.180699820652,47.180658154215,47.1816759001344,47.1816712882279,47.1821998978049,47.1821318181326,47.1824957741659,47.1825192887444,47.182497217676,47.1816789608115,47.1800280307848,47.1799031648365,47.1796130851762,47.179379353472,47.1794070395525,47.1793247282004,47.1793107678962,47.1783856568432,47.1773567393448,47.1773122003209,47.1772842818536,47.176912427031,47.1764584886278,47.1762779500819,47.1761978762531,47.1761342031902,47.1759764215147,47.1758826287545,47.1757453530048,47.17571343047,47.1742734412653,47.1746707273459,47.174675227691,47.1748107066386,47.1748856344507,47.1749383760366,47.1749851882266,47.1750223397207,47.1749827834235,47.1749707505974,47.1744036986064,47.1744840082137,47.1735427726728,47.1721115366508,47.1698502627853,47.1666420499496,47.1663638305623,47.1663439601275,47.166189561225,47.1664048758182,47.1660651630729,47.1660856096272,47.1660380730946,47.1659982446598,47.1659701576231,47.1659524495623,47.1659398993153,47.1658878831722,47.1658732840965,47.1655606693267,47.1654742705722,47.1653388764238,47.1659685985721,47.1657599036448,47.166290918861,47.16628074769,47.1663805586809,47.1663653924013,47.1664597939224,47.1667159791772,47.1666904781289,47.166621253065,47.1665333881883,47.1665035216936,47.1664201072542,47.1661087691416,47.1660571910622,47.1659688959137,47.1659446009857,47.1658418239048,47.1656861382918,47.1655624419181,47.1655467546826,47.1655278333498,47.1655098036429,47.1654918325366,47.1655198889492,47.1654907297601,47.1654604732388,47.1654289561113,47.1652944584067,47.1652209768565,47.1651691642243,47.165095048143,47.1649543886345,47.1648765598176,47.1648528875383,47.1648392188628,47.1647059272037,47.1645811371762,47.1643294960257,47.1642626340377,47.1635304478516,47.1634969687367,47.1631032250895,47.1629994769883,47.163956944701,47.1648704357054,47.1649102181519,47.1654777400151,47.1657989782687,47.1662924383604,47.1665113662242,47.166761768724,47.1676462082158,47.1684331645644,47.1685250167776,47.1689374779415,47.1684943220592,47.1696946175232,47.1701031056113,47.1705036460548,47.1701154170221,47.1708295238486,47.1708746112885,47.1709074240485,47.1709368674482,47.170970985589,47.1710963073188,47.1713112936713,47.1713583783678,47.1714037197888,47.1714395663183,47.1714755006378,47.1715044884368,47.1715335445841,47.1715671445682,47.1717156289049,47.1718104550249,47.1718883102489,47.1719633016557,47.1720535480049,47.1722339606132,47.172254478233,47.172333810884,47.1724194765094,47.1724856254574,47.1725347452559,47.1725758900803,47.1726210375387,47.1727605000468,47.1729355543992,47.1730175070072,47.1732344060741,47.1732792447978,47.1735230199529,47.1736526276221,47.1737342524079,47.1738986298134,47.1740062637206,47.1741319826394,47.1742678586104,47.1744290137705,47.1745884173183,47.1747986184351,47.1749864433606,47.1752130449806,47.1754310061981,47.1757016712396,47.1759274190553,47.1761150297805,47.1763043843228,47.1764942391344,47.1766794614109,47.1769163183614,47.1773986193284,47.1779922743166,47.1781852413627,47.1784091393314,47.1784748820435,47.1787205585349,47.1796295263414,47.1798079133896,47.1799041284199,47.1799772946895,47.1802036140801]}]]],null,"muni",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>bfs&emsp;<\/th><td>1093&emsp;<\/td><\/tr><tr><td>2<\/td><th>name&emsp;<\/th><td>Neuenkirch&emsp;<\/td><\/tr><tr><td>3<\/td><th>popsize&emsp;<\/th><td> 7194&emsp;<\/td><\/tr><tr><td>4<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>bfs&emsp;<\/th><td>1094&emsp;<\/td><\/tr><tr><td>2<\/td><th>name&emsp;<\/th><td>Nottwil&emsp;<\/td><\/tr><tr><td>3<\/td><th>popsize&emsp;<\/th><td> 4089&emsp;<\/td><\/tr><tr><td>4<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>bfs&emsp;<\/th><td>1102&emsp;<\/td><\/tr><tr><td>2<\/td><th>name&emsp;<\/th><td>Sempach&emsp;<\/td><\/tr><tr><td>3<\/td><th>popsize&emsp;<\/th><td> 4186&emsp;<\/td><\/tr><tr><td>4<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>bfs&emsp;<\/th><td>1095&emsp;<\/td><\/tr><tr><td>2<\/td><th>name&emsp;<\/th><td>Oberkirch&emsp;<\/td><\/tr><tr><td>3<\/td><th>popsize&emsp;<\/th><td> 5014&emsp;<\/td><\/tr><tr><td>4<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>bfs&emsp;<\/th><td>1084&emsp;<\/td><\/tr><tr><td>2<\/td><th>name&emsp;<\/th><td>Eich&emsp;<\/td><\/tr><tr><td>3<\/td><th>popsize&emsp;<\/th><td> 1610&emsp;<\/td><\/tr><tr><td>4<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>bfs&emsp;<\/th><td>1099&emsp;<\/td><\/tr><tr><td>2<\/td><th>name&emsp;<\/th><td>Schenkon&emsp;<\/td><\/tr><tr><td>3<\/td><th>popsize&emsp;<\/th><td> 3088&emsp;<\/td><\/tr><tr><td>4<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>bfs&emsp;<\/th><td>1103&emsp;<\/td><\/tr><tr><td>2<\/td><th>name&emsp;<\/th><td>Sursee&emsp;<\/td><\/tr><tr><td>3<\/td><th>popsize&emsp;<\/th><td>10382&emsp;<\/td><\/tr><tr><td>4<\/td><th>geom&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[8.07577693996246,47.0686789639202,8.23919850679236,47.1974335899218,true,"muni","Zoom to muni","<strong> muni <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"muni",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["muni"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"muni"}]}],"limits":{"lat":[47.0686789639202,47.1974335899218],"lng":[8.07577693996246,8.23919850679236]},"fitBounds":[47.0686789639202,8.07577693996246,47.1974335899218,8.23919850679236,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
</section>
<section id="more-help" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="more-help"><span class="header-section-number">9</span> More help</h2>
<p>sf vignettes</p>
<p>geocomp with R</p>
<p>tmap book</p>
</section>
<section id="references" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="references"><span class="header-section-number">10</span> References</h2>
<p>Appelhans T., Detsch F., Reudenbach C., Woellauer S. (2022). mapview: Interactive Viewing of Spatial Data in R. R package version 2.11.0</p>
<p>Bivand R. (2022) R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data Geographical Analysis, 54(3), 488-518</p>
<p>Giraud T. (2022). mapsf: Thematic Cartography. R package version 0.6.1</p>
<p>Hijmans R. (2022). terra: Spatial Data Analysis. R package version 1.6-47</p>
<p>Pebesma E. (2018). Simple Features for R: Standardized Support for Spatial Vector Data. The R Journal, 10(1), 439-446</p>
<p>Pebesma E., Bivand R. 2022</p>
<p>Tennekes M. (2018). tmap: Thematic Maps in R. Journal of Statistical Software, 84(6), 1-39</p>
<p>Tennekes M., Nowosad J. (2021). Elegant and informative maps with tmap. https://r-tmap.github.io/tmap-book/index.html</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>